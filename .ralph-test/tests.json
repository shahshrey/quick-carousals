{
  "metadata": {
    "version": "1.0",
    "created_at": "2026-01-30T16:53:00Z",
    "last_updated": 1769806091.411099,
    "description": "Manual test cases for QuickCarousals - created by Ralph Test Discovery agent",
    "coverage_summary": {
      "total_tests": 176,
      "by_priority": {
        "critical": 71,
        "high": 93,
        "medium": 11,
        "low": 1
      },
      "by_category": {
        "api": 56,
        "frontend": 63,
        "database": 2,
        "integration": 48,
        "e2e": 4,
        "security": 4,
        "performance": 0
      },
      "modules_analyzed": 15,
      "modules_total": 20,
      "journeys_analyzed": 0,
      "journeys_total": 6,
      "total_test_cases": 190
    }
  },
  "modules": {
    "auth": {
      "name": "Authentication & Authorization",
      "status": "analyzed",
      "test_count": 10
    },
    "generation_topic": {
      "name": "Topic-Based Generation",
      "status": "analyzed",
      "test_count": 11
    },
    "generation_text": {
      "name": "Text-Based Generation",
      "status": "analyzed",
      "test_count": 13
    },
    "creation_flow": {
      "name": "Creation Flow UI",
      "status": "analyzed",
      "test_count": 13
    },
    "editor_canvas": {
      "name": "Canvas Editor Core",
      "status": "analyzed",
      "test_count": 15
    },
    "editor_controls": {
      "name": "Editor Controls",
      "status": "analyzed",
      "test_count": 15
    },
    "editor_page": {
      "name": "Editor Page Integration",
      "status": "analyzed",
      "test_count": 15
    },
    "export_system": {
      "name": "Export System",
      "status": "analyzed",
      "test_count": 16
    },
    "projects_crud": {
      "name": "Project Management",
      "status": "analyzed",
      "test_count": 13
    },
    "dashboard": {
      "name": "Dashboard",
      "status": "analyzed",
      "test_count": 8
    },
    "brand_kit": {
      "name": "Brand Kit",
      "status": "analyzed",
      "test_count": 14
    },
    "style_kits": {
      "name": "Style Kits",
      "status": "analyzed",
      "test_count": 10
    },
    "billing": {
      "name": "Billing & Subscriptions",
      "status": "analyzed",
      "test_count": 14
    },
    "feature_gating": {
      "name": "Feature Gating by Tier",
      "status": "analyzed",
      "test_count": 10
    },
    "rewrite": {
      "name": "AI Rewrite Actions",
      "status": "analyzed",
      "test_count": 13
    },
    "auto_save": {
      "name": "Auto-Save",
      "status": "pending_analysis",
      "test_count": 0
    },
    "text_measurement": {
      "name": "Text Measurement & Auto-Fit",
      "status": "pending_analysis",
      "test_count": 0
    },
    "database": {
      "name": "Database & Data Integrity",
      "status": "pending_analysis",
      "test_count": 0
    },
    "marketing": {
      "name": "Marketing Pages",
      "status": "pending_analysis",
      "test_count": 0
    },
    "infrastructure": {
      "name": "Infrastructure & Health",
      "status": "pending_analysis",
      "test_count": 0
    }
  },
  "user_journeys": {
    "new_user_onboarding": {
      "name": "New User Onboarding",
      "description": "Landing page \u2192 Sign up \u2192 Dashboard \u2192 First carousel",
      "status": "pending_analysis",
      "test_count": 0
    },
    "topic_to_export": {
      "name": "Topic \u2192 Export (Happy Path)",
      "description": "Enter topic \u2192 Generate \u2192 Edit \u2192 Export PDF",
      "status": "pending_analysis",
      "test_count": 0
    },
    "text_to_export": {
      "name": "Paste Text \u2192 Export",
      "description": "Paste text \u2192 Generate \u2192 Edit \u2192 Export PNG",
      "status": "pending_analysis",
      "test_count": 0
    },
    "returning_user": {
      "name": "Returning User Experience",
      "description": "Login \u2192 Dashboard with projects \u2192 Edit existing",
      "status": "pending_analysis",
      "test_count": 0
    },
    "upgrade_flow": {
      "name": "Subscription Upgrade",
      "description": "Free \u2192 Creator tier upgrade via Stripe",
      "status": "pending_analysis",
      "test_count": 0
    },
    "error_recovery": {
      "name": "Error Recovery Flows",
      "description": "Network errors, generation failures, export failures",
      "status": "pending_analysis",
      "test_count": 0
    }
  },
  "cross_cutting": {
    "security": {
      "name": "Security Testing",
      "status": "pending_analysis",
      "test_count": 0
    },
    "error_handling": {
      "name": "Error Handling",
      "status": "pending_analysis",
      "test_count": 0
    }
  },
  "test_cases": [
    {
      "id": "TC-GENTOPIC-001",
      "name": "Successfully generate carousel from valid topic with default parameters",
      "module": "generation_topic",
      "user_journey": "topic_to_export",
      "category": "api",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates the complete AI generation pipeline can create carousel slides from a topic description",
      "business_context": "Topic-based generation is the core feature of QuickCarousals. Users must be able to provide a topic and receive professionally structured slides ready for editing.",
      "preconditions": [
        "User is authenticated with valid session",
        "OpenAI API key is configured",
        "User has a Profile record in database",
        "Database has TemplateLayouts seeded"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST request to /api/generate/topic with body: {\"topic\": \"5 productivity tips for remote workers\"}",
          "expected": "API accepts request and begins generation process"
        },
        {
          "step": 2,
          "action": "Wait for response (AI generation takes 10-30 seconds)",
          "expected": "Step 1: generateSlidePlan creates structured plan with hook, promise, value, recap, CTA slides"
        },
        {
          "step": 3,
          "action": "Verify step 2 of AI pipeline executes",
          "expected": "Step 2: generateSlideCopy creates detailed copy for each slide with headlines and body bullets"
        },
        {
          "step": 4,
          "action": "Verify step 3 of AI pipeline executes",
          "expected": "Step 3: selectLayoutsForSlides maps each slide to appropriate layoutId from TemplateLayout table"
        },
        {
          "step": 5,
          "action": "Check response status code",
          "expected": "Response status is 200 OK"
        },
        {
          "step": 6,
          "action": "Parse response body JSON",
          "expected": "Response contains: {slides: [...], metadata: {topic, tone, slideCount, generatedAt}}"
        },
        {
          "step": 7,
          "action": "Verify slides array structure",
          "expected": "slides array contains 10 slides (default), each with: orderIndex, slideType, layoutId, headline, body, emphasis"
        }
      ],
      "acceptance_criteria": [
        "Response status code is 200",
        "Response time is under 45 seconds (AI generation is slow)",
        "slides array contains exactly 10 slides (default slideCount)",
        "Each slide has orderIndex from 0 to 9",
        "First slide has slideType 'hook', last slide has slideType 'cta'",
        "All layoutId values exist in TemplateLayout table (hook_big_headline, promise_two_column, value_bullets, recap_grid, cta_centered, etc.)",
        "All headlines are 8-12 words or less",
        "All body arrays contain 3-5 items or less",
        "metadata.topic matches input topic",
        "metadata.tone is 'professional' (default)",
        "metadata.generatedAt is valid ISO timestamp"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/generate/topic/route.ts",
        "apps/nextjs/src/lib/openai.ts"
      ],
      "tags": [
        "generation",
        "topic",
        "ai",
        "core-feature",
        "critical"
      ],
      "notes": "This is the primary happy path for carousel generation. The AI pipeline has 3 steps and takes significant time. Default tone is 'professional', default slideCount is 10."
    },
    {
      "id": "TC-GENTOPIC-002",
      "name": "Generate carousel with custom slideCount parameter",
      "module": "generation_topic",
      "user_journey": "topic_to_export",
      "category": "api",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that slideCount parameter controls the number of generated slides within allowed range (8-12)",
      "business_context": "Users should be able to control carousel length. Some topics need more slides (12), others work better with fewer (8).",
      "preconditions": [
        "User is authenticated",
        "OpenAI API is available"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST request with {\"topic\": \"Git workflow basics\", \"slideCount\": 8}",
          "expected": "API accepts slideCount parameter"
        },
        {
          "step": 2,
          "action": "Wait for generation to complete",
          "expected": "AI generates exactly 8 slides"
        },
        {
          "step": 3,
          "action": "Verify response slides array length",
          "expected": "slides.length === 8"
        },
        {
          "step": 4,
          "action": "Send POST request with {\"topic\": \"Advanced SEO strategies\", \"slideCount\": 12}",
          "expected": "API accepts slideCount: 12"
        },
        {
          "step": 5,
          "action": "Wait for generation to complete",
          "expected": "AI generates exactly 12 slides"
        },
        {
          "step": 6,
          "action": "Verify response slides array length",
          "expected": "slides.length === 12"
        },
        {
          "step": 7,
          "action": "Verify metadata reflects requested slideCount",
          "expected": "metadata.slideCount matches request parameter"
        }
      ],
      "acceptance_criteria": [
        "slideCount: 8 produces 8 slides",
        "slideCount: 12 produces 12 slides",
        "slideCount: 10 (default) produces 10 slides",
        "metadata.slideCount accurately reflects generated count",
        "All slides have sequential orderIndex (0 to n-1)",
        "Slide types are properly distributed (hook, promise, value, recap, cta)",
        "Response time scales with slideCount (more slides = longer time)"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/generate/topic/route.ts",
        "apps/nextjs/src/lib/openai.ts"
      ],
      "tags": [
        "generation",
        "topic",
        "parameters",
        "slideCount"
      ],
      "notes": "Schema validation: slideCount must be int between 8-12 inclusive. Default is 10 if not specified."
    },
    {
      "id": "TC-GENTOPIC-003",
      "name": "Generate carousel with different tone options",
      "module": "generation_topic",
      "user_journey": "topic_to_export",
      "category": "api",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that tone parameter affects the style and voice of generated content",
      "business_context": "Different audiences and topics require different tones. Professional tone for B2B, bold for viral content, calm for educational, contrarian for thought leadership.",
      "preconditions": [
        "User is authenticated",
        "OpenAI API is available"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Generate with tone: 'bold' - POST {\"topic\": \"Why everyone is wrong about productivity\", \"tone\": \"bold\"}",
          "expected": "AI uses bold, attention-grabbing language in headlines and copy"
        },
        {
          "step": 2,
          "action": "Verify bold tone characteristics",
          "expected": "Headlines are punchy, use strong verbs, may include exclamation points or provocative statements"
        },
        {
          "step": 3,
          "action": "Generate with tone: 'calm' - POST {\"topic\": \"Mindfulness techniques for busy professionals\", \"tone\": \"calm\"}",
          "expected": "AI uses soothing, reassuring language"
        },
        {
          "step": 4,
          "action": "Verify calm tone characteristics",
          "expected": "Headlines are gentle, body copy is supportive and non-urgent"
        },
        {
          "step": 5,
          "action": "Generate with tone: 'contrarian' - POST {\"topic\": \"The truth about morning routines\", \"tone\": \"contrarian\"}",
          "expected": "AI challenges common beliefs, presents alternative viewpoints"
        },
        {
          "step": 6,
          "action": "Verify contrarian tone characteristics",
          "expected": "Content questions assumptions, presents contrarian perspectives"
        },
        {
          "step": 7,
          "action": "Generate with tone: 'professional' - POST {\"topic\": \"Quarterly planning strategies\", \"tone\": \"professional\"}",
          "expected": "AI uses business-appropriate, formal language"
        },
        {
          "step": 8,
          "action": "Verify professional tone characteristics",
          "expected": "Language is polished, formal, suitable for corporate environments"
        },
        {
          "step": 9,
          "action": "Verify metadata reflects requested tone",
          "expected": "metadata.tone matches the requested tone value"
        }
      ],
      "acceptance_criteria": [
        "All 4 tone options are accepted: 'bold', 'calm', 'contrarian', 'professional'",
        "Each tone produces noticeably different language style",
        "Default tone is 'professional' when not specified",
        "metadata.tone accurately reflects the tone used",
        "Tone is consistently applied across all slides in the carousel",
        "AI system prompt correctly incorporates tone instruction"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/generate/topic/route.ts",
        "apps/nextjs/src/lib/openai.ts"
      ],
      "tags": [
        "generation",
        "topic",
        "parameters",
        "tone",
        "ai"
      ],
      "notes": "Tone enum defined in schema: ['bold', 'calm', 'contrarian', 'professional']. The AI's system prompt in generateSlidePlan includes the tone parameter."
    },
    {
      "id": "TC-GENTOPIC-004",
      "name": "Generate carousel with brand kit applied",
      "module": "generation_topic",
      "user_journey": "topic_to_export",
      "category": "integration",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that user's brand kit (colors, fonts, logo) can be applied to generated slides",
      "business_context": "Professional users need branded carousels matching their company identity. Brand kit application ensures consistent visual identity across all content.",
      "preconditions": [
        "User is authenticated",
        "User has a BrandKit record in database with colors, fonts, logoUrl",
        "BrandKit is marked as default or is the most recent"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST request with {\"topic\": \"Our company values\", \"applyBrandKit\": true}",
          "expected": "API fetches user's Profile record using clerkUserId"
        },
        {
          "step": 2,
          "action": "Verify brand kit lookup",
          "expected": "API queries BrandKit table for user's default brand kit (isDefault: true) or most recent kit"
        },
        {
          "step": 3,
          "action": "Wait for carousel generation",
          "expected": "Slides are generated normally through AI pipeline"
        },
        {
          "step": 4,
          "action": "Parse response and check slide objects",
          "expected": "Each slide object contains brandKit property: {colors, fonts, logoUrl, handle}"
        },
        {
          "step": 5,
          "action": "Verify brand kit data is attached",
          "expected": "brandKit.colors contains user's color palette, brandKit.fonts contains typography settings"
        },
        {
          "step": 6,
          "action": "Verify logoUrl is included if user has uploaded logo",
          "expected": "brandKit.logoUrl is populated or null if no logo exists"
        },
        {
          "step": 7,
          "action": "Test without brand kit: {\"topic\": \"Test\", \"applyBrandKit\": false}",
          "expected": "Slides do NOT contain brandKit property"
        }
      ],
      "acceptance_criteria": [
        "When applyBrandKit: true, all slides include brandKit object",
        "brandKit contains: colors (object), fonts (object), logoUrl (string or null), handle (string or null)",
        "Brand kit data matches the BrandKit record in database",
        "If user has no brand kit, brandKit property is null or absent",
        "applyBrandKit defaults to false when not specified",
        "Brand kit lookup queries by Profile.id, ordered by isDefault DESC, createdAt DESC",
        "Editor can use this brandKit data to override StyleKit defaults"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/generate/topic/route.ts",
        "packages/db/prisma/schema.prisma"
      ],
      "tags": [
        "generation",
        "topic",
        "brand-kit",
        "integration"
      ],
      "notes": "Lines 80-100 in route.ts handle brand kit fetching. This doesn't affect AI generation, just attaches brand data to slides for editor to use."
    },
    {
      "id": "TC-GENTOPIC-005",
      "name": "API returns 401 when called without authentication",
      "module": "generation_topic",
      "category": "api",
      "type": "security",
      "priority": "critical",
      "description": "Validates that unauthenticated requests are rejected to protect the OpenAI API key and prevent abuse",
      "business_context": "Generation uses expensive OpenAI API credits. Only authenticated users with valid accounts should be able to generate content.",
      "preconditions": [
        "User is NOT authenticated",
        "No valid session token in request"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST request to /api/generate/topic without auth headers, body: {\"topic\": \"test\"}",
          "expected": "Request reaches the API endpoint"
        },
        {
          "step": 2,
          "action": "Check response status code",
          "expected": "Response status is 401 Unauthorized"
        },
        {
          "step": 3,
          "action": "Parse response body",
          "expected": "Response JSON: {\"error\": {\"code\": \"UNAUTHORIZED\", \"message\": \"Authentication required\"}}"
        },
        {
          "step": 4,
          "action": "Verify no AI generation occurred",
          "expected": "OpenAI API was never called, no charges incurred"
        },
        {
          "step": 5,
          "action": "Verify response headers",
          "expected": "No Set-Cookie or session tokens are present in response"
        }
      ],
      "acceptance_criteria": [
        "HTTP status code is exactly 401",
        "Response is JSON with standardized ApiError format",
        "Error code is 'UNAUTHORIZED'",
        "Error message is clear: 'Authentication required'",
        "Response time is under 500ms (auth check is fast)",
        "No OpenAI API calls are made",
        "No database queries execute (auth fails before business logic)",
        "Response contains no sensitive information"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/generate/topic/route.ts",
        "apps/nextjs/src/lib/with-auth.ts"
      ],
      "tags": [
        "generation",
        "topic",
        "security",
        "auth"
      ],
      "notes": "withAuthAndErrors wrapper (line 72) handles auth before route logic executes. Verified via curl test."
    },
    {
      "id": "TC-GENTOPIC-006",
      "name": "API returns 400 validation error for invalid topic input",
      "module": "generation_topic",
      "category": "api",
      "type": "error_path",
      "priority": "critical",
      "description": "Validates that the API rejects invalid topic inputs with clear validation errors",
      "business_context": "Invalid inputs waste API credits and produce poor results. Validation must catch issues before calling OpenAI.",
      "preconditions": [
        "User is authenticated"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST request with empty topic: {\"topic\": \"\"}",
          "expected": "Zod validation fails on topic.min(1)"
        },
        {
          "step": 2,
          "action": "Check response status code",
          "expected": "Response status is 400 Bad Request"
        },
        {
          "step": 3,
          "action": "Parse error response",
          "expected": "Response contains: {\"error\": {\"code\": \"VALIDATION_ERROR\", \"message\": \"Invalid request body\", \"details\": {\"issues\": [{\"path\": \"topic\", \"message\": \"...\"}]}}}"
        },
        {
          "step": 4,
          "action": "Send POST request with topic exceeding 500 characters",
          "expected": "Zod validation fails on topic.max(500)"
        },
        {
          "step": 5,
          "action": "Verify validation error response",
          "expected": "Response status 400 with validation error details"
        },
        {
          "step": 6,
          "action": "Send POST request with missing topic field: {}",
          "expected": "Zod validation fails on required field"
        },
        {
          "step": 7,
          "action": "Verify validation error response",
          "expected": "Response status 400, error message indicates 'topic' field is required"
        },
        {
          "step": 8,
          "action": "Send POST request with invalid slideCount: {\"topic\": \"test\", \"slideCount\": 5}",
          "expected": "Zod validation fails on slideCount.min(8)"
        },
        {
          "step": 9,
          "action": "Verify validation error",
          "expected": "Response status 400, error details show slideCount must be >= 8"
        },
        {
          "step": 10,
          "action": "Send POST request with slideCount too high: {\"topic\": \"test\", \"slideCount\": 20}",
          "expected": "Zod validation fails on slideCount.max(12)"
        },
        {
          "step": 11,
          "action": "Verify validation error",
          "expected": "Response status 400, error details show slideCount must be <= 12"
        },
        {
          "step": 12,
          "action": "Send POST request with invalid tone: {\"topic\": \"test\", \"tone\": \"funny\"}",
          "expected": "Zod validation fails on tone enum"
        },
        {
          "step": 13,
          "action": "Verify validation error",
          "expected": "Response status 400, error indicates tone must be one of: bold, calm, contrarian, professional"
        }
      ],
      "acceptance_criteria": [
        "Empty topic string returns 400 validation error",
        "Topic longer than 500 characters returns 400",
        "Missing topic field returns 400",
        "slideCount below 8 returns 400",
        "slideCount above 12 returns 400",
        "Invalid tone value returns 400",
        "All validation errors use standardized ApiError format",
        "Error details include field path and validation message",
        "Response time is under 200ms (validation is fast, no AI calls)",
        "No OpenAI API calls are made for invalid inputs"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/generate/topic/route.ts",
        "apps/nextjs/src/lib/validations/api.ts"
      ],
      "tags": [
        "generation",
        "topic",
        "validation",
        "error-handling"
      ],
      "notes": "Schema validation at line 34-39: topic min(1) max(500), slideCount int min(8) max(12), tone enum, applyBrandKit boolean. validateBody helper throws ApiErrors.validation."
    },
    {
      "id": "TC-GENTOPIC-007",
      "name": "API handles OpenAI timeout errors gracefully",
      "module": "generation_topic",
      "category": "api",
      "type": "error_path",
      "priority": "high",
      "description": "Validates that API properly handles and reports OpenAI timeout errors with user-friendly messages",
      "business_context": "OpenAI API can be slow or unresponsive. Users need clear feedback when generation times out so they can retry.",
      "preconditions": [
        "User is authenticated",
        "OpenAI API is slow or timing out (simulate with long topic or network issues)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST request with valid topic that might cause timeout (very complex or long topic)",
          "expected": "API begins generation process"
        },
        {
          "step": 2,
          "action": "Wait for timeout to occur (default timeout: 30 seconds per openai.ts)",
          "expected": "OpenAI request times out after 30 seconds"
        },
        {
          "step": 3,
          "action": "Check API response status code",
          "expected": "Response status is 500 Internal Server Error"
        },
        {
          "step": 4,
          "action": "Parse error response body",
          "expected": "Response contains: {\"error\": {\"code\": \"INTERNAL_ERROR\", \"message\": \"AI generation timed out. Please try again.\"}}"
        },
        {
          "step": 5,
          "action": "Verify error handling logic",
          "expected": "Error handler at line 185-186 detects 'timeout' in error message"
        },
        {
          "step": 6,
          "action": "Verify console logs",
          "expected": "Server logs: 'OpenAI generation error: [timeout details]'"
        }
      ],
      "acceptance_criteria": [
        "Timeout errors return 500 status code",
        "Error message is user-friendly: 'AI generation timed out. Please try again.'",
        "Error code is 'INTERNAL_ERROR'",
        "Original error is logged to console for debugging",
        "Response contains no technical details (API keys, stack traces)",
        "Timeout detection works by checking error.message for 'timeout' substring",
        "User is encouraged to retry (message says 'Please try again')"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/generate/topic/route.ts",
        "apps/nextjs/src/lib/openai.ts"
      ],
      "tags": [
        "generation",
        "topic",
        "error-handling",
        "openai",
        "timeout"
      ],
      "notes": "Timeout handling at lines 185-186 in route.ts. Default timeout is 30s per openai.ts line 18. OpenAI timeouts are detected by checking error.message.includes('timeout')."
    },
    {
      "id": "TC-GENTOPIC-008",
      "name": "API handles OpenAI rate limit errors with proper response",
      "module": "generation_topic",
      "category": "api",
      "type": "error_path",
      "priority": "high",
      "description": "Validates that API properly handles OpenAI rate limit errors and returns 429 status with retry-after guidance",
      "business_context": "OpenAI has rate limits on API usage. When limits are hit, users need clear guidance on when they can retry.",
      "preconditions": [
        "User is authenticated",
        "OpenAI API rate limit has been exceeded (simulate by making many rapid requests)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Trigger OpenAI rate limit (make requests until rate limited)",
          "expected": "OpenAI returns 429 status or rate limit error"
        },
        {
          "step": 2,
          "action": "Check API response status code",
          "expected": "Response status is 429 Too Many Requests"
        },
        {
          "step": 3,
          "action": "Parse error response body",
          "expected": "Response contains: {\"error\": {\"code\": \"RATE_LIMITED\", \"message\": \"Too many requests. Please try again in 60 seconds.\", \"details\": {\"retryAfter\": 60}}}"
        },
        {
          "step": 4,
          "action": "Verify error detection logic",
          "expected": "Error handler at lines 189-190 detects 'rate limit' in error message"
        },
        {
          "step": 5,
          "action": "Verify rate limit error creation",
          "expected": "ApiErrors.rateLimited(60) is thrown, setting retryAfter to 60 seconds"
        }
      ],
      "acceptance_criteria": [
        "Rate limit errors return 429 status code",
        "Error code is 'RATE_LIMITED'",
        "Error message tells user how long to wait: 'Try again in 60 seconds'",
        "Error details include retryAfter: 60 (seconds)",
        "Rate limit detection works by checking error.message for 'rate limit' substring",
        "Original OpenAI error is logged to console",
        "Response provides actionable guidance (wait and retry)"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/generate/topic/route.ts",
        "apps/nextjs/src/lib/api-error.ts"
      ],
      "tags": [
        "generation",
        "topic",
        "error-handling",
        "rate-limit",
        "openai"
      ],
      "notes": "Rate limit handling at lines 189-190. ApiErrors.rateLimited(60) sets retryAfter to 60 seconds (line 74-80 in api-error.ts)."
    },
    {
      "id": "TC-GENTOPIC-009",
      "name": "API validates and handles empty AI response edge case",
      "module": "generation_topic",
      "category": "api",
      "type": "edge_case",
      "priority": "high",
      "description": "Validates that API detects when AI returns an empty or invalid slide plan and returns appropriate error",
      "business_context": "Rarely, AI may return empty or malformed responses. System must detect this and fail gracefully rather than returning broken data to users.",
      "preconditions": [
        "User is authenticated",
        "Topic might be too vague or cause AI to return empty plan (edge case)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST request with topic that might cause empty response (e.g., single character: {\"topic\": \"a\"})",
          "expected": "API processes request and calls generateSlidePlan"
        },
        {
          "step": 2,
          "action": "Simulate AI returning empty slides array",
          "expected": "plan.slides is empty or null"
        },
        {
          "step": 3,
          "action": "Verify validation at line 109-111",
          "expected": "Condition (!plan.slides || plan.slides.length === 0) is true"
        },
        {
          "step": 4,
          "action": "Check API response status code",
          "expected": "Response status is 500 Internal Server Error"
        },
        {
          "step": 5,
          "action": "Parse error response",
          "expected": "Response contains: {\"error\": {\"code\": \"INTERNAL_ERROR\", \"message\": \"AI generated empty slide plan\"}}"
        }
      ],
      "acceptance_criteria": [
        "Empty AI response is detected before processing",
        "Error is thrown: ApiErrors.internal('AI generated empty slide plan')",
        "Response status is 500",
        "Error message clearly indicates AI failure, not user error",
        "No slides are returned to client",
        "Console logs the error for debugging",
        "User is not charged/debited if tracking is implemented"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/generate/topic/route.ts"
      ],
      "tags": [
        "generation",
        "topic",
        "edge-case",
        "validation",
        "ai"
      ],
      "notes": "Validation at lines 109-111. This is an edge case that should rarely occur but must be handled to prevent broken carousels."
    },
    {
      "id": "TC-GENTOPIC-010",
      "name": "API handles slide copy/plan length mismatch gracefully",
      "module": "generation_topic",
      "category": "api",
      "type": "edge_case",
      "priority": "medium",
      "description": "Validates that API handles cases where AI's generateSlideCopy returns different number of slides than the plan",
      "business_context": "AI steps might occasionally produce mismatched results. System should handle this gracefully and use fallback data to ensure carousel is still usable.",
      "preconditions": [
        "User is authenticated",
        "AI pipeline steps return mismatched slide counts (rare edge case)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send valid POST request: {\"topic\": \"Test topic\"}",
          "expected": "generateSlidePlan returns plan with N slides"
        },
        {
          "step": 2,
          "action": "Simulate generateSlideCopy returning M slides (M != N)",
          "expected": "copySlides.length !== plan.slides.length"
        },
        {
          "step": 3,
          "action": "Verify warning is logged at lines 117-120",
          "expected": "Console warning: 'Copy length mismatch: expected N, got M'"
        },
        {
          "step": 4,
          "action": "Verify fallback logic at lines 128-132",
          "expected": "For missing copy, slide uses planSlide data: {headline: planSlide.headline, body: planSlide.body, emphasis_text: planSlide.emphasis}"
        },
        {
          "step": 5,
          "action": "Check response status code",
          "expected": "Response status is still 200 OK (graceful degradation)"
        },
        {
          "step": 6,
          "action": "Verify slides array completeness",
          "expected": "All slides have data (some from copy, some from plan as fallback)"
        }
      ],
      "acceptance_criteria": [
        "Mismatch is logged but doesn't throw error",
        "Response is still successful (200 status)",
        "Missing copy slides use plan data as fallback",
        "All slides have valid headline and body arrays",
        "Final slides array length matches plan.slides.length",
        "orderIndex remains sequential (0 to N-1)",
        "Carousel is fully functional despite mismatch"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/generate/topic/route.ts"
      ],
      "tags": [
        "generation",
        "topic",
        "edge-case",
        "resilience"
      ],
      "notes": "Mismatch handling at lines 117-120 (warning) and lines 128-132 (fallback). This graceful degradation ensures users always get a usable carousel."
    },
    {
      "id": "TC-GENTOPIC-011",
      "name": "Layout selection correctly maps slide types to TemplateLayouts",
      "module": "generation_topic",
      "category": "integration",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that selectLayoutsForSlides function correctly maps slide types to appropriate layout IDs from TemplateLayout table",
      "business_context": "Different slide types (hook, promise, value, recap, CTA) need different visual layouts. Correct layout selection ensures slides look professional and match their purpose.",
      "preconditions": [
        "Database has TemplateLayouts seeded with: hook_big_headline, promise_two_column, value_bullets, value_numbered_steps, recap_grid, cta_centered, generic_single_focus"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Generate carousel with default parameters",
          "expected": "AI generates slides with various slideTypes: hook, promise, value, recap, cta"
        },
        {
          "step": 2,
          "action": "Verify hook slide gets appropriate layout",
          "expected": "slideType 'hook' maps to layoutId 'hook_big_headline' (if text < 100 chars) or 'generic_single_focus' (if longer)"
        },
        {
          "step": 3,
          "action": "Verify promise slide gets appropriate layout",
          "expected": "slideType 'promise' maps to layoutId 'promise_two_column'"
        },
        {
          "step": 4,
          "action": "Verify value slides get appropriate layouts",
          "expected": "slideType 'value' maps to 'value_bullets' (if short) or 'value_numbered_steps' (if longer)"
        },
        {
          "step": 5,
          "action": "Verify recap slide gets appropriate layout",
          "expected": "slideType 'recap' maps to layoutId 'recap_grid'"
        },
        {
          "step": 6,
          "action": "Verify CTA slide gets appropriate layout",
          "expected": "slideType 'cta' maps to layoutId 'cta_centered'"
        },
        {
          "step": 7,
          "action": "Verify all layoutIds exist in database",
          "expected": "Query TemplateLayout table confirms all returned layoutIds exist"
        },
        {
          "step": 8,
          "action": "Verify fallback for unknown slide types",
          "expected": "Unknown slideType maps to 'generic_single_focus'"
        }
      ],
      "acceptance_criteria": [
        "All layoutIds in response exist in TemplateLayout table",
        "Layout mappings follow rules defined in LAYOUT_MAPPINGS (openai.ts lines 488-520)",
        "Text length affects layout selection (short content \u2192 simpler layouts)",
        "Hook slides use hook_big_headline or generic_single_focus",
        "Promise slides use promise_two_column",
        "Value slides use value_bullets or value_numbered_steps",
        "Recap slides use recap_grid",
        "CTA slides use cta_centered",
        "Unknown slide types default to generic_single_focus",
        "Layout selection is deterministic (same input \u2192 same output)"
      ],
      "related_files": [
        "apps/nextjs/src/lib/openai.ts",
        "apps/nextjs/src/app/api/generate/topic/route.ts",
        "packages/db/prisma/seed.ts"
      ],
      "tags": [
        "generation",
        "topic",
        "layout",
        "integration"
      ],
      "notes": "Layout selection logic at lines 488-576 in openai.ts. Text length calculated at lines 529-533. LAYOUT_MAPPINGS at lines 488-520."
    },
    {
      "id": "TC-AUTH-001",
      "name": "User can successfully register with valid credentials",
      "module": "auth",
      "user_journey": "new_user_onboarding",
      "category": "frontend",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that new users can create accounts using the Clerk registration flow",
      "business_context": "New users must be able to sign up to use the platform. Registration is the gateway to all platform features.",
      "preconditions": [
        "User is not logged in",
        "User has a valid email address",
        "User's email is not already registered"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to /en/register",
          "expected": "Registration page loads with 'Create your account' heading and Clerk SignUp component"
        },
        {
          "step": 2,
          "action": "Enter valid email address in the Clerk email field",
          "expected": "Email is accepted without validation errors"
        },
        {
          "step": 3,
          "action": "Enter a strong password in the Clerk password field",
          "expected": "Password meets Clerk's strength requirements and is accepted"
        },
        {
          "step": 4,
          "action": "Complete any additional required fields (name, etc.)",
          "expected": "All required information is captured"
        },
        {
          "step": 5,
          "action": "Click the Sign Up button in Clerk component",
          "expected": "Account is created and user is redirected to /en/dashboard"
        },
        {
          "step": 6,
          "action": "Verify dashboard displays with empty state",
          "expected": "User lands on dashboard, Profile record created in database with FREE tier"
        }
      ],
      "acceptance_criteria": [
        "Registration completes within 5 seconds",
        "User is redirected to /en/dashboard after successful signup",
        "Profile record is created in database with clerkUserId",
        "Profile.subscriptionTier defaults to FREE",
        "User's session is active (authenticated)",
        "No error messages are displayed"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(auth)/register/page.tsx",
        "apps/nextjs/src/components/user-clerk-auth-form.tsx",
        "apps/nextjs/src/utils/clerk.ts"
      ],
      "tags": [
        "auth",
        "registration",
        "clerk",
        "core-feature"
      ],
      "notes": "Uses Clerk's built-in SignUp component. Clerk handles email verification if configured."
    },
    {
      "id": "TC-AUTH-002",
      "name": "User can successfully login with valid credentials",
      "module": "auth",
      "user_journey": "returning_user",
      "category": "frontend",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that existing users can log in using the Clerk authentication flow",
      "business_context": "Returning users must be able to access their accounts and projects. Login is required to access any dashboard features.",
      "preconditions": [
        "User has a registered account with valid credentials",
        "User is not currently logged in"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to /en/login-clerk",
          "expected": "Login page loads with 'Welcome back to QuickCarousals' heading and Clerk SignIn component"
        },
        {
          "step": 2,
          "action": "Enter registered email address in email field",
          "expected": "Email is accepted"
        },
        {
          "step": 3,
          "action": "Enter correct password in password field",
          "expected": "Password field accepts input (characters are masked)"
        },
        {
          "step": 4,
          "action": "Click the Sign In button in Clerk component",
          "expected": "Authentication succeeds and user is redirected to /en/dashboard"
        },
        {
          "step": 5,
          "action": "Verify dashboard loads with user's existing projects",
          "expected": "Dashboard displays user's projects, user's name/avatar appears in navigation"
        }
      ],
      "acceptance_criteria": [
        "Login completes within 3 seconds",
        "User is redirected to /en/dashboard after successful login",
        "User's session is active and authenticated",
        "User's projects are visible on dashboard",
        "Back button in top-left navigates to landing page",
        "No error messages are displayed"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(auth)/login-clerk/[[...rest]]/page.tsx",
        "apps/nextjs/src/components/user-clerk-auth-form.tsx",
        "apps/nextjs/src/utils/clerk.ts"
      ],
      "tags": [
        "auth",
        "login",
        "clerk",
        "core-feature"
      ],
      "notes": "Clerk handles password validation and security. Component uses fallbackRedirectUrl prop."
    },
    {
      "id": "TC-AUTH-003",
      "name": "User cannot login with invalid credentials",
      "module": "auth",
      "category": "frontend",
      "type": "error_path",
      "priority": "critical",
      "description": "Validates that users with incorrect credentials cannot gain access to the system",
      "business_context": "Security requires that invalid login attempts are rejected to prevent unauthorized access",
      "preconditions": [
        "User is on the login page",
        "User is not logged in"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to /en/login-clerk",
          "expected": "Login page loads successfully"
        },
        {
          "step": 2,
          "action": "Enter a registered email address",
          "expected": "Email field accepts the input"
        },
        {
          "step": 3,
          "action": "Enter an incorrect password",
          "expected": "Password field accepts the input (masked)"
        },
        {
          "step": 4,
          "action": "Click the Sign In button",
          "expected": "Clerk displays error message: 'Incorrect email or password'"
        },
        {
          "step": 5,
          "action": "Verify user remains on login page",
          "expected": "User is NOT redirected to dashboard, session is NOT created"
        }
      ],
      "acceptance_criteria": [
        "Clear error message is displayed by Clerk",
        "User remains on the login page",
        "No session token is created",
        "User cannot access protected routes",
        "Error message does not reveal whether email exists (security best practice)"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(auth)/login-clerk/[[...rest]]/page.tsx",
        "apps/nextjs/src/components/user-clerk-auth-form.tsx"
      ],
      "tags": [
        "auth",
        "login",
        "error-handling",
        "security"
      ],
      "notes": "Clerk handles the error messaging and security. Error messages should be generic to avoid user enumeration attacks."
    },
    {
      "id": "TC-AUTH-004",
      "name": "Unauthenticated user is redirected to login when accessing protected route",
      "module": "auth",
      "category": "integration",
      "type": "security",
      "priority": "critical",
      "description": "Validates that the middleware correctly protects dashboard routes and redirects unauthenticated users to login",
      "business_context": "Protected routes must be inaccessible without authentication. Users should be seamlessly redirected to login with a return URL.",
      "preconditions": [
        "User is not logged in",
        "User has no active session"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Attempt to navigate directly to /en/dashboard",
          "expected": "Middleware intercepts the request"
        },
        {
          "step": 2,
          "action": "Check the URL after redirect",
          "expected": "User is redirected to /en/login-clerk?from=%2Fen%2Fdashboard"
        },
        {
          "step": 3,
          "action": "Verify login page loads",
          "expected": "Login page displays with Clerk SignIn component"
        },
        {
          "step": 4,
          "action": "After successful login, verify redirect",
          "expected": "User is redirected back to originally requested URL (/en/dashboard)"
        }
      ],
      "acceptance_criteria": [
        "Redirect happens immediately (< 500ms)",
        "Original destination URL is preserved in 'from' query parameter",
        "After login, user is returned to originally requested page",
        "No flash of protected content before redirect",
        "Protected route content is never exposed to unauthenticated users"
      ],
      "related_files": [
        "apps/nextjs/src/utils/clerk.ts",
        "apps/nextjs/src/middleware.ts"
      ],
      "tags": [
        "auth",
        "middleware",
        "security",
        "protected-routes"
      ],
      "notes": "Middleware checks authentication before serving protected pages. Line 119-127 in clerk.ts handles this logic."
    },
    {
      "id": "TC-AUTH-005",
      "name": "Authenticated user accessing login page is redirected to dashboard",
      "module": "auth",
      "category": "frontend",
      "type": "edge_case",
      "priority": "high",
      "description": "Validates that logged-in users cannot access auth pages and are redirected to dashboard",
      "business_context": "Users who are already authenticated should not see login/register pages. This provides a better UX and prevents confusion.",
      "preconditions": [
        "User is already logged in with active session"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to /en/login-clerk while logged in",
          "expected": "Middleware detects user is authenticated"
        },
        {
          "step": 2,
          "action": "Check URL after middleware processing",
          "expected": "User is immediately redirected to /en/dashboard"
        },
        {
          "step": 3,
          "action": "Attempt to navigate to /en/register while logged in",
          "expected": "User is also redirected to /en/dashboard"
        },
        {
          "step": 4,
          "action": "Verify no flash of login form",
          "expected": "Login/register forms are never rendered to authenticated users"
        }
      ],
      "acceptance_criteria": [
        "Redirect happens before any auth form renders",
        "User lands on dashboard without delays",
        "Works for both /login-clerk and /register routes",
        "User's session remains active during redirect",
        "No console errors or warnings"
      ],
      "related_files": [
        "apps/nextjs/src/utils/clerk.ts",
        "apps/nextjs/src/components/user-clerk-auth-form.tsx"
      ],
      "tags": [
        "auth",
        "redirect",
        "edge-case",
        "ux"
      ],
      "notes": "Handled in two places: middleware (line 105-109) and client component (line 24-27 in UserClerkAuthForm)"
    },
    {
      "id": "TC-AUTH-006",
      "name": "API returns 401 Unauthorized when called without authentication",
      "module": "auth",
      "category": "api",
      "type": "security",
      "priority": "critical",
      "description": "Validates that protected API endpoints correctly reject requests without valid authentication",
      "business_context": "API security is critical. All protected endpoints must validate authentication and return proper HTTP status codes for unauthorized access.",
      "preconditions": [
        "User is not logged in",
        "No valid session token in request"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send GET request to /api/projects without Authorization header",
          "expected": "API endpoint receives request"
        },
        {
          "step": 2,
          "action": "Check response status code",
          "expected": "Response status is 401 Unauthorized"
        },
        {
          "step": 3,
          "action": "Check response body",
          "expected": "Response body contains: {\"error\":{\"code\":\"UNAUTHORIZED\",\"message\":\"Authentication required\"}}"
        },
        {
          "step": 4,
          "action": "Verify no data is leaked in response",
          "expected": "Response contains no user data, project data, or sensitive information"
        }
      ],
      "acceptance_criteria": [
        "HTTP status code is exactly 401",
        "Response is JSON with standardized error format",
        "Error code is 'UNAUTHORIZED'",
        "Error message is clear and user-friendly",
        "Response time is under 500ms",
        "No sensitive data is included in error response"
      ],
      "related_files": [
        "apps/nextjs/src/lib/with-auth.ts",
        "apps/nextjs/src/app/api/projects/route.ts"
      ],
      "tags": [
        "auth",
        "api",
        "security",
        "error-handling"
      ],
      "notes": "withAuth middleware (line 28-29 in with-auth.ts) returns 401 when userId is null. Test with curl: curl -s http://localhost:3000/api/projects"
    },
    {
      "id": "TC-AUTH-007",
      "name": "Public routes are accessible without authentication",
      "module": "auth",
      "category": "integration",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that marketing and public pages do not require authentication and load correctly",
      "business_context": "Public pages like landing, pricing, and docs must be accessible to all visitors to drive signups and provide information.",
      "preconditions": [
        "User is not logged in"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to /en (landing page)",
          "expected": "Landing page loads without redirect to login"
        },
        {
          "step": 2,
          "action": "Navigate to /en/pricing",
          "expected": "Pricing page loads without authentication"
        },
        {
          "step": 3,
          "action": "Navigate to /en/terms",
          "expected": "Terms page loads without authentication"
        },
        {
          "step": 4,
          "action": "Navigate to /en/privacy",
          "expected": "Privacy page loads without authentication"
        },
        {
          "step": 5,
          "action": "Verify all public content is accessible",
          "expected": "All pages display their content fully, CTAs are visible, no login prompts appear"
        }
      ],
      "acceptance_criteria": [
        "All public routes load within 2 seconds",
        "No redirects to login page occur",
        "Page content is fully visible and functional",
        "CTA buttons (Sign Up, Get Started) navigate to /register",
        "No console errors related to authentication",
        "Pages work correctly in private/incognito mode"
      ],
      "related_files": [
        "apps/nextjs/src/utils/clerk.ts",
        "apps/nextjs/src/app/[lang]/(marketing)/page.tsx",
        "apps/nextjs/src/app/[lang]/(marketing)/pricing/page.tsx"
      ],
      "tags": [
        "auth",
        "public-routes",
        "marketing"
      ],
      "notes": "isPublicRoute matcher (line 12-20 in clerk.ts) defines routes that bypass authentication. Webhook and health routes are also excluded."
    },
    {
      "id": "TC-AUTH-008",
      "name": "User profile is created in database after first Clerk signup",
      "module": "auth",
      "category": "database",
      "type": "integration",
      "priority": "critical",
      "description": "Validates that user registration creates a Profile record linked to the Clerk user ID",
      "business_context": "The Profile model stores subscription tier and links users to their projects/brand kits. This record must be created for the app to function.",
      "preconditions": [
        "User completes Clerk registration successfully",
        "Clerk webhook is configured and functioning"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Complete registration flow via /en/register",
          "expected": "Clerk creates user account and triggers webhook"
        },
        {
          "step": 2,
          "action": "Query Profile table for record with matching clerkUserId",
          "expected": "Profile record exists with clerkUserId matching Clerk user ID"
        },
        {
          "step": 3,
          "action": "Verify Profile fields are populated correctly",
          "expected": "Profile.email matches user email, Profile.subscriptionTier is FREE, Profile.createdAt is set"
        },
        {
          "step": 4,
          "action": "Attempt to access /api/projects",
          "expected": "API successfully finds Profile record and returns empty projects array"
        }
      ],
      "acceptance_criteria": [
        "Profile record is created within 5 seconds of Clerk signup",
        "Profile.clerkUserId exactly matches Clerk's user.id",
        "Profile.email matches the email used for signup",
        "Profile.subscriptionTier defaults to FREE",
        "Profile.id is a valid UUID generated by gen_random_uuid()",
        "Indexes on clerkUserId and email are functional"
      ],
      "related_files": [
        "packages/db/prisma/schema.prisma",
        "apps/nextjs/src/app/api/webhooks/clerk/route.ts"
      ],
      "tags": [
        "auth",
        "database",
        "clerk",
        "webhooks",
        "integration"
      ],
      "notes": "Profile model lines 46-61 in schema.prisma. Webhook handler should create Profile on user.created event. Check for Clerk webhook configuration."
    },
    {
      "id": "TC-AUTH-009",
      "name": "Logout functionality clears session and redirects to public page",
      "module": "auth",
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that users can successfully log out and their session is completely cleared",
      "business_context": "Users need to be able to securely end their session, especially on shared devices. Logout must clear all authentication state.",
      "preconditions": [
        "User is logged in with active session"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Click logout button in user menu/navigation",
          "expected": "Clerk's signOut() function is called"
        },
        {
          "step": 2,
          "action": "Verify user is redirected after logout",
          "expected": "User is redirected to landing page /en or login page /en/login-clerk"
        },
        {
          "step": 3,
          "action": "Attempt to access /en/dashboard after logout",
          "expected": "User is redirected to login page (session is cleared)"
        },
        {
          "step": 4,
          "action": "Attempt to call /api/projects after logout",
          "expected": "API returns 401 Unauthorized (no valid session)"
        },
        {
          "step": 5,
          "action": "Verify browser/device authentication state",
          "expected": "Clerk session cookies are cleared, no session tokens remain in localStorage"
        }
      ],
      "acceptance_criteria": [
        "Logout completes within 2 seconds",
        "User is redirected to a public page",
        "All session data is cleared (cookies, tokens)",
        "Subsequent requests to protected routes redirect to login",
        "Subsequent API calls return 401",
        "Back button does not restore authenticated state",
        "User must re-authenticate to access protected content"
      ],
      "related_files": [
        "apps/nextjs/src/components/user-menu.tsx",
        "apps/nextjs/src/utils/clerk.ts"
      ],
      "tags": [
        "auth",
        "logout",
        "security",
        "session-management"
      ],
      "notes": "Clerk's useClerk() hook provides signOut() method. Need to verify where logout button is implemented in UI."
    },
    {
      "id": "TC-AUTH-010",
      "name": "Middleware correctly handles locale-based redirects for authenticated users",
      "module": "auth",
      "category": "integration",
      "type": "edge_case",
      "priority": "medium",
      "description": "Validates that authenticated users accessing routes without locale are redirected to localized version",
      "business_context": "The app supports internationalization. All routes should include a locale prefix (e.g., /en/). Middleware must add locale while preserving authentication.",
      "preconditions": [
        "User is logged in"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to /dashboard (without locale prefix)",
          "expected": "Middleware detects missing locale"
        },
        {
          "step": 2,
          "action": "Check redirect URL",
          "expected": "User is redirected to /en/dashboard (or detected locale)"
        },
        {
          "step": 3,
          "action": "Verify authentication is preserved during redirect",
          "expected": "User remains authenticated, session is not lost"
        },
        {
          "step": 4,
          "action": "Test with different Accept-Language header",
          "expected": "Middleware uses browser locale preference when available"
        }
      ],
      "acceptance_criteria": [
        "Routes without locale are redirected to include locale",
        "Default locale is 'en' if no preference detected",
        "Accept-Language header is respected",
        "Session and authentication state are preserved",
        "Redirect happens transparently (< 300ms)",
        "No content flash or double-render occurs"
      ],
      "related_files": [
        "apps/nextjs/src/utils/clerk.ts",
        "apps/nextjs/src/config/i18n-config.ts"
      ],
      "tags": [
        "auth",
        "i18n",
        "middleware",
        "edge-case"
      ],
      "notes": "Lines 64-78 in clerk.ts handle locale detection and redirect. Uses @formatjs/intl-localematcher and Negotiator."
    },
    {
      "id": "TC-GENTEXT-001",
      "name": "Successfully generate carousel from short text (<500 chars)",
      "module": "generation_text",
      "user_journey": "text_to_export",
      "category": "api",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that short text is expanded appropriately into 5-8 slides with added context",
      "business_context": "Users often paste short content (tweets, quotes, brief notes) that needs to be expanded into a full carousel. The system should add context and examples to make each slide valuable.",
      "preconditions": [
        "User is authenticated",
        "OpenAI API is available",
        "Database has TemplateLayouts seeded"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST request to /api/generate/text with short text (300 chars): {\"text\": \"Productivity tip: Time blocking. Schedule specific blocks for deep work, meetings, and breaks. Protect your focus time like it's sacred. Your future self will thank you.\"}",
          "expected": "API accepts request and validates text length is between 10-10,000 chars"
        },
        {
          "step": 2,
          "action": "Verify calculateOptimalSlideCount logic",
          "expected": "For 300 chars, algorithm calculates 5-8 slides (formula: Math.max(5, Math.min(8, Math.ceil(300 / 80))) = 5)"
        },
        {
          "step": 3,
          "action": "Verify createTextPrompt includes SHORT text instructions",
          "expected": "Prompt says: 'The text is SHORT. Your task: Expand the core ideas into 5 slides, Add context and examples where appropriate, Make each slide valuable, not filler'"
        },
        {
          "step": 4,
          "action": "Wait for AI generation to complete",
          "expected": "AI expands the brief content across 5 slides with hook, value content, recap, CTA"
        },
        {
          "step": 5,
          "action": "Check response status and structure",
          "expected": "Status 200, response contains: {slides: [...], metadata: {textLength: 300, tone: 'professional', slideCount: 5}}"
        },
        {
          "step": 6,
          "action": "Verify slides content quality",
          "expected": "Each slide has meaningful content (not just stretched filler), examples are added where appropriate"
        }
      ],
      "acceptance_criteria": [
        "Response status is 200 OK",
        "Slide count is 5 for 300-char text (optimal for short content)",
        "metadata.textLength is 300",
        "metadata.slideCount matches actual slides.length",
        "AI prompt includes SHORT text pacing instructions",
        "Content is expanded thoughtfully (not padded with filler)",
        "Slides follow structure: hook \u2192 value \u2192 recap \u2192 CTA",
        "All layoutIds are valid and exist in database",
        "Response time is under 45 seconds"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/generate/text/route.ts",
        "apps/nextjs/src/lib/openai.ts"
      ],
      "tags": [
        "generation",
        "text",
        "short-text",
        "chunking",
        "core-feature"
      ],
      "notes": "Lines 99-101: short text logic. Lines 122-130: SHORT text prompt instructions. This tests the text expansion capability."
    },
    {
      "id": "TC-GENTEXT-002",
      "name": "Successfully generate carousel from medium text (500-2000 chars)",
      "module": "generation_text",
      "user_journey": "text_to_export",
      "category": "api",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that medium-length text is extracted into 8-12 slides while maintaining original structure",
      "business_context": "Most user-pasted content falls in this range (LinkedIn posts, email newsletters, short blog sections). The system should extract key points without major condensing or expansion.",
      "preconditions": [
        "User is authenticated",
        "OpenAI API is available"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST request with medium text (1200 chars): a short article or newsletter section",
          "expected": "API accepts request"
        },
        {
          "step": 2,
          "action": "Verify calculateOptimalSlideCount logic",
          "expected": "For 1200 chars, algorithm calculates 8-12 slides (formula: Math.max(8, Math.min(12, Math.ceil(1200 / 200))) = 8)"
        },
        {
          "step": 3,
          "action": "Verify createTextPrompt includes MEDIUM text instructions",
          "expected": "Prompt says: 'The text is MEDIUM length. Your task: Extract 8 key points, Maintain the original structure and flow, Add a hook slide at the beginning, End with a recap and CTA'"
        },
        {
          "step": 4,
          "action": "Wait for generation to complete",
          "expected": "AI extracts key points while preserving the original flow and structure"
        },
        {
          "step": 5,
          "action": "Parse response and verify structure",
          "expected": "8 slides with hook, 5-6 value slides, recap, CTA"
        }
      ],
      "acceptance_criteria": [
        "Response status is 200 OK",
        "Slide count is 8-12 for medium text (1200 chars = ~8 slides)",
        "Content maintains original structure and flow",
        "Key points are extracted (not heavily condensed or expanded)",
        "metadata.textLength is accurate",
        "AI prompt includes MEDIUM text pacing instructions",
        "Response time is under 45 seconds"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/generate/text/route.ts"
      ],
      "tags": [
        "generation",
        "text",
        "medium-text",
        "chunking"
      ],
      "notes": "Lines 102-104: medium text logic. Lines 131-138: MEDIUM text prompt. This is the most common text length."
    },
    {
      "id": "TC-GENTEXT-003",
      "name": "Successfully generate carousel from long text (2000-6000 chars)",
      "module": "generation_text",
      "user_journey": "text_to_export",
      "category": "api",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that long text is condensed into 12-15 digestible slides while keeping key insights",
      "business_context": "Users may paste long blog posts or articles. The system must condense while maintaining the most valuable insights and examples.",
      "preconditions": [
        "User is authenticated",
        "OpenAI API is available"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST request with long text (4000 chars): a full blog post or article",
          "expected": "API accepts request"
        },
        {
          "step": 2,
          "action": "Verify calculateOptimalSlideCount logic",
          "expected": "For 4000 chars, algorithm calculates 12-15 slides (formula: Math.max(12, Math.min(15, Math.ceil(4000 / 400))) = 12)"
        },
        {
          "step": 3,
          "action": "Verify createTextPrompt includes LONG text instructions",
          "expected": "Prompt says: 'The text is LONG. Your task: Condense into 12 digestible slides, Focus on the most important insights, Remove redundancy but keep key examples, Create clear hierarchy'"
        },
        {
          "step": 4,
          "action": "Wait for generation to complete",
          "expected": "AI successfully condenses content while preserving key insights"
        },
        {
          "step": 5,
          "action": "Verify content quality",
          "expected": "Slides contain important insights, redundancy is removed, key examples are preserved"
        }
      ],
      "acceptance_criteria": [
        "Response status is 200 OK",
        "Slide count is 12-15 for long text (4000 chars = ~12 slides)",
        "Content is condensed but valuable",
        "Key examples and insights are preserved",
        "Redundancy is removed",
        "Clear hierarchy: hook \u2192 value \u2192 recap \u2192 CTA",
        "AI prompt includes LONG text pacing instructions",
        "Response time is under 50 seconds (longer text = more processing)"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/generate/text/route.ts"
      ],
      "tags": [
        "generation",
        "text",
        "long-text",
        "chunking",
        "condensing"
      ],
      "notes": "Lines 105-107: long text logic. Lines 139-146: LONG text prompt. Tests AI's ability to condense while maintaining value."
    },
    {
      "id": "TC-GENTEXT-004",
      "name": "Successfully generate carousel from very long text (>6000 chars)",
      "module": "generation_text",
      "user_journey": "text_to_export",
      "category": "api",
      "type": "edge_case",
      "priority": "high",
      "description": "Validates that very long text is ruthlessly condensed into 15-20 slides with only critical insights",
      "business_context": "Users may paste entire articles or long-form content. The system must be highly selective to create skimmable, high-impact slides.",
      "preconditions": [
        "User is authenticated",
        "OpenAI API is available"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST request with very long text (8000 chars): a full article or whitepaper",
          "expected": "API accepts request (max is 10,000 chars)"
        },
        {
          "step": 2,
          "action": "Verify calculateOptimalSlideCount logic",
          "expected": "For 8000 chars, algorithm calculates 15-20 slides (formula: Math.max(15, Math.min(20, Math.ceil(8000 / 500))) = 16)"
        },
        {
          "step": 3,
          "action": "Verify createTextPrompt includes VERY LONG text instructions",
          "expected": "Prompt says: 'The text is VERY LONG. Your task: Extract ONLY the most critical insights for 16 slides, Be ruthlessly selective - this is about skimmability, Each slide should be a standalone insight, Condense examples to 1-2 sentences max, Prioritize actionable takeaways'"
        },
        {
          "step": 4,
          "action": "Wait for generation (may take 40-50s due to length)",
          "expected": "AI extracts only the most critical insights, heavily condensing"
        },
        {
          "step": 5,
          "action": "Verify content quality",
          "expected": "Each slide is a standalone insight, examples are 1-2 sentences, highly selective content"
        }
      ],
      "acceptance_criteria": [
        "Response status is 200 OK",
        "Slide count is 15-20 for very long text",
        "Content is ruthlessly selective (not trying to include everything)",
        "Each slide is a standalone, actionable insight",
        "Examples are condensed to 1-2 sentences max",
        "AI prompt includes VERY LONG text pacing instructions",
        "Response time is under 60 seconds",
        "Slides are skimmable and high-impact"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/generate/text/route.ts"
      ],
      "tags": [
        "generation",
        "text",
        "very-long-text",
        "chunking",
        "edge-case"
      ],
      "notes": "Lines 108-111: very long text logic. Lines 147-156: VERY LONG text prompt. This tests extreme condensing capability."
    },
    {
      "id": "TC-GENTEXT-005",
      "name": "API returns 400 validation error for text below minimum length",
      "module": "generation_text",
      "category": "api",
      "type": "error_path",
      "priority": "critical",
      "description": "Validates that the API rejects text shorter than 10 characters with clear validation error",
      "business_context": "Text must have enough content to create meaningful slides. Minimum of 10 characters ensures there's actual content to work with.",
      "preconditions": [
        "User is authenticated"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST request with text shorter than 10 chars: {\"text\": \"Hi there\"}",
          "expected": "Zod validation fails on text.min(10)"
        },
        {
          "step": 2,
          "action": "Check response status code",
          "expected": "Response status is 400 Bad Request"
        },
        {
          "step": 3,
          "action": "Parse error response",
          "expected": "Response contains: {\"error\": {\"code\": \"VALIDATION_ERROR\", \"message\": \"Text must be at least 10 characters\"}}"
        },
        {
          "step": 4,
          "action": "Verify no AI calls were made",
          "expected": "OpenAI API was never called (validation happens first)"
        }
      ],
      "acceptance_criteria": [
        "HTTP status code is 400",
        "Error message clearly states: 'Text must be at least 10 characters'",
        "Error code is 'VALIDATION_ERROR'",
        "Error format is standardized ApiError",
        "Response time is under 200ms (fast validation)",
        "No OpenAI API calls are made",
        "No charges incurred"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/generate/text/route.ts"
      ],
      "tags": [
        "generation",
        "text",
        "validation",
        "error-handling"
      ],
      "notes": "Lines 40-43: text validation schema with min(10). Empty or very short text is rejected at validation layer."
    },
    {
      "id": "TC-GENTEXT-006",
      "name": "API returns 400 validation error for text exceeding maximum length",
      "module": "generation_text",
      "category": "api",
      "type": "error_path",
      "priority": "critical",
      "description": "Validates that the API rejects text longer than 10,000 characters with clear validation error",
      "business_context": "Processing extremely long text is expensive and may timeout. The 10,000 character limit balances usability with API costs and reliability.",
      "preconditions": [
        "User is authenticated"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST request with text longer than 10,000 chars (e.g., 12,000 chars)",
          "expected": "Zod validation fails on text.max(10000)"
        },
        {
          "step": 2,
          "action": "Check response status code",
          "expected": "Response status is 400 Bad Request"
        },
        {
          "step": 3,
          "action": "Parse error response",
          "expected": "Response contains: {\"error\": {\"code\": \"VALIDATION_ERROR\", \"message\": \"Text must be less than 10,000 characters\"}}"
        }
      ],
      "acceptance_criteria": [
        "HTTP status code is 400",
        "Error message clearly states: 'Text must be less than 10,000 characters'",
        "Error code is 'VALIDATION_ERROR'",
        "Response time is under 200ms",
        "No OpenAI API calls are made"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/generate/text/route.ts"
      ],
      "tags": [
        "generation",
        "text",
        "validation",
        "error-handling",
        "limits"
      ],
      "notes": "Lines 40-43: text.max(10000) validation. Protects against excessive API costs and timeouts."
    },
    {
      "id": "TC-GENTEXT-007",
      "name": "Generate carousel with custom slideCount parameter overrides auto-calculation",
      "module": "generation_text",
      "category": "api",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that explicitly provided slideCount overrides the automatic calculation based on text length",
      "business_context": "Users should have control over carousel length. Even with long text, they may want fewer slides for a punchier carousel.",
      "preconditions": [
        "User is authenticated",
        "OpenAI API is available"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST request with long text (4000 chars) but slideCount: 8: {\"text\": \"[4000 char article]\", \"slideCount\": 8}",
          "expected": "API accepts custom slideCount parameter"
        },
        {
          "step": 2,
          "action": "Verify calculateOptimalSlideCount logic respects user input",
          "expected": "Function returns 8 (user's requested count) instead of auto-calculated 12"
        },
        {
          "step": 3,
          "action": "Wait for generation to complete",
          "expected": "AI generates exactly 8 slides (heavier condensing due to user constraint)"
        },
        {
          "step": 4,
          "action": "Verify response structure",
          "expected": "slides.length === 8, metadata.slideCount === 8"
        }
      ],
      "acceptance_criteria": [
        "Custom slideCount overrides auto-calculation",
        "User can request 3-20 slides (wider range than topic generation's 8-12)",
        "AI adapts pacing to fit the requested slide count",
        "metadata.slideCount matches requested count",
        "All slides have valid content (no empty or filler slides)"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/generate/text/route.ts"
      ],
      "tags": [
        "generation",
        "text",
        "parameters",
        "slideCount",
        "user-control"
      ],
      "notes": "Lines 92-96: if requestedCount is provided, it takes precedence. Lines 44-50: slideCount validation allows 3-20."
    },
    {
      "id": "TC-GENTEXT-008",
      "name": "API validates slideCount is within 3-20 range",
      "module": "generation_text",
      "category": "api",
      "type": "error_path",
      "priority": "high",
      "description": "Validates that slideCount parameter is constrained to sensible range (3-20) with validation errors",
      "business_context": "Carousels with <3 slides are too short to be valuable. Carousels with >20 slides are too long for social media platforms and user attention spans.",
      "preconditions": [
        "User is authenticated"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST request with slideCount too low: {\"text\": \"Valid text here\", \"slideCount\": 2}",
          "expected": "Zod validation fails on slideCount.min(3)"
        },
        {
          "step": 2,
          "action": "Check error response",
          "expected": "Status 400, error indicates slideCount must be at least 3"
        },
        {
          "step": 3,
          "action": "Send POST request with slideCount too high: {\"text\": \"Valid text\", \"slideCount\": 25}",
          "expected": "Zod validation fails on slideCount.max(20)"
        },
        {
          "step": 4,
          "action": "Check error response",
          "expected": "Status 400, error indicates slideCount must be at most 20"
        }
      ],
      "acceptance_criteria": [
        "slideCount < 3 returns 400 validation error",
        "slideCount > 20 returns 400 validation error",
        "slideCount between 3-20 is accepted",
        "Error messages are clear and specific",
        "No OpenAI calls are made for invalid slideCount"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/generate/text/route.ts"
      ],
      "tags": [
        "generation",
        "text",
        "validation",
        "slideCount",
        "error-handling"
      ],
      "notes": "Lines 44-50: slideCount validation. Text generation allows 3-20 slides (more flexible than topic's 8-12)."
    },
    {
      "id": "TC-GENTEXT-009",
      "name": "API handles auth requirement and returns 401 for unauthenticated requests",
      "module": "generation_text",
      "category": "api",
      "type": "security",
      "priority": "critical",
      "description": "Validates that text generation is protected and rejects unauthenticated requests",
      "business_context": "Text generation uses expensive OpenAI API credits. Only authenticated users should have access.",
      "preconditions": [
        "User is NOT authenticated"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST request to /api/generate/text without auth headers",
          "expected": "withAuthAndErrors middleware intercepts request"
        },
        {
          "step": 2,
          "action": "Check response status",
          "expected": "Response status is 401 Unauthorized"
        },
        {
          "step": 3,
          "action": "Verify error format",
          "expected": "Response: {\"error\": {\"code\": \"UNAUTHORIZED\", \"message\": \"Authentication required\"}}"
        }
      ],
      "acceptance_criteria": [
        "HTTP status code is 401",
        "Error code is 'UNAUTHORIZED'",
        "Error message is clear",
        "No OpenAI API calls are made",
        "Response time is under 500ms"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/generate/text/route.ts",
        "apps/nextjs/src/lib/with-auth.ts"
      ],
      "tags": [
        "generation",
        "text",
        "security",
        "auth"
      ],
      "notes": "Line 182: withAuthAndErrors wrapper enforces authentication. Same pattern as topic generation."
    },
    {
      "id": "TC-GENTEXT-010",
      "name": "API handles timeout errors gracefully for text generation",
      "module": "generation_text",
      "category": "api",
      "type": "error_path",
      "priority": "high",
      "description": "Validates that API properly handles OpenAI timeout errors with user-friendly messages",
      "business_context": "Long text processing can timeout. Users need clear feedback to retry with shorter text or fewer slides.",
      "preconditions": [
        "User is authenticated",
        "OpenAI API is slow or timing out"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST request with very long text that might cause timeout",
          "expected": "API begins generation"
        },
        {
          "step": 2,
          "action": "Wait for timeout to occur (30 seconds per openai.ts)",
          "expected": "OpenAI request times out"
        },
        {
          "step": 3,
          "action": "Check API response",
          "expected": "Status 500, error message: 'AI generation timed out. Please try again.'"
        }
      ],
      "acceptance_criteria": [
        "Timeout errors return 500 status",
        "Error message is user-friendly and suggests retry",
        "Original error is logged to console",
        "No sensitive information in response",
        "Timeout detection works by checking error.message for 'timeout'"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/generate/text/route.ts",
        "apps/nextjs/src/lib/openai.ts"
      ],
      "tags": [
        "generation",
        "text",
        "error-handling",
        "timeout",
        "openai"
      ],
      "notes": "Lines 296-298: timeout handling. Same pattern as topic generation. Default timeout is 30s."
    },
    {
      "id": "TC-GENTEXT-011",
      "name": "API handles OpenAI rate limit errors with 429 response",
      "module": "generation_text",
      "category": "api",
      "type": "error_path",
      "priority": "high",
      "description": "Validates that API properly handles OpenAI rate limit errors and returns 429 with retry guidance",
      "business_context": "OpenAI rate limits apply across all generation endpoints. Users need clear guidance on when to retry.",
      "preconditions": [
        "User is authenticated",
        "OpenAI rate limit is exceeded"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Trigger rate limit by making rapid requests",
          "expected": "OpenAI returns rate limit error"
        },
        {
          "step": 2,
          "action": "Check API response",
          "expected": "Status 429, error: {\"code\": \"RATE_LIMITED\", \"message\": \"Too many requests. Try again in 60 seconds.\", \"details\": {\"retryAfter\": 60}}"
        }
      ],
      "acceptance_criteria": [
        "Rate limit errors return 429 status",
        "Error code is 'RATE_LIMITED'",
        "Error includes retryAfter: 60 (seconds)",
        "Message tells user how long to wait",
        "Rate limit detection works by checking error.message for 'rate limit'"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/generate/text/route.ts",
        "apps/nextjs/src/lib/api-error.ts"
      ],
      "tags": [
        "generation",
        "text",
        "error-handling",
        "rate-limit",
        "openai"
      ],
      "notes": "Lines 300-302: rate limit handling. Same pattern as topic generation API."
    },
    {
      "id": "TC-GENTEXT-012",
      "name": "Text generation supports brand kit application",
      "module": "generation_text",
      "category": "integration",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that user's brand kit can be applied to slides generated from text",
      "business_context": "Professional users need branded carousels. Brand kit application ensures consistent visual identity whether generating from topic or text.",
      "preconditions": [
        "User is authenticated",
        "User has a BrandKit record with colors, fonts, logoUrl"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST request: {\"text\": \"Valid text content here\", \"applyBrandKit\": true}",
          "expected": "API fetches user's Profile and BrandKit"
        },
        {
          "step": 2,
          "action": "Wait for generation to complete",
          "expected": "Slides are generated normally with brand kit attached"
        },
        {
          "step": 3,
          "action": "Verify brand kit is attached to each slide",
          "expected": "Each slide object contains brandKit: {colors, fonts, logoUrl, handle}"
        }
      ],
      "acceptance_criteria": [
        "When applyBrandKit: true, all slides include brandKit object",
        "brandKit data matches user's BrandKit record",
        "If user has no brand kit, brandKit is null or absent",
        "applyBrandKit defaults to false when not specified",
        "Brand kit lookup queries by Profile.id, ordered by isDefault DESC"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/generate/text/route.ts",
        "packages/db/prisma/schema.prisma"
      ],
      "tags": [
        "generation",
        "text",
        "brand-kit",
        "integration"
      ],
      "notes": "Lines 192-211: brand kit fetching logic. Same implementation as topic generation."
    },
    {
      "id": "TC-GENTEXT-013",
      "name": "Automatic slide count calculation adapts correctly to text length",
      "module": "generation_text",
      "category": "api",
      "type": "edge_case",
      "priority": "medium",
      "description": "Validates that the automatic slide count calculation produces sensible results across all text length ranges",
      "business_context": "The auto-calculation must balance density and readability. Too few slides = overcrowded, too many = lack of focus.",
      "preconditions": [
        "User is authenticated",
        "slideCount is NOT specified in request (testing auto-calculation)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send requests with various text lengths without slideCount parameter",
          "expected": "System auto-calculates optimal slide count for each"
        },
        {
          "step": 2,
          "action": "Test 200 chars (short): verify slide count is 5-8",
          "expected": "Calculated: Math.max(5, Math.min(8, Math.ceil(200 / 80))) = 5"
        },
        {
          "step": 3,
          "action": "Test 1500 chars (medium): verify slide count is 8-12",
          "expected": "Calculated: Math.max(8, Math.min(12, Math.ceil(1500 / 200))) = 10"
        },
        {
          "step": 4,
          "action": "Test 4500 chars (long): verify slide count is 12-15",
          "expected": "Calculated: Math.max(12, Math.min(15, Math.ceil(4500 / 400))) = 13"
        },
        {
          "step": 5,
          "action": "Test 9000 chars (very long): verify slide count is 15-20",
          "expected": "Calculated: Math.max(15, Math.min(20, Math.ceil(9000 / 500))) = 18"
        }
      ],
      "acceptance_criteria": [
        "Short text (<500 chars) generates 5-8 slides",
        "Medium text (500-2000 chars) generates 8-12 slides",
        "Long text (2000-6000 chars) generates 12-15 slides",
        "Very long text (>6000 chars) generates 15-20 slides",
        "Calculation is deterministic (same input = same output)",
        "Slide count never goes below 5 or above 20",
        "metadata.slideCount matches calculated value"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/generate/text/route.ts"
      ],
      "tags": [
        "generation",
        "text",
        "chunking",
        "auto-calculation",
        "edge-case"
      ],
      "notes": "Lines 92-112: calculateOptimalSlideCount function. This is a key differentiator from topic generation."
    },
    {
      "id": "TC-CREATE-001",
      "name": "Create page loads successfully with default state",
      "module": "creation_flow",
      "user_journey": "topic_to_export",
      "category": "frontend",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that the create page loads with correct default UI state and all elements are present",
      "business_context": "The create page is the starting point for all carousel creation. It must load reliably with sensible defaults for a smooth user experience.",
      "preconditions": [
        "User is authenticated and logged in",
        "User navigates to /en/create"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to /en/create",
          "expected": "Page loads with heading 'Create Carousel' and subtitle about LinkedIn carousels"
        },
        {
          "step": 2,
          "action": "Check mode selection buttons",
          "expected": "Two mode buttons are visible: 'From Topic' (\ud83d\udca1) and 'From Text' (\ud83d\udcdd). 'From Topic' is selected by default (primary style)."
        },
        {
          "step": 3,
          "action": "Check input area",
          "expected": "Topic input field is visible with placeholder: 'e.g., 5 ways to improve your LinkedIn engagement'. Character counter shows 0/500."
        },
        {
          "step": 4,
          "action": "Check style kit section",
          "expected": "Style kits load from /api/style-kits. Visual grid of style kit cards appears with color previews."
        },
        {
          "step": 5,
          "action": "Check options section",
          "expected": "Slide count dropdown defaults to 10. Tone dropdown defaults to 'Professional'. Brand kit toggle is off by default."
        },
        {
          "step": 6,
          "action": "Check generate button state",
          "expected": "Generate button is disabled (input is empty). Button text: '\u2728 Generate Carousel'."
        }
      ],
      "acceptance_criteria": [
        "Page loads within 2 seconds",
        "All UI elements are visible and properly styled",
        "Default mode is 'topic'",
        "Default slide count is 10",
        "Default tone is 'professional'",
        "Brand kit toggle is off by default",
        "Generate button is disabled when input is empty",
        "No console errors on page load",
        "Style kits API is called on mount"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/create/page.tsx"
      ],
      "tags": [
        "creation-flow",
        "ui",
        "page-load",
        "core-feature"
      ],
      "notes": "Lines 29-43: component state initialization. Lines 45-58: style kits fetch. Lines 61-74: project count fetch for limit checks."
    },
    {
      "id": "TC-CREATE-002",
      "name": "User can switch between Topic and Text modes",
      "module": "creation_flow",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that mode switching correctly shows/hides appropriate input fields",
      "business_context": "Users need to choose between topic-based and text-based generation. The UI must clearly show which mode is active and display the correct input.",
      "preconditions": [
        "User is on /en/create page"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Verify Topic mode is selected by default",
          "expected": "Topic button has primary styling, topic input field is visible"
        },
        {
          "step": 2,
          "action": "Click the 'From Text' mode button",
          "expected": "Text button becomes primary styled, Topic button becomes outline styled"
        },
        {
          "step": 3,
          "action": "Verify input field changes",
          "expected": "Topic input field is hidden, text textarea appears with placeholder 'Paste your text, notes, or draft content here...'. Character counter shows 0/10,000."
        },
        {
          "step": 4,
          "action": "Enter some text in textarea",
          "expected": "Text is accepted, character counter updates"
        },
        {
          "step": 5,
          "action": "Switch back to 'From Topic' mode",
          "expected": "Textarea is hidden, topic input field reappears"
        },
        {
          "step": 6,
          "action": "Verify entered text is preserved",
          "expected": "Switching back to Text mode shows the previously entered text (component state is preserved)"
        }
      ],
      "acceptance_criteria": [
        "Mode switching is instant (< 100ms)",
        "Active mode has primary button styling",
        "Inactive mode has outline button styling",
        "Correct input field is displayed for each mode",
        "Character limits are correct: 500 for topic, 10,000 for text",
        "User input is preserved when switching modes",
        "No visual glitches during transition",
        "Generate button validation updates based on active mode"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/create/page.tsx"
      ],
      "tags": [
        "creation-flow",
        "ui",
        "mode-switching"
      ],
      "notes": "Lines 32: mode state. Lines 218-249: mode selection UI. Lines 252-280: conditional input rendering. Lines 186-188: mode-specific validation."
    },
    {
      "id": "TC-CREATE-003",
      "name": "Topic input validates character count and enables generate button",
      "module": "creation_flow",
      "user_journey": "topic_to_export",
      "category": "frontend",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that topic input provides real-time character counting and controls button state",
      "business_context": "Users need immediate feedback on input length to know if they're within limits. The generate button should only be enabled when input is valid.",
      "preconditions": [
        "User is on /en/create in Topic mode"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Verify initial state",
          "expected": "Topic input is empty, counter shows 0/500, generate button is disabled"
        },
        {
          "step": 2,
          "action": "Type 'A' into topic input",
          "expected": "Counter updates to 1/500, generate button becomes enabled (minimum 1 char)"
        },
        {
          "step": 3,
          "action": "Continue typing until 250 characters",
          "expected": "Counter shows 250/500, input continues to accept characters"
        },
        {
          "step": 4,
          "action": "Type until reaching 500 characters",
          "expected": "Counter shows 500/500, input stops accepting more characters (maxLength enforced)"
        },
        {
          "step": 5,
          "action": "Clear the input field",
          "expected": "Counter returns to 0/500, generate button becomes disabled again"
        }
      ],
      "acceptance_criteria": [
        "Character counter updates in real-time (no lag)",
        "Generate button is disabled when topic is empty",
        "Generate button is enabled when topic has at least 1 character",
        "Input enforces 500 character maximum (maxLength attribute)",
        "Counter format is 'X/500 characters'",
        "No console errors during typing",
        "Validation is client-side (no API calls)"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/create/page.tsx"
      ],
      "tags": [
        "creation-flow",
        "validation",
        "input",
        "topic"
      ],
      "notes": "Lines 33: topic state. Lines 254-264: topic input with maxLength={500}. Line 264: character counter. Lines 186-188: isValid check (topic.trim().length > 0)."
    },
    {
      "id": "TC-CREATE-004",
      "name": "Text input validates character count and minimum length",
      "module": "creation_flow",
      "user_journey": "text_to_export",
      "category": "frontend",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that text input enforces minimum length (10 chars) and shows character count",
      "business_context": "Text generation requires at least 10 characters. Users need clear feedback when their input is too short.",
      "preconditions": [
        "User is on /en/create in Text mode"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Switch to Text mode",
          "expected": "Textarea appears with counter showing 0/10,000"
        },
        {
          "step": 2,
          "action": "Type 'Hello' (5 characters)",
          "expected": "Counter shows 5/10,000, generate button is disabled (< 10 chars)"
        },
        {
          "step": 3,
          "action": "Type 'Hello there' (11 characters)",
          "expected": "Counter shows 11/10,000, generate button becomes enabled (>= 10 chars)"
        },
        {
          "step": 4,
          "action": "Paste a long article (8000 characters)",
          "expected": "Counter shows 8000/10,000, textarea accepts content, button is enabled"
        },
        {
          "step": 5,
          "action": "Attempt to paste content exceeding 10,000 characters",
          "expected": "Textarea enforces 10,000 character maximum, counter shows 10,000/10,000"
        }
      ],
      "acceptance_criteria": [
        "Generate button is disabled when text length < 10 characters",
        "Generate button is enabled when text length >= 10 characters",
        "Character counter updates in real-time",
        "Textarea enforces 10,000 character maximum (maxLength attribute)",
        "Minimum height of textarea is 200px for good UX",
        "Counter format is 'X/10,000 characters'",
        "Validation matches API requirements (10-10,000 chars)"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/create/page.tsx"
      ],
      "tags": [
        "creation-flow",
        "validation",
        "input",
        "text"
      ],
      "notes": "Lines 34: text state. Lines 267-278: textarea with maxLength={10000}. Line 278: character counter. Lines 186-188: isValid check (text.trim().length >= 10)."
    },
    {
      "id": "TC-CREATE-005",
      "name": "User can select from available style kits based on subscription tier",
      "module": "creation_flow",
      "user_journey": null,
      "category": "frontend",
      "type": "integration",
      "priority": "high",
      "description": "Validates that style kit selection works and respects tier-based access",
      "business_context": "Free users see limited style kits, premium users see all. Visual selection should be intuitive with color previews.",
      "preconditions": [
        "User is on /en/create",
        "Style kits have loaded from API",
        "User has a FREE tier subscription"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Observe style kit grid",
          "expected": "Grid displays style kit cards (2 cols on mobile, 4 cols on desktop). Each card shows color preview."
        },
        {
          "step": 2,
          "action": "Check which style kits are visible",
          "expected": "Only non-premium style kits are visible (3 kits for FREE tier: minimal_clean, bold_modern, elegant_serif)"
        },
        {
          "step": 3,
          "action": "Verify premium kit message",
          "expected": "Below the grid, a purple banner says: '\ud83c\udfa8 Unlock all X style kits with Creator or Pro. Upgrade now'"
        },
        {
          "step": 4,
          "action": "Click a free style kit card",
          "expected": "Card gets primary border and bg-primary/5 background. Previously selected card loses selection styling."
        },
        {
          "step": 5,
          "action": "Hover over an unselected kit",
          "expected": "Card border changes to gray-400, shadow-lg appears, color preview scales slightly (hover effects)"
        },
        {
          "step": 6,
          "action": "Test with PRO tier user",
          "expected": "All style kits are visible, including premium ones with 'PRO' badge. No upgrade banner shown."
        }
      ],
      "acceptance_criteria": [
        "Style kits load from /api/style-kits on mount",
        "Free users see only 3 free style kits",
        "Premium users (Creator/Pro) see all 8 style kits",
        "Each kit card shows color preview (background + accent)",
        "Premium kits have purple 'PRO' badge",
        "Selected kit has primary border styling",
        "Upgrade prompt appears for FREE users if premium kits exist",
        "Upgrade prompt links to /settings/billing",
        "Default selection is 'minimal_clean' (line 37)"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/create/page.tsx",
        "apps/nextjs/src/hooks/use-subscription.ts"
      ],
      "tags": [
        "creation-flow",
        "style-kits",
        "feature-gating",
        "ui"
      ],
      "notes": "Lines 37: selectedStyleKit state. Lines 45-58: style kit fetch. Lines 84-88: availableStyleKits filter. Lines 295-335: style kit grid UI."
    },
    {
      "id": "TC-CREATE-006",
      "name": "Slide count dropdown respects subscription tier limits",
      "module": "creation_flow",
      "user_journey": null,
      "category": "frontend",
      "type": "integration",
      "priority": "high",
      "description": "Validates that slide count options are filtered based on user's tier limits",
      "business_context": "Free tier allows max 8 slides, Creator allows 15, Pro allows 20. UI must only show valid options for the user's tier.",
      "preconditions": [
        "User is on /en/create",
        "useSubscription hook has fetched tier information"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Check slide count dropdown as FREE tier user",
          "expected": "Dropdown only shows option: '8 slides' (FREE tier max is 8)"
        },
        {
          "step": 2,
          "action": "Verify upgrade message appears",
          "expected": "Below dropdown: 'Your plan allows up to 8 slides. Upgrade for more.' (link to /settings/billing)"
        },
        {
          "step": 3,
          "action": "Test as CREATOR tier user",
          "expected": "Dropdown shows options from 8-15 slides (CREATOR tier max is 15)"
        },
        {
          "step": 4,
          "action": "Test as PRO tier user",
          "expected": "Dropdown shows options from 8-20 slides. No upgrade message appears."
        },
        {
          "step": 5,
          "action": "Select different slide counts",
          "expected": "Selection updates slideCount state, no errors, value persists when switching modes"
        }
      ],
      "acceptance_criteria": [
        "FREE tier: only shows 8 slides option",
        "CREATOR tier: shows 8-15 slides",
        "PRO tier: shows 8-20 slides",
        "Dropdown filters options based on maxSlides = subscription.getLimit('slides')",
        "Upgrade message shown when tier !== PRO and maxSlides < 20",
        "Default value is 10 (or max allowed if less than 10)",
        "Selection state persists when switching between Topic/Text modes"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/create/page.tsx",
        "apps/nextjs/src/hooks/use-subscription.ts"
      ],
      "tags": [
        "creation-flow",
        "feature-gating",
        "subscription",
        "slide-count"
      ],
      "notes": "Lines 35: slideCount state default 10. Line 91: maxSlides = subscription.getLimit('slides'). Lines 350: dropdown with filter(count => count <= maxSlides). Lines 354-358: upgrade message."
    },
    {
      "id": "TC-CREATE-007",
      "name": "Free tier user sees carousel limit warning when limit is reached",
      "module": "creation_flow",
      "user_journey": null,
      "category": "frontend",
      "type": "feature_gating",
      "priority": "critical",
      "description": "Validates that users at their carousel limit see a warning banner and cannot generate",
      "business_context": "Free tier allows 3 carousels. When limit is reached, users must upgrade. Clear messaging prevents confusion.",
      "preconditions": [
        "User is FREE tier",
        "User has created 3 carousels (at limit)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to /en/create",
          "expected": "Page loads and fetches project count from /api/projects"
        },
        {
          "step": 2,
          "action": "Check for warning banner",
          "expected": "Yellow warning card appears at top: '\u26a0\ufe0f Carousel Limit Reached'. Shows '3 of 3 carousels' on FREE plan."
        },
        {
          "step": 3,
          "action": "Read warning message",
          "expected": "Message: 'You've created 3 of 3 carousels allowed on your FREE plan.'"
        },
        {
          "step": 4,
          "action": "Check upgrade button",
          "expected": "Button labeled 'Upgrade to Create More' links to /settings/billing"
        },
        {
          "step": 5,
          "action": "Enter valid topic and click Generate",
          "expected": "Error appears: 'You've reached your limit of 3 carousels. Upgrade to create more.' Generation is blocked."
        },
        {
          "step": 6,
          "action": "Test with user at 2/3 carousels",
          "expected": "No warning banner appears, generation works normally"
        }
      ],
      "acceptance_criteria": [
        "Warning banner only appears when projectCount >= carouselLimit",
        "Banner has yellow background (bg-yellow-50 border-yellow-200)",
        "Warning emoji \u26a0\ufe0f is visible",
        "Upgrade button has data-testid='upgrade_prompt'",
        "Generate button is blocked when limit reached (line 95-98)",
        "Error message is clear and includes the limit number",
        "PRO tier users never see this warning (carouselLimit = -1 = unlimited)",
        "CREATOR tier users see warning at 30 carousels"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/create/page.tsx",
        "apps/nextjs/src/hooks/use-subscription.ts"
      ],
      "tags": [
        "creation-flow",
        "feature-gating",
        "limits",
        "upgrade-prompt",
        "critical"
      ],
      "notes": "Lines 61-74: project count fetch. Line 77: carouselLimit = subscription.getLimit('carousels'). Line 78: hasReachedCarouselLimit check. Lines 198-215: warning banner UI. Lines 94-98: generation blocking logic."
    },
    {
      "id": "TC-CREATE-008",
      "name": "User cannot select premium style kit without Creator/Pro tier",
      "module": "creation_flow",
      "user_journey": null,
      "category": "frontend",
      "type": "error_path",
      "priority": "high",
      "description": "Validates that attempting to use a premium style kit without proper tier shows error",
      "business_context": "Premium style kits are a Creator/Pro feature. If a FREE user somehow selects a premium kit, generation should fail with clear error.",
      "preconditions": [
        "User is FREE tier",
        "Premium style kits exist in database"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Manually set selectedStyleKit to a premium kit ID (e.g., via browser devtools or direct state manipulation)",
          "expected": "Component state updates to premium kit ID"
        },
        {
          "step": 2,
          "action": "Enter valid topic and attempt to generate",
          "expected": "canAccessStyleKit check fails (line 82)"
        },
        {
          "step": 3,
          "action": "Check error message",
          "expected": "Error displayed: 'This style kit requires a Creator or Pro subscription.' (line 102)"
        },
        {
          "step": 4,
          "action": "Verify generation is blocked",
          "expected": "No API calls to /api/generate/* are made, loading state never activates"
        }
      ],
      "acceptance_criteria": [
        "canAccessStyleKit logic correctly checks: !selectedKit?.isPremium || subscription.tier !== 'FREE'",
        "Error message is clear and mentions required tier",
        "Error appears in red banner (bg-red-50 border-red-200)",
        "Generation is blocked before API calls",
        "CREATOR and PRO users can use premium kits without error",
        "UI prevents selection in normal flow (premium kits filtered out), but handles edge cases"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/create/page.tsx"
      ],
      "tags": [
        "creation-flow",
        "feature-gating",
        "error-handling",
        "style-kits"
      ],
      "notes": "Lines 81-82: canAccessStyleKit check. Lines 100-104: style kit access validation. Lines 84-88: availableStyleKits filter prevents normal selection."
    },
    {
      "id": "TC-CREATE-009",
      "name": "Generation flow successfully creates project and navigates to editor",
      "module": "creation_flow",
      "user_journey": "topic_to_export",
      "category": "integration",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates the complete happy path: user enters topic, generates, project is created, slides are saved, and user is redirected to editor",
      "business_context": "This is the core creation flow. All steps must succeed for users to create carousels. Any failure blocks the primary use case.",
      "preconditions": [
        "User is authenticated",
        "User is on /en/create in Topic mode",
        "User has not reached carousel limit",
        "OpenAI API is available"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Enter topic: '5 productivity tips for remote workers'",
          "expected": "Topic input updates, generate button becomes enabled"
        },
        {
          "step": 2,
          "action": "Select tone: 'Bold', slide count: 10, style kit: 'minimal_clean'",
          "expected": "Options update in component state"
        },
        {
          "step": 3,
          "action": "Click 'Generate Carousel' button",
          "expected": "Loading state activates: button shows spinner and 'Generating your carousel...' (animated pulse)"
        },
        {
          "step": 4,
          "action": "Wait for API Step 1: AI generation",
          "expected": "POST /api/generate/topic is called with {topic, slideCount: 10, tone: 'bold', applyBrandKit: false, styleKitId: 'minimal_clean'}"
        },
        {
          "step": 5,
          "action": "Verify AI generation completes",
          "expected": "API returns 200 with {slides: [...], metadata: {...}}. 10 slides with layoutIds, content, etc."
        },
        {
          "step": 6,
          "action": "Wait for API Step 2: Project creation",
          "expected": "POST /api/projects is called with {title: '5 productivity tips for remote workers', styleKitId: 'minimal_clean'}"
        },
        {
          "step": 7,
          "action": "Verify project is created",
          "expected": "API returns 201 with project object containing id, title, userId, styleKitId"
        },
        {
          "step": 8,
          "action": "Wait for API Step 3: Slides creation",
          "expected": "10 POST /api/slides requests are made in parallel (Promise.all), one for each slide"
        },
        {
          "step": 9,
          "action": "Verify all slides are created",
          "expected": "All slide creation requests return 201, slides are linked to project.id"
        },
        {
          "step": 10,
          "action": "Wait for navigation",
          "expected": "router.push is called with /en/editor/{project.id}. User is redirected to editor page."
        },
        {
          "step": 11,
          "action": "Verify editor loads",
          "expected": "Editor page loads with the newly created project and all 10 slides visible"
        }
      ],
      "acceptance_criteria": [
        "Loading state activates immediately on button click",
        "Generate button is disabled during loading",
        "All 3 API steps complete successfully in sequence",
        "Total flow completes within 60 seconds (AI generation is slow)",
        "User is redirected to /en/editor/{projectId}",
        "No errors are displayed during flow",
        "No console errors occur",
        "Loading spinner and pulse animation are visible during generation",
        "Button shows data-testid='generation_loading' during loading"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/create/page.tsx",
        "apps/nextjs/src/app/api/generate/topic/route.ts",
        "apps/nextjs/src/app/api/projects/route.ts",
        "apps/nextjs/src/app/api/slides/route.ts"
      ],
      "tags": [
        "creation-flow",
        "integration",
        "generation",
        "critical",
        "e2e"
      ],
      "notes": "Lines 93-184: handleGenerate function. Step 1 (lines 116-134): AI generation. Step 2 (lines 136-155): project creation. Step 3 (lines 157-176): slides creation. Step 4 (line 179): navigation. This is the primary happy path for carousel creation."
    },
    {
      "id": "TC-CREATE-010",
      "name": "Loading state displays correctly during generation",
      "module": "creation_flow",
      "user_journey": "topic_to_export",
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that loading indicators provide clear feedback during the 30-60 second generation process",
      "business_context": "AI generation takes 30-60 seconds. Users need visual feedback to know the system is working and not frozen.",
      "preconditions": [
        "User is on /en/create with valid input"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Click Generate button",
          "expected": "Immediately: loading state sets to true, button content changes"
        },
        {
          "step": 2,
          "action": "Observe button content",
          "expected": "Spinner icon (rotating circle SVG with animate-spin class) appears"
        },
        {
          "step": 3,
          "action": "Check loading text",
          "expected": "Text 'Generating your carousel...' appears with animate-pulse class (pulsing animation)"
        },
        {
          "step": 4,
          "action": "Verify button is disabled",
          "expected": "Button has disabled attribute, opacity-50 class, cursor-not-allowed. User cannot click again."
        },
        {
          "step": 5,
          "action": "Check data-testid",
          "expected": "Loading span has data-testid='generation_loading' for test targeting"
        },
        {
          "step": 6,
          "action": "Wait for generation to complete or error",
          "expected": "Loading state persists until success (redirect) or error (setLoading(false) at line 182)"
        }
      ],
      "acceptance_criteria": [
        "Loading state activates immediately on click (no delay)",
        "Spinner SVG has animate-spin class (rotation animation)",
        "Text has animate-pulse class (pulsing animation)",
        "Button is disabled during loading (disabled={!isValid || loading})",
        "Button shows opacity-50 and cursor-not-allowed",
        "Loading indicators remain visible until redirect or error",
        "data-testid='generation_loading' is present for testing",
        "No way to trigger multiple simultaneous generations"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/create/page.tsx"
      ],
      "tags": [
        "creation-flow",
        "loading",
        "ux",
        "ui"
      ],
      "notes": "Lines 40: loading state. Line 112: setLoading(true). Line 182: setLoading(false) on error. Lines 416-429: loading UI with spinner and pulse animations. Line 414: disabled={!isValid || loading}."
    },
    {
      "id": "TC-CREATE-011",
      "name": "Error messages display correctly when generation fails",
      "module": "creation_flow",
      "user_journey": null,
      "category": "frontend",
      "type": "error_path",
      "priority": "high",
      "description": "Validates that generation errors are caught and displayed to users with helpful messages",
      "business_context": "Generation can fail for many reasons (AI timeout, rate limits, network errors). Users need clear error messages to understand what went wrong.",
      "preconditions": [
        "User is on /en/create with valid input"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Simulate AI generation failure (e.g., OpenAI timeout or rate limit)",
          "expected": "fetch() to /api/generate/topic throws error or returns non-ok status"
        },
        {
          "step": 2,
          "action": "Check error handling",
          "expected": "catch block at line 180-183 executes"
        },
        {
          "step": 3,
          "action": "Verify error state updates",
          "expected": "setError() is called with error message from API response or generic message"
        },
        {
          "step": 4,
          "action": "Verify loading state resets",
          "expected": "setLoading(false) is called (line 182), button returns to normal state"
        },
        {
          "step": 5,
          "action": "Check error display",
          "expected": "Red error banner appears above generate button: bg-red-50 border-red-200 with error text"
        },
        {
          "step": 6,
          "action": "Verify error message content",
          "expected": "Message extracted from errorData.error?.message or fallback message like 'Generation failed'"
        },
        {
          "step": 7,
          "action": "Test error dismissal",
          "expected": "Clicking Generate again clears error (setError(null) at line 113) before retrying"
        }
      ],
      "acceptance_criteria": [
        "All fetch errors are caught in try-catch blocks",
        "Error messages are extracted from API responses when available",
        "Fallback messages used when API error format is unexpected",
        "Error banner is red (bg-red-50 border-red-200 text-red-700)",
        "Error banner appears at lines 402-407",
        "Loading state resets on error (button becomes clickable again)",
        "Error clears on next generation attempt",
        "Console.error logs full error for debugging",
        "No unhandled promise rejections"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/create/page.tsx"
      ],
      "tags": [
        "creation-flow",
        "error-handling",
        "ux"
      ],
      "notes": "Lines 41: error state. Lines 128-131: generation error handling. Lines 150-153: project creation error. Lines 180-183: top-level catch. Lines 402-407: error display UI. Line 113: error cleared on retry."
    },
    {
      "id": "TC-CREATE-012",
      "name": "Brand kit toggle correctly includes/excludes brand kit in API request",
      "module": "creation_flow",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "medium",
      "description": "Validates that the brand kit toggle controls whether applyBrandKit parameter is sent to generation API",
      "business_context": "Users can choose to apply their brand colors/fonts/logo or use default styling. This toggle must correctly pass the preference to the API.",
      "preconditions": [
        "User is on /en/create",
        "User has a brand kit configured (or doesn't - should work either way)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Verify brand kit toggle initial state",
          "expected": "Toggle is off by default (applyBrandKit = false, line 39)"
        },
        {
          "step": 2,
          "action": "Check toggle UI",
          "expected": "Toggle switch appears with label 'Apply Brand Kit' and description 'Use your brand colors, fonts, logo, and handle'"
        },
        {
          "step": 3,
          "action": "Click the toggle to turn it on",
          "expected": "Toggle visual state changes: peer-checked:bg-primary, switch slides right"
        },
        {
          "step": 4,
          "action": "Verify state update",
          "expected": "applyBrandKit state updates to true"
        },
        {
          "step": 5,
          "action": "Enter valid topic and generate",
          "expected": "API request body includes applyBrandKit: true (line 119)"
        },
        {
          "step": 6,
          "action": "Turn toggle off and generate again",
          "expected": "API request body includes applyBrandKit: false"
        },
        {
          "step": 7,
          "action": "Verify toggle works in both Topic and Text modes",
          "expected": "applyBrandKit parameter is included in both /api/generate/topic and /api/generate/text requests"
        }
      ],
      "acceptance_criteria": [
        "Toggle defaults to off (applyBrandKit: false)",
        "Toggle has data-testid='brand_kit_toggle' (line 392)",
        "Toggle visual state matches boolean state (checked attribute)",
        "Toggle is accessible (keyboard navigable, screen reader friendly)",
        "State persists when switching between Topic/Text modes",
        "API request correctly includes applyBrandKit parameter",
        "Works regardless of whether user has a brand kit configured",
        "Toggle appears in gradient gray card (bg-gradient-to-br from-gray-50 to-gray-100)"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/create/page.tsx"
      ],
      "tags": [
        "creation-flow",
        "brand-kit",
        "ui",
        "parameters"
      ],
      "notes": "Lines 39: applyBrandKit state. Lines 379-400: brand kit toggle UI. Lines 119, 120: applyBrandKit included in API requests for both topic and text modes."
    },
    {
      "id": "TC-CREATE-013",
      "name": "Tone selector correctly updates and sends tone to API",
      "module": "creation_flow",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "medium",
      "description": "Validates that tone selection dropdown works and sends correct tone value to generation API",
      "business_context": "Tone affects the style and voice of generated content. Users must be able to select from 4 options and have their choice respected.",
      "preconditions": [
        "User is on /en/create"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Check tone dropdown initial state",
          "expected": "Dropdown shows 'Professional' (default, line 36)"
        },
        {
          "step": 2,
          "action": "Click the tone dropdown",
          "expected": "Dropdown opens with 4 options: Professional, Bold, Calm, Contrarian"
        },
        {
          "step": 3,
          "action": "Select 'Bold'",
          "expected": "Dropdown closes, selected value shows 'Bold', tone state updates to 'bold'"
        },
        {
          "step": 4,
          "action": "Generate carousel with Bold tone",
          "expected": "API request includes tone: 'bold' in request body (line 119)"
        },
        {
          "step": 5,
          "action": "Test all 4 tone options",
          "expected": "All options ('professional', 'bold', 'calm', 'contrarian') work and update state correctly"
        },
        {
          "step": 6,
          "action": "Verify tone persists when switching modes",
          "expected": "Tone selection is preserved when switching between Topic and Text modes"
        }
      ],
      "acceptance_criteria": [
        "Dropdown defaults to 'professional'",
        "Dropdown has data-testid='tone_selector' (line 366)",
        "All 4 tone values are available: professional, bold, calm, contrarian",
        "Dropdown has proper styling: border-2, focus:border-primary, hover:border-gray-400",
        "Selected tone is sent to both /api/generate/topic and /api/generate/text",
        "Tone matches API enum: 'bold' | 'calm' | 'contrarian' | 'professional'",
        "State persists across mode switches"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/create/page.tsx"
      ],
      "tags": [
        "creation-flow",
        "tone",
        "ui",
        "parameters"
      ],
      "notes": "Lines 36: tone state with type assertion. Lines 362-376: tone selector dropdown. Lines 119, 120: tone included in API requests. Matches API validation in generate endpoints."
    },
    {
      "id": "TC-EDCANVAS-001",
      "name": "Canvas renders with correct dimensions and scaling",
      "module": "editor_canvas",
      "user_journey": "topic_to_export",
      "category": "frontend",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that the Konva canvas initializes with correct fixed dimensions (1080x1350) and scales responsively to fit container",
      "business_context": "The canvas must render at LinkedIn portrait format (1080x1350) and scale down to fit the editor viewport without distortion. This is critical for accurate slide preview.",
      "preconditions": [
        "User is authenticated and on editor page",
        "A project with slides exists and is loaded",
        "Editor page has mounted and EditorCanvas component is rendered"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to editor page at /en/editor/[projectId]",
          "expected": "Editor page loads with EditorCanvas component visible"
        },
        {
          "step": 2,
          "action": "Inspect the canvas element using browser DevTools",
          "expected": "Konva Stage element exists with data-testid='canvas_surface'"
        },
        {
          "step": 3,
          "action": "Check Stage width and height attributes",
          "expected": "Stage is scaled to fit container while maintaining 1080x1350 aspect ratio (4:5)"
        },
        {
          "step": 4,
          "action": "Verify zoom controls render at top of canvas",
          "expected": "Zoom slider (50-200%) and Fit to Screen button are visible and functional"
        },
        {
          "step": 5,
          "action": "Resize browser window to different widths",
          "expected": "Canvas scales responsively, maintaining aspect ratio, never exceeds 1:1 scale"
        }
      ],
      "acceptance_criteria": [
        "Canvas surface div has data-testid='canvas_surface'",
        "Konva Stage maintains 4:5 aspect ratio (1080:1350)",
        "Base scale calculation: min(containerWidth/1080, containerHeight/1350, 1)",
        "Canvas never upscales beyond 1:1 (no pixelation)",
        "Zoom slider shows 100% by default",
        "Canvas background is white (#fff), container background is gray (#f5f5f5)",
        "No console errors on mount"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/EditorCanvas.tsx"
      ],
      "tags": [
        "editor",
        "canvas",
        "konva",
        "rendering",
        "critical"
      ],
      "notes": "Fixed canvas dimensions are CANVAS_WIDTH=1080, CANVAS_HEIGHT=1350 (lines 18-19). Scale calculation happens in useEffect (lines 37-65). The canvas uses react-konva Stage and Layer components."
    },
    {
      "id": "TC-EDCANVAS-002",
      "name": "User can click text box to enter edit mode",
      "module": "editor_canvas",
      "user_journey": "topic_to_export",
      "category": "frontend",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that clicking a text layer on the canvas activates inline editing with a textarea overlay",
      "business_context": "Text editing is the primary user interaction in the editor. Users must be able to click any text element to modify its content inline, preserving the visual context.",
      "preconditions": [
        "User is on editor page with a slide loaded",
        "Slide contains at least one text_box layer with content",
        "Canvas has finished rendering"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Hover over a text element (headline or body) on the canvas",
          "expected": "Cursor changes to 'text' cursor (line 215 onMouseEnter)"
        },
        {
          "step": 2,
          "action": "Click on the text element",
          "expected": "Text element triggers onClick handler (line 204), calls onTextBoxClick with layerId and position"
        },
        {
          "step": 3,
          "action": "Verify editor overlay appears",
          "expected": "Textarea overlay appears at exact position of clicked text, with correct width and height (lines 391-428)"
        },
        {
          "step": 4,
          "action": "Check textarea content",
          "expected": "Textarea is pre-filled with current text content, auto-focused, and selected"
        },
        {
          "step": 5,
          "action": "Verify editing UI elements appear below textarea",
          "expected": "Rewrite menu button appears with \u2728 Rewrite label (data-testid='rewrite_menu')"
        }
      ],
      "acceptance_criteria": [
        "Textarea appears at scaled canvas coordinates (position * scale)",
        "Textarea matches text box dimensions exactly",
        "Textarea has blue border (2px solid #3b82f6) indicating active state",
        "Textarea is auto-focused and content is editable",
        "If content is array (bullets), lines are joined with \\n",
        "Rewrite menu button is enabled and clickable",
        "editingLayerId state is set to the clicked layer's id",
        "No other text boxes are editable simultaneously"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/EditorCanvas.tsx",
        "apps/nextjs/src/components/editor/LayerRenderer.tsx"
      ],
      "tags": [
        "editor",
        "text-editing",
        "interaction",
        "critical"
      ],
      "notes": "handleTextBoxClick (lines 68-77) converts canvas coords to screen coords. editPosition is calculated with scale factor. Array content is joined with \\n for editing (lines 136-137)."
    },
    {
      "id": "TC-EDCANVAS-003",
      "name": "Text changes propagate to parent component via onContentChange",
      "module": "editor_canvas",
      "user_journey": "topic_to_export",
      "category": "frontend",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that typing in the textarea editor updates the slide content and triggers the parent's onContentChange callback",
      "business_context": "Content changes must be propagated up to the editor page for auto-save and state management. This ensures users don't lose work.",
      "preconditions": [
        "User has clicked on a text box and editor overlay is visible",
        "Textarea is focused and contains text",
        "onContentChange prop is defined in parent component"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Type new text in the textarea (e.g., change 'Old Headline' to 'New Headline')",
          "expected": "onChange handler fires on every keystroke (line 405)"
        },
        {
          "step": 2,
          "action": "Verify handleContentChange is called",
          "expected": "handleContentChange (lines 80-90) is invoked with new content string"
        },
        {
          "step": 3,
          "action": "Check array content preservation",
          "expected": "If original content was array (bullets), new content is split by \\n and filtered (line 86)"
        },
        {
          "step": 4,
          "action": "Verify onContentChange callback is invoked",
          "expected": "onContentChange prop function is called with (layerId, newContent) - line 89"
        },
        {
          "step": 5,
          "action": "Check slide content updates in parent state",
          "expected": "Parent component updates slide.content[layerId] with new value"
        }
      ],
      "acceptance_criteria": [
        "onChange fires on every character typed",
        "String content remains string after edit",
        "Array content (bullets) is split by \\n and filtered to remove empty lines",
        "onContentChange is called with correct layerId and newContent",
        "No lag or debounce on typing (immediate update)",
        "Undo/redo preserves content structure (string vs array)",
        "No console errors during typing"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/EditorCanvas.tsx"
      ],
      "tags": [
        "editor",
        "text-editing",
        "state-management",
        "critical"
      ],
      "notes": "handleContentChange (lines 80-90) preserves array structure by checking Array.isArray(layerContent). Split logic: content.split('\\n').filter(line => line.trim())."
    },
    {
      "id": "TC-EDCANVAS-004",
      "name": "User can close editor by clicking outside or pressing Escape",
      "module": "editor_canvas",
      "user_journey": "topic_to_export",
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that the inline text editor can be dismissed by clicking the canvas background or pressing Escape key",
      "business_context": "Users need an intuitive way to exit edit mode without losing changes. Clicking outside or Escape are standard UX patterns.",
      "preconditions": [
        "User is in edit mode with textarea overlay visible",
        "Text content has been modified (optional)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Press the Escape key while textarea is focused",
          "expected": "onKeyDown handler fires (line 411), detects Escape key, closes editor"
        },
        {
          "step": 2,
          "action": "Re-enter edit mode on same text box",
          "expected": "Editor overlay appears again"
        },
        {
          "step": 3,
          "action": "Click on the canvas background (gray area, not a text box)",
          "expected": "handleStageClick fires (lines 93-99), detects click on Stage background"
        },
        {
          "step": 4,
          "action": "Verify editor overlay closes",
          "expected": "editingLayerId set to null, editPosition set to null (lines 96-97)"
        },
        {
          "step": 5,
          "action": "Verify changes are preserved",
          "expected": "Content changes made before closing are still present in slide data"
        }
      ],
      "acceptance_criteria": [
        "Escape key closes editor immediately",
        "Clicking canvas background closes editor",
        "Clicking another text box switches editing context (closes current, opens new)",
        "onBlur event on textarea also closes editor (line 406-409)",
        "All UI overlays (textarea, rewrite menu) disappear when closed",
        "editingLayerId and editPosition states are both null after close",
        "No orphaned UI elements remain visible"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/EditorCanvas.tsx"
      ],
      "tags": [
        "editor",
        "text-editing",
        "ux",
        "interaction"
      ],
      "notes": "Three ways to close: Escape key (line 411-414), onBlur (line 406-409), click stage background (line 95). handleStageClick checks e.target === e.target.getStage() to detect background click."
    },
    {
      "id": "TC-EDCANVAS-005",
      "name": "Zoom slider adjusts canvas scale from 50% to 200%",
      "module": "editor_canvas",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that the zoom slider control allows users to zoom in/out from 50% to 200% while maintaining aspect ratio",
      "business_context": "Users need to zoom in for detailed text editing and zoom out for full slide preview. Zoom range of 50-200% balances usability and performance.",
      "preconditions": [
        "User is on editor page with canvas rendered",
        "Zoom controls are visible at top of canvas"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Locate zoom slider (data-testid='zoom_slider') at top of canvas",
          "expected": "Slider is visible with range 50-200, current value 100% (default)"
        },
        {
          "step": 2,
          "action": "Drag slider to 50%",
          "expected": "handleZoomChange fires (line 102-105), setZoom(50) called"
        },
        {
          "step": 3,
          "action": "Verify canvas scales down",
          "expected": "Scale recalculates: baseScale * (50/100). Canvas appears smaller, entire slide visible"
        },
        {
          "step": 4,
          "action": "Drag slider to 200%",
          "expected": "setZoom(200) called, scale recalculates: baseScale * (200/100)"
        },
        {
          "step": 5,
          "action": "Verify canvas scales up",
          "expected": "Canvas appears larger (2x zoom), may overflow container (enabling pan)"
        },
        {
          "step": 6,
          "action": "Check zoom percentage display",
          "expected": "Text label next to slider shows '200%' in bold (line 307)"
        }
      ],
      "acceptance_criteria": [
        "Slider min=50, max=200, step=1 (implicit)",
        "Default zoom is 100%",
        "Zoom percentage text updates in real-time as slider moves",
        "Canvas scale formula: baseScale * (zoom / 100) - line 51",
        "Aspect ratio is always maintained (no distortion)",
        "At 50%, full slide fits easily in viewport",
        "At 200%, canvas is 2x larger than 100%, enabling pan",
        "Zoom does not affect canvas logical size (always 1080x1350)",
        "Text remains sharp at all zoom levels"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/EditorCanvas.tsx"
      ],
      "tags": [
        "editor",
        "zoom",
        "canvas",
        "interaction"
      ],
      "notes": "zoom state (line 31) default is 100. handleZoomChange (lines 102-105) parses int value. Scale calculation in useEffect (lines 37-65) applies zoom factor to baseScale."
    },
    {
      "id": "TC-EDCANVAS-006",
      "name": "Fit to Screen button resets zoom and pan to defaults",
      "module": "editor_canvas",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that clicking Fit to Screen resets zoom to 100% and pan to (0,0), centering the canvas",
      "business_context": "Users who zoom/pan extensively need a quick way to reset to the default view without manually adjusting controls.",
      "preconditions": [
        "User has zoomed to any value other than 100%",
        "User may have panned the canvas (if zoom > 100%)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Zoom canvas to 150% using slider",
          "expected": "Canvas scales to 150%, may overflow viewport"
        },
        {
          "step": 2,
          "action": "Pan the canvas by dragging (if zoom > 100%)",
          "expected": "Canvas position shifts, pan state updates (x, y values change)"
        },
        {
          "step": 3,
          "action": "Click 'Fit to Screen' button (data-testid='fit_screen_button')",
          "expected": "handleFitToScreen fires (lines 108-111)"
        },
        {
          "step": 4,
          "action": "Verify zoom resets to 100%",
          "expected": "setZoom(100) called, slider position returns to center (100%)"
        },
        {
          "step": 5,
          "action": "Verify pan resets to origin",
          "expected": "setPan({x: 0, y: 0}) called, canvas re-centers in viewport"
        }
      ],
      "acceptance_criteria": [
        "Zoom slider returns to 100%",
        "Canvas centers in viewport (no pan offset)",
        "Transition is smooth (0.2s ease - line 359)",
        "Button shows hover effects (darker blue, shadow, translateY)",
        "Canvas scale matches initial load state",
        "Keyboard shortcut Cmd+0 also triggers fit (tooltip on button)",
        "No jarring jumps or flickers during reset"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/EditorCanvas.tsx"
      ],
      "tags": [
        "editor",
        "zoom",
        "pan",
        "ux",
        "interaction"
      ],
      "notes": "handleFitToScreen (lines 108-111) is a simple reset: setZoom(100), setPan({x:0, y:0}). Button has hover effects (lines 325-334). Tooltip says 'Fit to screen (Cmd+0)' but keyboard shortcut not yet implemented."
    },
    {
      "id": "TC-EDCANVAS-007",
      "name": "User can pan canvas when zoomed beyond 100%",
      "module": "editor_canvas",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that when canvas is zoomed beyond 100%, user can click-and-drag to pan around the canvas",
      "business_context": "At high zoom levels, only part of the canvas fits in viewport. Panning allows users to view and edit different areas without zooming out.",
      "preconditions": [
        "Canvas is zoomed to > 100% (e.g., 150%)",
        "User is NOT in text editing mode (no text box selected)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Zoom canvas to 150% using slider",
          "expected": "Canvas exceeds viewport size, cursor changes to 'grab' when hovering canvas area"
        },
        {
          "step": 2,
          "action": "Press mouse down on canvas area (not on a text box)",
          "expected": "handleMouseDown fires (line 114-120), setIsPanning(true), cursor changes to 'grabbing'"
        },
        {
          "step": 3,
          "action": "Drag mouse in any direction while holding button",
          "expected": "handleMouseMove fires (line 122-129), setPan updates with new x, y offsets"
        },
        {
          "step": 4,
          "action": "Release mouse button",
          "expected": "handleMouseUp fires (line 131-133), setIsPanning(false), cursor returns to 'grab'"
        },
        {
          "step": 5,
          "action": "Verify canvas position changed",
          "expected": "Canvas div has transform: translate({pan.x}px, {pan.y}px) - line 358"
        }
      ],
      "acceptance_criteria": [
        "Panning only works when zoom > 100% (line 116 check)",
        "Panning disabled when text editor is active (line 116 check: !editingLayerId)",
        "Cursor shows 'grab' when zoom > 100 and not panning (line 349)",
        "Cursor shows 'grabbing' while actively panning (line 349)",
        "Cursor shows 'default' when zoom <= 100% (line 349)",
        "Pan offset persists after release (state maintained)",
        "Pan is smooth with no transition during drag (transition: 'none' - line 359)",
        "onMouseLeave also stops panning (line 354)"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/EditorCanvas.tsx"
      ],
      "tags": [
        "editor",
        "pan",
        "zoom",
        "interaction"
      ],
      "notes": "Pan logic: handleMouseDown (lines 114-120), handleMouseMove (122-129), handleMouseUp (131-133). Pan only enabled if zoom > 100 AND !editingLayerId. Pan calculation: e.clientX - panStart.x."
    },
    {
      "id": "TC-EDCANVAS-008",
      "name": "Text overflow is detected and indicated with red border",
      "module": "editor_canvas",
      "user_journey": "topic_to_export",
      "category": "frontend",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that when text content exceeds the text box bounds (even at minimum font size), a red border indicator appears and Fix with AI button shows",
      "business_context": "Users need immediate visual feedback when text is too long to fit. Overflow prevents proper export and must be fixed before finalizing slides.",
      "preconditions": [
        "User is editing a text box",
        "Slide has styleKit and blueprint with text_box layer constraints (min_font, max_font, position)",
        "measureText utility is working (browser environment)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Click on a text box and enter excessive text (e.g., 500+ characters in a small headline)",
          "expected": "Text content updates in slide state"
        },
        {
          "step": 2,
          "action": "Trigger overflow detection via checkIfOverflows function (line 181-214)",
          "expected": "checkIfOverflows calculates text height at min_font size using measureText (line 202-208)"
        },
        {
          "step": 3,
          "action": "Verify overflow calculation",
          "expected": "If measurement.height > layer.position.height, returns true (line 210)"
        },
        {
          "step": 4,
          "action": "Check canvas rendering in LayerRenderer",
          "expected": "textFit.overflow is true, red border Rect appears around text box (lines 229-240 in LayerRenderer)"
        },
        {
          "step": 5,
          "action": "Verify Fix with AI button appears below rewrite menu",
          "expected": "currentTextOverflows is true (line 216), Fix with AI button renders (lines 653-701)"
        }
      ],
      "acceptance_criteria": [
        "Overflow detection uses measureText from ~/lib/text-measure (line 202)",
        "Measurement checks text at min_font size (worst case)",
        "Red border is 3px solid #ef4444 (line 235 in LayerRenderer)",
        "Red border wraps exact text box position and dimensions",
        "Fix with AI button has red background (#ef4444) to match overflow indicator",
        "Overflow indicator has name='overflow_indicator' for testing",
        "Fix with AI button shows \u2728 Fix with AI label (line 697)",
        "No overflow detection on server (line 189 check: typeof window === 'undefined')"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/EditorCanvas.tsx",
        "apps/nextjs/src/components/editor/LayerRenderer.tsx",
        "apps/nextjs/src/lib/text-measure.ts"
      ],
      "tags": [
        "editor",
        "text-overflow",
        "validation",
        "critical"
      ],
      "notes": "checkIfOverflows (lines 181-214) finds layer in blueprint, determines font (headline vs body), calls measureText at min_font. LayerRenderer auto-calculates optimal fontSize (lines 152-186) but still renders overflow indicator if text doesn't fit."
    },
    {
      "id": "TC-EDCANVAS-009",
      "name": "Fix with AI shortens overflowing text to fit bounds",
      "module": "editor_canvas",
      "user_journey": "topic_to_export",
      "category": "integration",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that clicking Fix with AI when text overflows calls the rewrite API with 'shorter' action and maxWords=12 to condense text",
      "business_context": "Users need a quick AI-powered solution to fix overflow issues without manually rewriting. This saves time and ensures professional quality.",
      "preconditions": [
        "User is editing a text box with overflowing text",
        "Red overflow indicator is visible around text box",
        "Fix with AI button is visible and enabled",
        "/api/rewrite endpoint is functional"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Click Fix with AI button (data-testid='fix_with_ai_button')",
          "expected": "handleFixWithAI fires (lines 219-253), setIsFixingWithAI(true)"
        },
        {
          "step": 2,
          "action": "Verify API request is sent",
          "expected": "POST /api/rewrite with body: {text: editingText, action: 'shorter', maxWords: 12}"
        },
        {
          "step": 3,
          "action": "Button shows loading state during API call",
          "expected": "Button is disabled, background changes to gray (#9ca3af), shows spinner animation and 'Fixing...' text"
        },
        {
          "step": 4,
          "action": "Wait for API response (2-5 seconds)",
          "expected": "Response contains: {rewritten_text: '...'} - shortened version of original"
        },
        {
          "step": 5,
          "action": "Verify content updates with rewritten text",
          "expected": "handleContentChange called with data.rewritten_text (line 245)"
        },
        {
          "step": 6,
          "action": "Check overflow is resolved",
          "expected": "Red border disappears, Fix with AI button hides, text fits within bounds"
        }
      ],
      "acceptance_criteria": [
        "Fix with AI only appears when currentTextOverflows is true (line 653)",
        "API call includes maxWords: 12 for tight condensing (line 233)",
        "Action is hardcoded to 'shorter' (line 232)",
        "Button shows loading state: spinner + 'Fixing...' text during request",
        "Button is disabled (cursor: not-allowed) during request",
        "On success, textarea content updates to rewritten_text",
        "On error, alert shows: 'Failed to fix text. Please try again.' (line 249)",
        "isFixingWithAI resets to false in finally block (line 251)",
        "No duplicate requests if clicked multiple times (button disabled)"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/EditorCanvas.tsx",
        "apps/nextjs/src/app/api/rewrite/route.ts"
      ],
      "tags": [
        "editor",
        "ai",
        "rewrite",
        "text-overflow"
      ],
      "notes": "handleFixWithAI (lines 219-253) is a specialized version of handleRewriteAction but specifically for overflow fixing. Uses maxWords: 12 (line 233) to aggressively shorten text for headlines."
    },
    {
      "id": "TC-EDCANVAS-010",
      "name": "Rewrite menu displays 4 action options and calls API correctly",
      "module": "editor_canvas",
      "user_journey": "topic_to_export",
      "category": "integration",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that the Rewrite menu displays 4 AI rewrite actions (shorter, punchier, examples, reduce_jargon) and successfully calls the rewrite API for each",
      "business_context": "Users need quick AI-powered text improvements during editing. The rewrite menu provides 4 common transformations without leaving the editor.",
      "preconditions": [
        "User is editing a text box (textarea overlay visible)",
        "Rewrite menu button is visible and enabled",
        "/api/rewrite endpoint is functional"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Click Rewrite menu button (data-testid='rewrite_menu')",
          "expected": "setShowRewriteMenu(true) fires (line 436), dropdown menu appears (lines 480-647)"
        },
        {
          "step": 2,
          "action": "Verify menu contains 4 options",
          "expected": "4 buttons visible: Make Shorter (data-testid='rewrite_shorter'), Make Punchier (rewrite_punchier), Add Examples (rewrite_examples), Reduce Jargon (rewrite_jargon)"
        },
        {
          "step": 3,
          "action": "Click 'Make Punchier' option",
          "expected": "handleRewriteAction('punchier') fires (line 144-178), menu closes, setRewritingAction('punchier')"
        },
        {
          "step": 4,
          "action": "Verify API request sent",
          "expected": "POST /api/rewrite with body: {text: editingText, action: 'punchier'}"
        },
        {
          "step": 5,
          "action": "Check loading state",
          "expected": "Rewrite button shows spinner + 'Rewriting...' text (lines 459-476), button disabled"
        },
        {
          "step": 6,
          "action": "Wait for response and verify content updates",
          "expected": "handleContentChange called with data.rewritten_text (line 170), textarea updates"
        },
        {
          "step": 7,
          "action": "Repeat for other 3 actions (shorter, examples, reduce_jargon)",
          "expected": "Each action sends correct API request and updates content"
        }
      ],
      "acceptance_criteria": [
        "Rewrite menu button is blue (#3b82f6) when idle, gray (#9ca3af) when loading",
        "Menu displays 4 options with emojis: \u2702\ufe0f Make Shorter, \ud83d\udca5 Make Punchier, \ud83d\udcdd Add Examples, \ud83d\udd27 Reduce Jargon",
        "Each option has hover effect: light blue background (#f0f9ff), padding shifts left",
        "Clicking option closes menu immediately (line 148)",
        "API action matches clicked option: 'shorter' | 'punchier' | 'examples' | 'reduce_jargon'",
        "Only current text (editingText) is sent, not entire slide",
        "Loading state prevents multiple simultaneous rewrites (button disabled)",
        "Backdrop click closes menu without triggering action (lines 483-499)",
        "On API error, alert shows: 'Failed to rewrite text. Please try again.' (line 174)"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/EditorCanvas.tsx",
        "apps/nextjs/src/app/api/rewrite/route.ts"
      ],
      "tags": [
        "editor",
        "ai",
        "rewrite",
        "text-editing"
      ],
      "notes": "handleRewriteAction (lines 144-178) is generic handler for all 4 actions. Each button has data-testid for testing (lines 527, 559, 591, 623). Menu has z-index: 1000, backdrop has z-index: 999."
    },
    {
      "id": "TC-EDCANVAS-011",
      "name": "LayerRenderer auto-fits text within bounds using binary search",
      "module": "editor_canvas",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that LayerRenderer automatically calculates optimal font size to fit text within text_box bounds using calculateOptimalFontSize",
      "business_context": "Text must auto-scale to fit within designer-defined bounds. This ensures all text is readable without manual font size adjustment.",
      "preconditions": [
        "Slide has text_box layers with min_font and max_font constraints",
        "Text content is populated in slide.content",
        "measureText utility is working"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Load slide with text_box layer containing content",
          "expected": "TextBoxComponent mounts, useEffect fires for auto-fit (lines 152-186 in LayerRenderer)"
        },
        {
          "step": 2,
          "action": "Verify calculateOptimalFontSize is called",
          "expected": "calculateOptimalFontSize called with rawContent, font options, min_font, max_font (lines 156-168)"
        },
        {
          "step": 3,
          "action": "Check binary search algorithm executes",
          "expected": "Binary search in calculateOptimalFontSize (text-measure.ts lines 176-192) finds largest fontSize where text fits"
        },
        {
          "step": 4,
          "action": "Verify text renders at calculated fontSize",
          "expected": "textFit.fontSize state updates, Text component renders with fontSize={textFit.fontSize} (line 196)"
        },
        {
          "step": 5,
          "action": "Test with different content lengths",
          "expected": "Short text uses max_font, long text uses smaller size, very long text uses min_font (may overflow)"
        }
      ],
      "acceptance_criteria": [
        "Auto-fit only runs in browser (typeof window !== 'undefined' check - line 153)",
        "Binary search finds optimal fontSize in O(log n) time",
        "Font size is between min_font and max_font inclusive",
        "Text uses calculated fontSize, not hardcoded value",
        "Font family respects headline vs body distinction (lines 133-143)",
        "Brand kit fonts override styleKit fonts if present (lines 134-140)",
        "Line height from styleKit.spacingRules.line_height is applied (line 146)",
        "If text overflows even at min_font, overflow indicator appears",
        "Auto-fit recalculates on content change (useEffect deps - line 186)"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/LayerRenderer.tsx",
        "apps/nextjs/src/lib/text-measure.ts"
      ],
      "tags": [
        "editor",
        "text-rendering",
        "auto-fit",
        "critical"
      ],
      "notes": "calculateOptimalFontSize uses binary search (text-measure.ts lines 176-192). useEffect (lines 152-186) triggers on text, rawContent, layer, fontFamily, fontWeight, lineHeight changes. textFit state (line 113) stores {fontSize, overflow}."
    },
    {
      "id": "TC-EDCANVAS-012",
      "name": "Brand kit logo and handle render correctly on canvas",
      "module": "editor_canvas",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that when a slide has an associated brand kit, the logo appears in top-right corner and handle appears at bottom-center",
      "business_context": "Brand kits allow users to add their branding to slides. Logo and handle must appear consistently positioned on all slides.",
      "preconditions": [
        "Slide has brandKit prop with logoUrl and handle defined",
        "Logo image URL is valid and accessible"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Load slide with brandKit containing logoUrl and handle",
          "expected": "LayerRenderer receives brandKit prop (line 32)"
        },
        {
          "step": 2,
          "action": "Verify logo image loads",
          "expected": "useImage hook loads logoImage (line 34), image loads successfully"
        },
        {
          "step": 3,
          "action": "Check logo renders at top-right",
          "expected": "KonvaImage component renders at x=940, y=20 with size 120x120 (lines 69-77)"
        },
        {
          "step": 4,
          "action": "Verify handle renders at bottom-center",
          "expected": "Text component renders '@{handle}' at x=540, y=1310 (lines 80-92)"
        },
        {
          "step": 5,
          "action": "Check brand kit colors apply",
          "expected": "Background uses brandKit.colors.primary if present, else styleKit.colors.background (line 41)"
        },
        {
          "step": 6,
          "action": "Verify handle color uses brand kit accent",
          "expected": "Handle text fill uses brandKit.colors.accent || styleKit.colors.accent (line 88)"
        }
      ],
      "acceptance_criteria": [
        "Logo appears only if brandKit.logoUrl exists and image loads",
        "Logo is exactly 120x120px (lines 74-75)",
        "Logo position: x=940 (1080 - 120 - 20 padding), y=20 (line 72-73)",
        "Handle appears only if brandKit.handle exists",
        "Handle includes '@' prefix (line 84)",
        "Handle position: x=540 (center), y=1310 (near bottom), offsetX=80 to center (line 90)",
        "Handle font: 16px Inter, weight 600 (lines 85-87)",
        "Brand colors override styleKit colors (primary, accent)",
        "Logo loads with 'anonymous' CORS mode for cross-origin images (line 34)"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/LayerRenderer.tsx"
      ],
      "tags": [
        "editor",
        "brand-kit",
        "rendering",
        "logo"
      ],
      "notes": "useImage hook (line 34) from 'use-image' library handles async image loading. Logo positioning calculation: 1080 - 120 (width) - 20 (padding) = 940. Handle offsetX centers the text (line 90)."
    },
    {
      "id": "TC-EDCANVAS-013",
      "name": "Watermark renders for free tier users on canvas",
      "module": "editor_canvas",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "medium",
      "description": "Validates that when showWatermark prop is true (free tier), a QuickCarousals.com watermark appears at bottom center of canvas",
      "business_context": "Free tier users have watermarked exports to incentivize upgrades. The watermark must be visible but not obtrusive.",
      "preconditions": [
        "User is on free tier (subscription tier validation happens in parent)",
        "showWatermark prop is passed as true to EditorCanvas"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Load editor with showWatermark=true prop",
          "expected": "EditorCanvas receives showWatermark prop (line 21), passes to LayerRenderer (line 382)"
        },
        {
          "step": 2,
          "action": "Verify watermark Text component renders",
          "expected": "Watermark renders at x=540, y=1320 with text 'QuickCarousals.com' (lines 95-106)"
        },
        {
          "step": 3,
          "action": "Check watermark styling",
          "expected": "Font: 14px Inter, fill: rgba(0,0,0,0.4) - semi-transparent black (lines 100-102)"
        },
        {
          "step": 4,
          "action": "Verify watermark position",
          "expected": "Centered horizontally (x=540, offsetX=70), near bottom (y=1320), below brand handle if present"
        },
        {
          "step": 5,
          "action": "Test with showWatermark=false",
          "expected": "Watermark component does not render (line 95 conditional)"
        }
      ],
      "acceptance_criteria": [
        "Watermark only renders if showWatermark is true (line 95)",
        "Watermark text is 'QuickCarousals.com' (line 99)",
        "Watermark is semi-transparent (40% opacity - line 102)",
        "Watermark is centered horizontally (offsetX=70 - line 104)",
        "Watermark is positioned at y=1320 (10px below handle at y=1310)",
        "Watermark font is 14px (smaller than handle's 16px - line 100)",
        "Watermark appears on all slides in project if showWatermark=true",
        "Watermark is included in exported PNG/PDF (rendered on canvas)"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/LayerRenderer.tsx"
      ],
      "tags": [
        "editor",
        "watermark",
        "free-tier",
        "rendering"
      ],
      "notes": "showWatermark prop is defined in EditorCanvasProps (line 14) and LayerRendererProps (line 15). Watermark renders last so it appears on top of other layers. Y-position: handle at 1310, watermark at 1320 (10px spacing)."
    },
    {
      "id": "TC-EDCANVAS-014",
      "name": "Text box handles bullet points with disc and numbered styles",
      "module": "editor_canvas",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that text_box layers with bulletStyle render bullet points correctly (\u2022 disc or 1. numbered) from array content",
      "business_context": "Value slides use bullet points to list key information. Bullet style must match the slide type and enhance readability.",
      "preconditions": [
        "Slide has text_box layer with bulletStyle: 'disc' or 'numbered'",
        "Layer content is string[] array (e.g., ['Point 1', 'Point 2', 'Point 3'])"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Load slide with text_box layer where bulletStyle='disc' and content is array",
          "expected": "TextBoxComponent receives layer and content (line 111)"
        },
        {
          "step": 2,
          "action": "Verify bullet formatting for disc style",
          "expected": "Each line is prefixed with '\u2022 ' (lines 122-123: text = layerContent.map(line => `\u2022 ${line}`).join('\\n'))"
        },
        {
          "step": 3,
          "action": "Load slide with bulletStyle='numbered'",
          "expected": "Each line is prefixed with number (lines 120-121: text = layerContent.map((line, i) => `${i+1}. ${line}`).join('\\n'))"
        },
        {
          "step": 4,
          "action": "Test editing bullets in textarea",
          "expected": "Array content is joined with \\n for editing (line 137), split back to array on save (EditorCanvas line 86)"
        },
        {
          "step": 5,
          "action": "Verify no bullet style (undefined)",
          "expected": "Array lines are joined with \\n, no prefix added (line 125)"
        }
      ],
      "acceptance_criteria": [
        "bulletStyle='disc' adds '\u2022 ' prefix to each line",
        "bulletStyle='numbered' adds '1. ', '2. ', etc. (1-indexed)",
        "bulletStyle undefined or null renders plain lines (no prefix)",
        "Bullet formatting happens in LayerRenderer, not stored in database",
        "Array content preserves order (orderIndex maintained)",
        "Empty lines in array are not filtered during rendering (only during save - EditorCanvas line 86)",
        "Bullets render with correct font, size, color (same as body text)",
        "Auto-fit calculates height including bullet prefixes"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/LayerRenderer.tsx",
        "apps/nextjs/src/components/editor/EditorCanvas.tsx"
      ],
      "tags": [
        "editor",
        "bullets",
        "text-rendering"
      ],
      "notes": "Bullet formatting (lines 118-126 in LayerRenderer). Array content (lines 118-119): rawContent = layerContent, then format text with bullets. When saving, EditorCanvas (line 86) splits by \\n and filters empty lines."
    },
    {
      "id": "TC-EDCANVAS-015",
      "name": "Canvas handles empty or missing slide data gracefully",
      "module": "editor_canvas",
      "user_journey": null,
      "category": "frontend",
      "type": "edge_case",
      "priority": "medium",
      "description": "Validates that EditorCanvas does not crash when slide prop is undefined or has missing/empty content",
      "business_context": "Editor must handle loading states and missing data gracefully without breaking the UI. Users should see an empty canvas, not an error page.",
      "preconditions": [
        "EditorCanvas component is mounted",
        "slide prop may be undefined, null, or have empty content/blueprint"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Render EditorCanvas with slide=undefined",
          "expected": "Canvas renders empty (line 375 conditional: {slide && <LayerRenderer ... />})"
        },
        {
          "step": 2,
          "action": "Verify no crash or console errors",
          "expected": "Stage and Layer render, but no LayerRenderer, no text boxes"
        },
        {
          "step": 3,
          "action": "Render with slide={} (empty object)",
          "expected": "LayerRenderer attempts to render but layers array is undefined, map fails safely"
        },
        {
          "step": 4,
          "action": "Render with slide={blueprint: {layers: []}, content: {}, styleKit: {...}}",
          "expected": "Canvas renders white background, no text boxes, no errors"
        },
        {
          "step": 5,
          "action": "Verify zoom and pan controls still work",
          "expected": "Zoom slider, fit to screen, pan functionality all work even with empty slide"
        }
      ],
      "acceptance_criteria": [
        "slide=undefined renders empty canvas with zoom controls",
        "No console errors: 'Cannot read property X of undefined'",
        "No React error boundaries triggered",
        "Zoom controls remain functional",
        "Canvas shows white background (Stage) with gray container (#f5f5f5)",
        "No overflow indicators or text boxes render",
        "Clicking canvas background does nothing (no crash)",
        "LayerRenderer handles layers=undefined with optional chaining or default []"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/EditorCanvas.tsx",
        "apps/nextjs/src/components/editor/LayerRenderer.tsx"
      ],
      "tags": [
        "editor",
        "error-handling",
        "edge-case",
        "robustness"
      ],
      "notes": "Line 375: {slide && <LayerRenderer ... />} prevents LayerRenderer from rendering if slide is undefined. LayerRenderer should handle layers.map gracefully (line 38) but may need defensive coding."
    },
    {
      "id": "TC-EDCONTROLS-001",
      "name": "Thumbnail rail displays all slides with correct numbering",
      "module": "editor_controls",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that the thumbnail rail renders all slides in order with correct numbering and visual previews",
      "business_context": "Users need to see all slides in their carousel at a glance to navigate and understand the flow. Thumbnails provide quick visual reference.",
      "preconditions": [
        "Editor page is loaded with a project containing multiple slides",
        "ThumbnailRail component receives slides array via props"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Load editor with a project containing 10 slides",
          "expected": "Thumbnail rail renders on the left side, width 180px, light gray background"
        },
        {
          "step": 2,
          "action": "Verify each slide has a thumbnail",
          "expected": "10 SlideThumbnail components render, one for each slide in slides array"
        },
        {
          "step": 3,
          "action": "Check slide numbering",
          "expected": "Each thumbnail shows correct number: 1, 2, 3, ... 10 (index + 1)"
        },
        {
          "step": 4,
          "action": "Verify mini canvas preview",
          "expected": "Each thumbnail shows 108x135 mini canvas (10% scale) with LayerRenderer displaying slide content"
        },
        {
          "step": 5,
          "action": "Scroll the thumbnail rail",
          "expected": "Rail is scrollable (overflowY: auto), can view all slides even if more than fit on screen"
        }
      ],
      "acceptance_criteria": [
        "All slides from slides prop are rendered as thumbnails",
        "Numbering is 1-indexed (first slide = 1, not 0)",
        "Thumbnails maintain 4:5 aspect ratio (108x135 matches 1080x1350)",
        "Thumbnail rail has fixed width of 180px",
        "Scrollbar appears when thumbnails exceed viewport height",
        "Mini canvas renders actual slide content (not just placeholder)",
        "Thumbnail rail has right border (#e2e8f0) separating it from main canvas"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/ThumbnailRail.tsx",
        "apps/nextjs/src/components/editor/SlideThumbnail.tsx"
      ],
      "tags": [
        "editor",
        "thumbnails",
        "navigation",
        "ui"
      ],
      "notes": "ThumbnailRail receives slides array and maps to SlideThumbnail components (line 200-224). THUMBNAIL_SCALE = 0.1 (line 17 in SlideThumbnail). Numbering displayed at line 54 (index + 1)."
    },
    {
      "id": "TC-EDCONTROLS-002",
      "name": "Clicking thumbnail navigates to that slide",
      "module": "editor_controls",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that clicking on a thumbnail calls onSlideSelect with the correct index and updates active state",
      "business_context": "Users must be able to quickly jump between slides by clicking thumbnails. This is a core navigation feature.",
      "preconditions": [
        "Thumbnail rail is rendered with multiple slides",
        "onSlideSelect callback is provided"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Click on thumbnail for slide 5",
          "expected": "onSlideSelect(4) is called (0-indexed)"
        },
        {
          "step": 2,
          "action": "Verify active state updates",
          "expected": "Thumbnail 5 shows blue background (#e0e7ff), blue border (2px solid #3b82f6), and blue shadow"
        },
        {
          "step": 3,
          "action": "Verify main canvas updates",
          "expected": "Main canvas switches to display slide 5 content"
        },
        {
          "step": 4,
          "action": "Click on thumbnail for slide 1",
          "expected": "onSlideSelect(0) called, slide 1 becomes active, slide 5 returns to inactive state (white bg)"
        },
        {
          "step": 5,
          "action": "Verify cursor changes on hover",
          "expected": "Thumbnails show pointer cursor, inactive thumbnails show gray background on hover (#f3f4f6)"
        }
      ],
      "acceptance_criteria": [
        "Clicking thumbnail calls onSlideSelect with correct 0-indexed number",
        "Active thumbnail has distinct visual style (blue background, border, shadow)",
        "Only one thumbnail is active at a time",
        "Main canvas updates to show selected slide",
        "Hover state works on inactive thumbnails (gray background)",
        "Active thumbnail does not change background on hover (stays blue)",
        "Slide number text changes color to blue (#3b82f6) when active"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/SlideThumbnail.tsx",
        "apps/nextjs/src/components/editor/ThumbnailRail.tsx"
      ],
      "tags": [
        "editor",
        "thumbnails",
        "navigation",
        "interaction"
      ],
      "notes": "onClick handler at SlideThumbnail line 22 calls onSlideSelect prop. isActive prop (line 10) controls visual styling (lines 28-31). activeSlideIndex prop is passed from parent (ThumbnailRail line 220)."
    },
    {
      "id": "TC-EDCONTROLS-003",
      "name": "Add Slide button creates new blank slide",
      "module": "editor_controls",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that clicking the Add Slide button calls onSlideAdd callback and new slide appears in rail",
      "business_context": "Users need to add slides to expand their carousel beyond the AI-generated slides. This is essential for customization.",
      "preconditions": [
        "Thumbnail rail is rendered",
        "onSlideAdd callback is provided"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Count current slides (e.g., 10 slides)",
          "expected": "10 thumbnails visible in rail"
        },
        {
          "step": 2,
          "action": "Click the '+ Add Slide' button (blue button at top of rail)",
          "expected": "onSlideAdd callback is called"
        },
        {
          "step": 3,
          "action": "Verify new slide appears",
          "expected": "11th thumbnail appears at bottom of rail, numbered '11'"
        },
        {
          "step": 4,
          "action": "Verify new slide becomes active",
          "expected": "New slide (11) is automatically selected and shown in main canvas"
        },
        {
          "step": 5,
          "action": "Check button hover state",
          "expected": "Button background darkens (#2563eb), shadow appears, slight translateY(-1px)"
        }
      ],
      "acceptance_criteria": [
        "Clicking button calls onSlideAdd (no arguments)",
        "New slide appears at end of slides array",
        "Thumbnail rail scrolls to show new slide if needed",
        "Button has blue background (#3b82f6), white text",
        "Button shows tooltip 'Add new slide (Cmd+N)' on hover",
        "Button is always enabled (no disabled state)",
        "Button has data-testid='add_slide_button' for testing"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/ThumbnailRail.tsx"
      ],
      "tags": [
        "editor",
        "thumbnails",
        "slide-management",
        "creation"
      ],
      "notes": "Add button at lines 95-123. handleAddSlide calls onSlideAdd callback (lines 52-56). Tooltip mentions Cmd+N keyboard shortcut but handler not implemented in this component."
    },
    {
      "id": "TC-EDCONTROLS-004",
      "name": "Duplicate Slide button clones active slide",
      "module": "editor_controls",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that clicking Duplicate button calls onSlideDuplicate with active slide index and creates a copy",
      "business_context": "Users need to duplicate slides to reuse layouts and styling. This saves time when creating similar slides.",
      "preconditions": [
        "Thumbnail rail has at least one slide",
        "A slide is selected (activeSlideIndex is set)",
        "onSlideDuplicate callback is provided"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Select slide 3 (click on thumbnail)",
          "expected": "Slide 3 is active (blue highlight)"
        },
        {
          "step": 2,
          "action": "Click the 'Duplicate' button (gray button)",
          "expected": "onSlideDuplicate(2) is called (activeSlideIndex = 2 for slide 3)"
        },
        {
          "step": 3,
          "action": "Verify duplicate appears",
          "expected": "New slide appears after slide 3, with identical content/layout"
        },
        {
          "step": 4,
          "action": "Verify numbering updates",
          "expected": "Slides renumbered: original slide 3, duplicate is slide 4, old slide 4 becomes 5, etc."
        },
        {
          "step": 5,
          "action": "Test with no slides (empty array)",
          "expected": "Duplicate button is disabled (opacity: 0.5, cursor: not-allowed)"
        }
      ],
      "acceptance_criteria": [
        "Duplicate button calls onSlideDuplicate(activeSlideIndex)",
        "Button passes the active slide's index (not the slide object)",
        "Button is disabled when slides.length === 0",
        "Button has gray background (#6b7280), white text",
        "Button shows tooltip 'Duplicate slide (Cmd+D)' on hover",
        "Disabled button has reduced opacity (0.5) and no hover effect",
        "Button has data-testid='duplicate_slide_button'"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/ThumbnailRail.tsx"
      ],
      "tags": [
        "editor",
        "thumbnails",
        "slide-management",
        "duplication"
      ],
      "notes": "Duplicate button at lines 125-155. handleDuplicateSlide calls onSlideDuplicate with activeSlideIndex (lines 58-62). Disabled check: slides.length === 0 (line 128)."
    },
    {
      "id": "TC-EDCONTROLS-005",
      "name": "Delete Slide button removes active slide with minimum 1 slide protection",
      "module": "editor_controls",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that Delete button removes the active slide but is disabled when only 1 slide remains",
      "business_context": "Users need to remove unwanted slides. However, a carousel must have at least 1 slide to remain valid.",
      "preconditions": [
        "Thumbnail rail has multiple slides",
        "A slide is selected",
        "onSlideDelete callback is provided"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Select slide 5 with 10 total slides",
          "expected": "Slide 5 is active"
        },
        {
          "step": 2,
          "action": "Click the 'Delete' button (red button)",
          "expected": "onSlideDelete(4) is called (activeSlideIndex = 4 for slide 5)"
        },
        {
          "step": 3,
          "action": "Verify slide is removed",
          "expected": "Slide 5 disappears, remaining slides renumbered (old slide 6 becomes slide 5)"
        },
        {
          "step": 4,
          "action": "Delete slides until only 1 remains",
          "expected": "Delete button becomes disabled when slides.length === 1"
        },
        {
          "step": 5,
          "action": "Attempt to click disabled Delete button",
          "expected": "onSlideDelete is NOT called, button does not respond"
        }
      ],
      "acceptance_criteria": [
        "Delete button calls onSlideDelete(activeSlideIndex)",
        "Button is enabled when slides.length > 1",
        "Button is disabled when slides.length <= 1",
        "Disabled button has reduced opacity (0.5), cursor: not-allowed",
        "Button has red background (#ef4444), white text",
        "Button shows tooltip 'Delete slide (Delete key)' on hover",
        "Enabled button darkens on hover (#dc2626)",
        "Button has data-testid='delete_slide_button'"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/ThumbnailRail.tsx"
      ],
      "tags": [
        "editor",
        "thumbnails",
        "slide-management",
        "deletion"
      ],
      "notes": "Delete button at lines 157-187. handleDeleteSlide has guard condition: if slides.length > 1 (lines 64-68). Disabled check: slides.length <= 1 (line 160)."
    },
    {
      "id": "TC-EDCONTROLS-006",
      "name": "Drag-and-drop reorders slides in thumbnail rail",
      "module": "editor_controls",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that users can drag thumbnails to reorder slides, with visual feedback during drag",
      "business_context": "Users need to rearrange slide order to improve the flow of their carousel. Drag-and-drop is an intuitive interaction for reordering.",
      "preconditions": [
        "Thumbnail rail has multiple slides",
        "onSlideReorder callback is provided"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Start dragging slide 3 thumbnail (mousedown + drag)",
          "expected": "Thumbnail becomes semi-transparent (opacity: 0.5) indicating drag state"
        },
        {
          "step": 2,
          "action": "Drag over slide 7 position",
          "expected": "Blue top border (2px solid #3b82f6) appears above slide 7 indicating drop target"
        },
        {
          "step": 3,
          "action": "Drop slide 3 onto slide 7 position",
          "expected": "onSlideReorder(2, 6) is called (fromIndex=2, toIndex=6)"
        },
        {
          "step": 4,
          "action": "Verify slide order updates",
          "expected": "Slide 3 moves to position 7, other slides shift accordingly"
        },
        {
          "step": 5,
          "action": "Test dragging slide onto itself (no-op)",
          "expected": "onSlideReorder is NOT called if draggedIndex === dropIndex"
        }
      ],
      "acceptance_criteria": [
        "Dragging thumbnail shows opacity: 0.5 on dragged item",
        "Hovering over drop target shows blue top border (2px solid #3b82f6)",
        "Dropping calls onSlideReorder(fromIndex, toIndex) with 0-indexed values",
        "onSlideReorder is NOT called if fromIndex === toIndex (no-op)",
        "Drag state is cleared on drop (opacity returns to 1, border disappears)",
        "Drag state is cleared on dragEnd without drop (ESC key or drag outside)",
        "All thumbnails have draggable=true attribute"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/ThumbnailRail.tsx"
      ],
      "tags": [
        "editor",
        "thumbnails",
        "reordering",
        "drag-drop"
      ],
      "notes": "Drag handlers at lines 29-50. draggedIndex and dragOverIndex state (lines 26-27). handleDrop calls onSlideReorder if draggedIndex !== dropIndex (lines 38-44). Visual feedback at lines 209-214."
    },
    {
      "id": "TC-EDCONTROLS-007",
      "name": "Theme Controls updates colors via color picker",
      "module": "editor_controls",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that users can change background, foreground, and accent colors using the color picker UI",
      "business_context": "Users need to customize colors to match their brand or preference. Color picker provides visual feedback.",
      "preconditions": [
        "ThemeControls component is rendered with styleKit prop",
        "onStyleKitUpdate callback is provided"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Click the 'Color Palette' button",
          "expected": "Dropdown opens showing three color inputs: Background, Foreground, Accent"
        },
        {
          "step": 2,
          "action": "Change Background color using color picker input (type='color')",
          "expected": "handleColorChange('background', newColor) is called"
        },
        {
          "step": 3,
          "action": "Verify color update",
          "expected": "onStyleKitUpdate is called with updated styleKit containing new background color"
        },
        {
          "step": 4,
          "action": "Manually edit Background hex code in text input",
          "expected": "Text input (lines 126-130) updates color, calls handleColorChange"
        },
        {
          "step": 5,
          "action": "Verify all three colors (background, foreground, accent) can be updated independently",
          "expected": "Each color has separate picker and text input, all trigger onStyleKitUpdate"
        }
      ],
      "acceptance_criteria": [
        "Color picker button shows current colors as preview squares (5x5 rounded)",
        "Clicking button toggles dropdown (showColorPicker state)",
        "Each color has both <input type='color'> and <input type='text'> for hex editing",
        "Updating any color calls onStyleKitUpdate with updated styleKit",
        "Updated styleKit preserves all other properties (fonts, spacing)",
        "Clicking backdrop closes color picker dropdown",
        "Dropdown has absolute positioning, appears below button with shadow"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/ThemeControls.tsx"
      ],
      "tags": [
        "editor",
        "theme",
        "colors",
        "customization"
      ],
      "notes": "Color picker button at lines 82-101. handleColorChange at lines 28-37. Dropdown at lines 104-173. Backdrop at lines 107-110 closes dropdown on click."
    },
    {
      "id": "TC-EDCONTROLS-008",
      "name": "Theme Controls switches font pairs",
      "module": "editor_controls",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that users can select from predefined font pairs and see them applied to the slide",
      "business_context": "Typography is a key design element. Users need easy access to professional font pairings.",
      "preconditions": [
        "ThemeControls component is rendered",
        "Font pair selector has 5 options (Inter, Lora+Inter, Poppins, Source Sans, Roboto Mono)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Click the 'Font Pair' button",
          "expected": "Dropdown opens showing 5 font pair options"
        },
        {
          "step": 2,
          "action": "Select 'Lora / Inter' font pair",
          "expected": "handleFontPairChange is called with Lora headline, Inter body"
        },
        {
          "step": 3,
          "action": "Verify styleKit updates",
          "expected": "onStyleKitUpdate called with typography: { headline_font: 'Lora', headline_weight: 700, body_font: 'Inter', body_weight: 400 }"
        },
        {
          "step": 4,
          "action": "Verify active font pair shows checkmark",
          "expected": "Currently selected font pair has blue background (#e0e7ff) and checkmark icon"
        },
        {
          "step": 5,
          "action": "Verify fonts render in their own typeface in dropdown",
          "expected": "Headline text uses fontFamily: fontPair.headline, body text uses fontFamily: fontPair.body"
        }
      ],
      "acceptance_criteria": [
        "Font selector button shows current headline/body fonts (e.g., 'Lora / Inter')",
        "Dropdown lists all 5 font pairs from FONT_PAIRS constant (lines 12-18)",
        "Selecting font pair calls onStyleKitUpdate with updated typography",
        "Active font pair has isActive check (lines 201-203) and blue background",
        "Font pair options render in their own fonts for preview (lines 215-218, 236-240)",
        "Dropdown closes after selection (setShowFontSelector(false) at line 51)",
        "Backdrop closes dropdown on outside click"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/ThemeControls.tsx"
      ],
      "tags": [
        "editor",
        "theme",
        "typography",
        "customization"
      ],
      "notes": "Font pairs defined at lines 12-18. handleFontPairChange at lines 40-52. Font selector dropdown at lines 190-248. Active font has checkmark SVG (lines 220-233)."
    },
    {
      "id": "TC-EDCONTROLS-009",
      "name": "Theme Controls cycles through spacing options",
      "module": "editor_controls",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "medium",
      "description": "Validates that users can toggle between tight, normal, and roomy spacing with corresponding line heights",
      "business_context": "Spacing affects readability and visual balance. Users should be able to adjust density to match their style.",
      "preconditions": [
        "ThemeControls component is rendered",
        "styleKit has spacingRules with current padding value"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Verify current spacing (e.g., 'normal')",
          "expected": "Spacing button shows 'normal' in gray badge"
        },
        {
          "step": 2,
          "action": "Click the Spacing button",
          "expected": "handleSpacingToggle cycles to next option: normal \u2192 roomy"
        },
        {
          "step": 3,
          "action": "Verify styleKit updates",
          "expected": "onStyleKitUpdate called with spacingRules: { padding: 'roomy', line_height: 1.7 }"
        },
        {
          "step": 4,
          "action": "Click Spacing button again",
          "expected": "Cycles to next: roomy \u2192 tight"
        },
        {
          "step": 5,
          "action": "Click Spacing button again",
          "expected": "Cycles back: tight \u2192 normal (wraps around)"
        }
      ],
      "acceptance_criteria": [
        "Spacing button shows current spacing in capitalized badge",
        "Clicking cycles through 3 options: tight, normal, roomy (array at line 21)",
        "Cycling wraps around: roomy \u2192 tight (modulo logic at line 57)",
        "Line height updates based on spacing: tight=1.3, normal=1.5, roomy=1.7 (lines 61-65)",
        "onStyleKitUpdate is called with both padding and line_height",
        "Help text below button explains each spacing option (lines 264-273)"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/ThemeControls.tsx"
      ],
      "tags": [
        "editor",
        "theme",
        "spacing",
        "customization"
      ],
      "notes": "SPACING_OPTIONS array at line 21. handleSpacingToggle at lines 55-75. Cycling logic: (currentIndex + 1) % 3. lineHeightMap at lines 61-65 maps spacing to line_height."
    },
    {
      "id": "TC-EDCONTROLS-010",
      "name": "Layout Variant Selector filters layouts by slide type",
      "module": "editor_controls",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that layout selector fetches all layouts and shows only those compatible with the current slide's type",
      "business_context": "Not all layouts work for all slide types (hook, value, recap, etc.). Filtering prevents users from selecting incompatible layouts.",
      "preconditions": [
        "LayoutVariantSelector receives currentSlide prop with layoutId",
        "API endpoint /api/layouts returns array of layouts with slideType field"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Component mounts, fetches layouts from /api/layouts",
          "expected": "GET request to /api/layouts, response contains all template layouts"
        },
        {
          "step": 2,
          "action": "Determine current slide's type (e.g., 'value')",
          "expected": "currentLayout found in layouts array (line 55), slideType extracted"
        },
        {
          "step": 3,
          "action": "Filter layouts by matching slideType",
          "expected": "compatibleLayouts = layouts.filter(l => l.slideType === currentLayout.slideType) (line 63)"
        },
        {
          "step": 4,
          "action": "Click 'Change Layout' button",
          "expected": "Dropdown opens showing only compatible layouts"
        },
        {
          "step": 5,
          "action": "Verify count display",
          "expected": "Dropdown header shows 'Compatible Layouts (N)' where N = compatibleLayouts.length (line 93)"
        }
      ],
      "acceptance_criteria": [
        "Layouts are fetched once on mount (useEffect line 32)",
        "Compatible layouts are filtered by matching slideType (line 63)",
        "If current layoutId not found, show all layouts (lines 56-60)",
        "Dropdown shows count of compatible layouts",
        "Loading state shows 'Loading layouts...' while fetching (lines 96-98)",
        "Empty state shows 'No compatible layouts found.' if no matches (lines 100-102)",
        "Layouts are displayed in 3-column grid (line 104)"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/LayoutVariantSelector.tsx"
      ],
      "tags": [
        "editor",
        "layout",
        "filtering",
        "api-integration"
      ],
      "notes": "useEffect at lines 32-48 fetches layouts. useEffect at lines 51-65 filters by slideType. slideType is a field on Layout model (line 12). Example types: hook, promise, value, recap, cta, generic."
    },
    {
      "id": "TC-EDCONTROLS-011",
      "name": "Layout Variant Selector switches slide layout",
      "module": "editor_controls",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that selecting a layout calls onLayoutChange with new layoutId and blueprint",
      "business_context": "Users need to change slide layouts to match content length and visual style. This is a core editing feature.",
      "preconditions": [
        "Layout selector is open with compatible layouts displayed",
        "onLayoutChange callback is provided"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Verify current layout is highlighted",
          "expected": "Layout matching currentSlide.layoutId has blue border and 'Active' label"
        },
        {
          "step": 2,
          "action": "Click on a different compatible layout",
          "expected": "handleLayoutSelect is called with selected layout object"
        },
        {
          "step": 3,
          "action": "Verify callback is invoked",
          "expected": "onLayoutChange(layout.id, layout.layersBlueprint) is called (line 68)"
        },
        {
          "step": 4,
          "action": "Verify main canvas updates",
          "expected": "Slide re-renders with new blueprint (different text box positions/sizes)"
        },
        {
          "step": 5,
          "action": "Verify dropdown closes after selection",
          "expected": "setIsOpen(false) called, dropdown disappears (line 69)"
        }
      ],
      "acceptance_criteria": [
        "Selecting layout calls onLayoutChange(layoutId, layersBlueprint)",
        "Active layout (currentSlide.layoutId) has blue border and bg (#e0e7ff) (lines 114-117)",
        "Active layout shows '\u2713 Active' label (lines 161-163)",
        "Non-active layouts have gray border, white background, hover effect",
        "Layout preview shows mini canvas (86.4x108, 8% scale) (lines 21-23)",
        "Preview renders background color and gray text box placeholders (lines 138-154)",
        "Dropdown closes after layout selection (line 69)"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/LayoutVariantSelector.tsx"
      ],
      "tags": [
        "editor",
        "layout",
        "selection",
        "interaction"
      ],
      "notes": "handleLayoutSelect at lines 67-70. isActive check at line 106 compares layout.id to currentSlide.layoutId. Mini preview uses Konva Stage/Layer (lines 122-155) with gray placeholders for text boxes."
    },
    {
      "id": "TC-EDCONTROLS-012",
      "name": "Style Kit Selector loads and displays all style kits",
      "module": "editor_controls",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that style kit selector fetches style kits from API and displays them grouped by free/premium",
      "business_context": "Users need to switch style kits to instantly change the entire visual theme of their carousel. This is a powerful customization feature.",
      "preconditions": [
        "StyleKitSelector component is mounted",
        "API endpoint /api/style-kits returns array of 8 style kits"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Component mounts and fetches style kits",
          "expected": "GET request to /api/style-kits returns style kit array"
        },
        {
          "step": 2,
          "action": "Verify loading state",
          "expected": "Loading state shows 'Loading style kits...' (lines 42-46)"
        },
        {
          "step": 3,
          "action": "Verify style kits load",
          "expected": "setStyleKits called with data, loading set to false"
        },
        {
          "step": 4,
          "action": "Click style kit selector button",
          "expected": "Dropdown opens showing two sections: 'Free Style Kits' and 'Premium Style Kits'"
        },
        {
          "step": 5,
          "action": "Verify grouping",
          "expected": "Free kits: filter isPremium=false (line 109), Premium kits: filter isPremium=true (line 171)"
        }
      ],
      "acceptance_criteria": [
        "Style kits are fetched from /api/style-kits on mount (lines 18-31)",
        "Loading state renders placeholder during fetch",
        "Error handling logs error to console (line 24) but does not crash",
        "Free style kits section appears first with uppercase label (lines 105-107)",
        "Premium style kits section appears second (lines 165-169)",
        "Each section uses 2-column grid (line 108, 170)",
        "Style kits have data-testid='style_kit_{id}' for testing (line 112, 174)"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/StyleKitSelector.tsx"
      ],
      "tags": [
        "editor",
        "style-kit",
        "api-integration",
        "ui"
      ],
      "notes": "useEffect at lines 17-32 fetches style kits. Free kits filtered at line 109, premium at line 171. Loading check at lines 41-47 shows loading state before data arrives."
    },
    {
      "id": "TC-EDCONTROLS-013",
      "name": "Style Kit Selector switches active style kit",
      "module": "editor_controls",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that selecting a style kit calls onStyleKitChange and updates the entire slide's visual theme",
      "business_context": "Switching style kits is a one-click theme change affecting colors, fonts, and spacing. This is essential for quick customization.",
      "preconditions": [
        "Style kit selector dropdown is open with style kits displayed",
        "onStyleKitChange callback is provided"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Verify current style kit is highlighted",
          "expected": "Kit matching currentStyleKitId has blue border/ring (free) or purple (premium)"
        },
        {
          "step": 2,
          "action": "Click on a different free style kit (e.g., 'Bold Modern')",
          "expected": "handleKitSelect is called with selected kit"
        },
        {
          "step": 3,
          "action": "Verify callback",
          "expected": "onStyleKitChange(kit) called with full StyleKit object (line 37)"
        },
        {
          "step": 4,
          "action": "Verify main canvas updates",
          "expected": "Slide re-renders with new colors, fonts, and spacing from selected kit"
        },
        {
          "step": 5,
          "action": "Verify dropdown closes",
          "expected": "setIsOpen(false) called, dropdown disappears (line 38)"
        }
      ],
      "acceptance_criteria": [
        "Selecting kit calls onStyleKitChange with full StyleKit object",
        "Active free kit has blue border/background/ring (lines 115-117)",
        "Active premium kit has purple border/background/ring (lines 177-179)",
        "Kit preview shows background color, font samples, and accent bar (lines 121-151, 190-221)",
        "Button shows current kit name and font pair (lines 59-64)",
        "Color preview dots show background + accent colors (lines 68-78)",
        "Dropdown closes after selection (line 38)"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/StyleKitSelector.tsx"
      ],
      "tags": [
        "editor",
        "style-kit",
        "selection",
        "interaction"
      ],
      "notes": "handleKitSelect at lines 36-39. currentKit found at line 34 by matching currentStyleKitId. isActive check: kit.id === currentStyleKitId (lines 115, 177). Premium badge shown at lines 183-186."
    },
    {
      "id": "TC-EDCONTROLS-014",
      "name": "Style Kit Selector shows visual preview of each kit",
      "module": "editor_controls",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "medium",
      "description": "Validates that each style kit preview accurately renders colors, fonts, and accent bar",
      "business_context": "Users need to see what a style kit looks like before applying it. Visual previews help make informed decisions.",
      "preconditions": [
        "Style kit selector dropdown is open",
        "Style kits have colors, typography, and spacing properties"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Examine a style kit preview box",
          "expected": "Preview shows background color from kit.colors.background"
        },
        {
          "step": 2,
          "action": "Verify headline preview",
          "expected": "Headline text 'Headline' renders in kit.typography.headline_font and kit.colors.foreground"
        },
        {
          "step": 3,
          "action": "Verify body preview",
          "expected": "Body text 'Body text preview' renders in kit.typography.body_font and kit.colors.foreground"
        },
        {
          "step": 4,
          "action": "Verify accent bar",
          "expected": "Horizontal bar (h-1 w-8) renders in kit.colors.accent color"
        },
        {
          "step": 5,
          "action": "Verify button color preview dots",
          "expected": "Button shows two color dots: kit.colors.background and kit.colors.accent (lines 68-78)"
        }
      ],
      "acceptance_criteria": [
        "Preview box background uses kit.colors.background",
        "Headline text uses kit.typography.headline_font and foreground color",
        "Body text uses kit.typography.body_font and foreground color",
        "Accent bar uses kit.colors.accent",
        "Preview is 96px tall (h-24) and centered (lines 122, 191)",
        "Font families apply via inline style={{ fontFamily }} (lines 133, 142, 199, 211)",
        "Button shows two color preview dots (lines 70-77)"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/StyleKitSelector.tsx"
      ],
      "tags": [
        "editor",
        "style-kit",
        "preview",
        "ui"
      ],
      "notes": "Preview rendering at lines 121-151 (free) and 190-221 (premium). Same structure for both. fontFamily applied inline (lines 133, 142, 199, 211). Accent bar at lines 147-150, 216-219."
    },
    {
      "id": "TC-EDCONTROLS-015",
      "name": "Thumbnail rail action buttons show correct disabled states",
      "module": "editor_controls",
      "user_journey": null,
      "category": "frontend",
      "type": "edge_case",
      "priority": "medium",
      "description": "Validates that Duplicate and Delete buttons correctly disable based on slide count and show appropriate visual feedback",
      "business_context": "Preventing invalid actions (deleting last slide, duplicating when none exist) protects data integrity and prevents user confusion.",
      "preconditions": [
        "Thumbnail rail is rendered with varying slide counts"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Load editor with 0 slides (edge case)",
          "expected": "Duplicate button is disabled (slides.length === 0), Delete button is disabled (slides.length <= 1)"
        },
        {
          "step": 2,
          "action": "Load editor with exactly 1 slide",
          "expected": "Duplicate enabled, Delete disabled (can't delete last slide)"
        },
        {
          "step": 3,
          "action": "Load editor with 2+ slides",
          "expected": "Both Duplicate and Delete are enabled"
        },
        {
          "step": 4,
          "action": "Verify disabled button styling",
          "expected": "Disabled buttons have opacity: 0.5, cursor: not-allowed, no hover effects"
        },
        {
          "step": 5,
          "action": "Attempt to click disabled Delete button",
          "expected": "onSlideDelete is NOT called (guard at line 65 checks slides.length > 1)"
        }
      ],
      "acceptance_criteria": [
        "Add Slide button is ALWAYS enabled (no disabled state)",
        "Duplicate disabled when slides.length === 0 (line 128)",
        "Delete disabled when slides.length <= 1 (line 160)",
        "Disabled buttons have opacity: 0.5 (lines 139, 171)",
        "Disabled buttons have cursor: not-allowed (lines 138, 170)",
        "Disabled buttons do not show hover effects (lines 143-147, 175-180)",
        "Delete handler has guard: if (slides.length > 1) (line 65)",
        "Tooltips still show on disabled buttons"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/ThumbnailRail.tsx"
      ],
      "tags": [
        "editor",
        "thumbnails",
        "validation",
        "edge-case"
      ],
      "notes": "Disabled checks at lines 128 (duplicate) and 160 (delete). Guard condition at line 65 prevents delete callback if slides.length <= 1. Add button has no disabled logic."
    },
    {
      "id": "TC-EDPAGE-001",
      "name": "Editor page loads project and displays all components correctly",
      "module": "editor_page",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates the complete editor page load sequence: fetch project \u2192 fetch slides \u2192 fetch style kit \u2192 fetch layouts \u2192 transform data \u2192 render UI",
      "business_context": "Editor is the core workspace where users spend most of their time. Complete and correct data loading is critical for user confidence and productivity.",
      "preconditions": [
        "User is authenticated",
        "Valid project ID exists in database",
        "Project has at least 1 slide",
        "Project references valid styleKitId"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to /en/editor/:id with valid project ID",
          "expected": "Loading spinner appears with 'Loading project...' message (lines 210-221)"
        },
        {
          "step": 2,
          "action": "Wait for data fetching to complete",
          "expected": "4 parallel API calls execute: GET /api/projects/:id, GET /api/projects/:id/slides, GET /api/style-kits/:styleKitId, GET /api/layouts"
        },
        {
          "step": 3,
          "action": "Verify data transformation",
          "expected": "Slides data transformed to SlideData format (lines 101-118), content parsed from JSON string, styleKit attached to each slide"
        },
        {
          "step": 4,
          "action": "Check rendered layout structure",
          "expected": "Header with project title, Back button, Export button visible. Three-column layout: thumbnail rail (left), canvas (center), controls (right)"
        },
        {
          "step": 5,
          "action": "Verify component rendering",
          "expected": "ThumbnailRail shows all slides, EditorCanvas displays first slide, StyleKitSelector/ThemeControls/LayoutVariantSelector all render"
        },
        {
          "step": 6,
          "action": "Check auto-save initialization",
          "expected": "useAutoSave hook initialized with projectId, save status shows 'idle' state"
        }
      ],
      "acceptance_criteria": [
        "Page loads within 3 seconds with fast network",
        "Loading state shows spinner + message",
        "All 4 API calls succeed (200 status)",
        "slides array has length matching database slide count",
        "Each slide has styleKit, layersBlueprint, content properties",
        "activeSlideIndex defaults to 0 (first slide)",
        "Project title displays in header",
        "All three panels (thumbnail, canvas, controls) are visible",
        "No console errors during load",
        "Save status indicator shows initial state"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/editor/[id]/page.tsx",
        "apps/nextjs/src/app/api/projects/[id]/route.ts",
        "apps/nextjs/src/app/api/projects/[id]/slides/route.ts"
      ],
      "tags": [
        "editor",
        "integration",
        "page-load",
        "critical-path"
      ],
      "notes": "Data loading happens in useEffect at lines 67-132. Transform logic at lines 101-118 parses JSON content and attaches layouts/styleKit."
    },
    {
      "id": "TC-EDPAGE-002",
      "name": "Editor page handles project not found error gracefully",
      "module": "editor_page",
      "user_journey": null,
      "category": "integration",
      "type": "error_path",
      "priority": "high",
      "description": "Validates error handling when project ID doesn't exist or user doesn't own the project",
      "business_context": "Invalid project access (deleted, wrong user, wrong ID) must show clear error without breaking the app.",
      "preconditions": [
        "User is authenticated"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to /en/editor/invalid-project-id",
          "expected": "Loading spinner appears briefly"
        },
        {
          "step": 2,
          "action": "Wait for API call to fail",
          "expected": "GET /api/projects/invalid-project-id returns 404 or 401"
        },
        {
          "step": 3,
          "action": "Verify error state rendering",
          "expected": "Error screen shows: red warning icon (\u26a0\ufe0f), 'Failed to Load Project' heading, error message, 'Back to Dashboard' button (lines 224-239)"
        },
        {
          "step": 4,
          "action": "Click 'Back to Dashboard' button",
          "expected": "router.push('/en/dashboard') navigates to dashboard"
        }
      ],
      "acceptance_criteria": [
        "Loading state transitions to error state (not stuck loading)",
        "Error message is user-friendly (not raw error text)",
        "Back button redirects to /en/dashboard",
        "No React crash or white screen",
        "Console logs error for debugging (line 123)",
        "Other UI components (ThumbnailRail, Canvas) do NOT render in error state"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/editor/[id]/page.tsx",
        "apps/nextjs/src/app/api/projects/[id]/route.ts"
      ],
      "tags": [
        "editor",
        "error-handling",
        "404",
        "authorization"
      ],
      "notes": "Error handling at lines 122-126. Error display at lines 224-239."
    },
    {
      "id": "TC-EDPAGE-003",
      "name": "Editor page handles project with no slides gracefully",
      "module": "editor_page",
      "user_journey": null,
      "category": "integration",
      "type": "edge_case",
      "priority": "high",
      "description": "Validates behavior when project exists but has zero slides (edge case - should not happen normally)",
      "business_context": "Corrupted or partially created projects must be handled gracefully to prevent app crash.",
      "preconditions": [
        "User is authenticated",
        "Project exists in database",
        "Project has ZERO slides (edge case)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to /en/editor/:id for project with no slides",
          "expected": "Loading spinner appears, API calls execute"
        },
        {
          "step": 2,
          "action": "Verify data fetching completes",
          "expected": "Project loads, slides array is empty []"
        },
        {
          "step": 3,
          "action": "Check rendered state",
          "expected": "Empty state screen shows: 'No slides found for this project' message, 'Back to Dashboard' button (lines 242-255)"
        },
        {
          "step": 4,
          "action": "Click 'Back to Dashboard' button",
          "expected": "router.push('/en/dashboard') navigates away"
        }
      ],
      "acceptance_criteria": [
        "Page does not crash with empty slides array",
        "Empty state message is clear and actionable",
        "Back button functions correctly",
        "No null/undefined errors from slides[0] access",
        "Editor UI components (Canvas, ThumbnailRail) do NOT render"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/editor/[id]/page.tsx"
      ],
      "tags": [
        "editor",
        "edge-case",
        "empty-state"
      ],
      "notes": "Empty state check at lines 242-255. This edge case should be rare but must be handled."
    },
    {
      "id": "TC-EDPAGE-004",
      "name": "Auto-save triggers on slide content changes",
      "module": "editor_page",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that useAutoSave hook correctly debounces and saves slide changes to the backend",
      "business_context": "Auto-save is critical for preventing data loss. Users expect changes to be automatically saved without manual action.",
      "preconditions": [
        "Editor page is loaded with a project",
        "User has at least 1 slide"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Edit text in a slide's headline via EditorCanvas",
          "expected": "handleContentChange updates slides state (lines 135-150), useEffect triggers (line 56)"
        },
        {
          "step": 2,
          "action": "Wait 500ms (debounce period from useAutoSave)",
          "expected": "save() function is called with updated slides data"
        },
        {
          "step": 3,
          "action": "Verify save status indicator updates",
          "expected": "Status shows '\u23f3 Saving...' during request (line 272), then '\u2713 Saved' on success (line 273)"
        },
        {
          "step": 4,
          "action": "Check API call",
          "expected": "PUT /api/projects/:id/slides called with all slides, correct orderIndex, updated content"
        },
        {
          "step": 5,
          "action": "Make another change within 500ms",
          "expected": "Debounce resets, only one API call after final change"
        }
      ],
      "acceptance_criteria": [
        "Auto-save triggers after 500ms of inactivity",
        "Multiple rapid changes result in single save (debounced)",
        "Save status indicator shows all states: idle \u2192 saving \u2192 saved",
        "API call includes all slides with correct orderIndex (line 40)",
        "Content is JSON.stringified correctly (line 35)",
        "Initial mount does NOT trigger save (isInitialMount guard at lines 55-60)",
        "Save errors update status to 'error' with \u26a0\ufe0f icon"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/editor/[id]/page.tsx",
        "apps/nextjs/src/hooks/use-auto-save.ts",
        "apps/nextjs/src/app/api/projects/[id]/slides/route.ts"
      ],
      "tags": [
        "editor",
        "auto-save",
        "integration",
        "critical-feature"
      ],
      "notes": "Auto-save setup at lines 26-52. Trigger logic at lines 54-65. Initial mount guard prevents save on first render."
    },
    {
      "id": "TC-EDPAGE-005",
      "name": "Slide navigation via thumbnail rail updates active slide",
      "module": "editor_page",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that clicking a thumbnail updates activeSlideIndex and re-renders canvas and controls with correct slide data",
      "business_context": "Slide navigation is the primary way users move between slides. Must be instant and update all coordinated components.",
      "preconditions": [
        "Editor page is loaded",
        "Project has 3+ slides"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Verify initial state - activeSlideIndex is 0",
          "expected": "Canvas shows slide 1, thumbnail 1 has blue active indicator, controls show 'Slide 1 of X'"
        },
        {
          "step": 2,
          "action": "Click thumbnail for slide 3 (index 2)",
          "expected": "onSlideClick(2) called (line 294), setActiveSlideIndex(2) updates state"
        },
        {
          "step": 3,
          "action": "Verify canvas updates",
          "expected": "EditorCanvas receives slides[2] (line 305), renders slide 3 content"
        },
        {
          "step": 4,
          "action": "Verify controls update",
          "expected": "StyleKitSelector shows slide 3's styleKit (line 321), LayoutVariantSelector receives slide 3's layoutId (line 331), ThemeControls receives slide 3's styleKit (line 326)"
        },
        {
          "step": 5,
          "action": "Verify header updates",
          "expected": "Header shows 'Slide 3 of X' (line 316)"
        }
      ],
      "acceptance_criteria": [
        "activeSlideIndex updates immediately (no delay)",
        "Canvas renders new slide content correctly",
        "Thumbnail rail shows correct active indicator (blue highlight)",
        "All control components receive updated slide data",
        "Slide counter in header updates correctly",
        "No flicker or intermediate state visible",
        "All components re-render in sync"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/editor/[id]/page.tsx",
        "apps/nextjs/src/components/editor/ThumbnailRail.tsx",
        "apps/nextjs/src/components/editor/EditorCanvas.tsx"
      ],
      "tags": [
        "editor",
        "navigation",
        "integration",
        "ux"
      ],
      "notes": "activeSlideIndex is used everywhere: ThumbnailRail (line 293), EditorCanvas (line 305), controls (lines 320-334), header (line 316)."
    },
    {
      "id": "TC-EDPAGE-006",
      "name": "Style kit change updates all slides simultaneously",
      "module": "editor_page",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that changing style kit via StyleKitSelector updates all slides' styleKit property and triggers auto-save",
      "business_context": "Style kit switching is a global operation that changes the entire carousel's visual theme. Must update all slides atomically.",
      "preconditions": [
        "Editor page is loaded",
        "Project has 2+ slides with initial styleKit"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Open StyleKitSelector and choose a different style kit (e.g., Bold Modern)",
          "expected": "onStyleKitChange(newStyleKit) called (line 322)"
        },
        {
          "step": 2,
          "action": "Verify handleStyleKitChange logic",
          "expected": "setSlides updates ALL slides' styleKit property using .map (line 190)"
        },
        {
          "step": 3,
          "action": "Check canvas re-render",
          "expected": "EditorCanvas receives updated slide with new styleKit, re-renders with new colors/fonts"
        },
        {
          "step": 4,
          "action": "Navigate to different slides",
          "expected": "All slides now have the new styleKit applied"
        },
        {
          "step": 5,
          "action": "Verify auto-save triggered",
          "expected": "useEffect (line 56) detects slides change, calls save() after 500ms, PUT /api/projects/:id/slides updates all slides"
        }
      ],
      "acceptance_criteria": [
        "All slides updated simultaneously (no partial updates)",
        "Canvas immediately reflects new styleKit colors/fonts",
        "ThumbnailRail thumbnails re-render with new colors",
        "ThemeControls shows new styleKit's colors/fonts",
        "Auto-save triggers after style kit change",
        "No flicker or gradual update visible",
        "Changes persist after page refresh"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/editor/[id]/page.tsx",
        "apps/nextjs/src/components/editor/StyleKitSelector.tsx"
      ],
      "tags": [
        "editor",
        "style-kit",
        "integration",
        "global-change"
      ],
      "notes": "handleStyleKitChange at lines 189-191 uses immutable .map pattern to update all slides. Auto-save at lines 56-65 triggers on slides change."
    },
    {
      "id": "TC-EDPAGE-007",
      "name": "Layout change updates active slide and preserves content",
      "module": "editor_page",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that changing layout via LayoutVariantSelector updates only the active slide's layoutId and triggers re-render",
      "business_context": "Layout switching changes slide structure. Content must be preserved when possible, and canvas must re-render with new layout.",
      "preconditions": [
        "Editor page is loaded",
        "Active slide has layout 'hook_big_headline'"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Open LayoutVariantSelector and choose a different layout (e.g., 'value_bullets')",
          "expected": "onLayoutChange(newLayoutId) called (line 333)"
        },
        {
          "step": 2,
          "action": "Verify handleLayoutChange logic",
          "expected": "setSlides updates ONLY activeSlideIndex slide's layoutId (lines 193-202)"
        },
        {
          "step": 3,
          "action": "Check canvas re-render",
          "expected": "EditorCanvas receives updated slide with new layoutId, fetches new layersBlueprint, re-renders with new layout"
        },
        {
          "step": 4,
          "action": "Verify content preservation",
          "expected": "Slide content (headline, body) remains unchanged if new layout has same layer IDs"
        },
        {
          "step": 5,
          "action": "Verify auto-save triggered",
          "expected": "useEffect detects slides change, calls save() after 500ms"
        }
      ],
      "acceptance_criteria": [
        "Only active slide's layoutId updates (other slides unchanged)",
        "Canvas immediately re-renders with new layout",
        "Content is preserved where layer IDs match",
        "ThumbnailRail thumbnail for active slide updates preview",
        "LayoutVariantSelector shows new layout as active",
        "Auto-save triggers after layout change",
        "Changes persist after page refresh"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/editor/[id]/page.tsx",
        "apps/nextjs/src/components/editor/LayoutVariantSelector.tsx"
      ],
      "tags": [
        "editor",
        "layout",
        "integration",
        "content-preservation"
      ],
      "notes": "handleLayoutChange at lines 193-202 uses immutable update pattern. Only activeSlideIndex slide is modified."
    },
    {
      "id": "TC-EDPAGE-008",
      "name": "Add slide creates new slide and updates active index",
      "module": "editor_page",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that clicking Add Slide button creates a new slide with default content and switches to it",
      "business_context": "Adding slides is a core editing action. New slide must have sensible defaults and user should see it immediately.",
      "preconditions": [
        "Editor page is loaded",
        "Project has 2 existing slides"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Click Add Slide button in ThumbnailRail",
          "expected": "onSlideAdd() called (line 296)"
        },
        {
          "step": 2,
          "action": "Verify handleSlideAdd logic",
          "expected": "New slide created with temp ID 'temp-{timestamp}', layoutId 'generic_single_focus', default content 'New Slide', copies styleKit from first slide (lines 152-164)"
        },
        {
          "step": 3,
          "action": "Check state updates",
          "expected": "setSlides appends new slide to array (line 162), setActiveSlideIndex(slides.length) switches to new slide (line 163)"
        },
        {
          "step": 4,
          "action": "Verify canvas displays new slide",
          "expected": "EditorCanvas shows 'New Slide' headline with empty body"
        },
        {
          "step": 5,
          "action": "Verify ThumbnailRail updates",
          "expected": "New thumbnail appears at end, highlighted as active"
        },
        {
          "step": 6,
          "action": "Verify auto-save does NOT save temp slide",
          "expected": "API save logic skips slides with ID starting with 'temp-' (PUT /api/projects/:id/slides, line 126)"
        }
      ],
      "acceptance_criteria": [
        "New slide has unique temp ID (temp-{timestamp})",
        "New slide uses generic_single_focus layout",
        "New slide has default content ('New Slide')",
        "New slide copies styleKit from existing slides",
        "Active slide switches to new slide immediately",
        "ThumbnailRail shows new slide at end",
        "Slide counter updates (e.g., 'Slide 3 of 3')",
        "Temp slide is NOT saved to backend until content edited"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/editor/[id]/page.tsx",
        "apps/nextjs/src/components/editor/ThumbnailRail.tsx",
        "apps/nextjs/src/app/api/projects/[id]/slides/route.ts"
      ],
      "tags": [
        "editor",
        "add-slide",
        "integration",
        "ux"
      ],
      "notes": "handleSlideAdd at lines 152-164. Temp ID pattern 'temp-{Date.now()}'. Backend skips temp slides at PUT /api/projects/:id/slides line 126."
    },
    {
      "id": "TC-EDPAGE-009",
      "name": "Duplicate slide creates copy and switches to it",
      "module": "editor_page",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that clicking Duplicate button creates an exact copy of a slide and places it after the original",
      "business_context": "Duplicating slides is a common workflow for creating variations. Copy must be exact and inserted in correct position.",
      "preconditions": [
        "Editor page is loaded",
        "Active slide is slide 2 with custom content"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Click Duplicate button in ThumbnailRail for slide 2",
          "expected": "onSlideDuplicate(1) called with 0-based index (line 297)"
        },
        {
          "step": 2,
          "action": "Verify handleSlideDuplicate logic",
          "expected": "Duplicated slide created with temp ID, copies layoutId/styleKit/content from original (line 167), inserted at index+1 position (line 169)"
        },
        {
          "step": 3,
          "action": "Check state updates",
          "expected": "setSlides inserts duplicate after original (line 170), setActiveSlideIndex(index + 1) switches to duplicate (line 171)"
        },
        {
          "step": 4,
          "action": "Verify canvas displays duplicated slide",
          "expected": "EditorCanvas shows exact copy of original slide's content"
        },
        {
          "step": 5,
          "action": "Verify ThumbnailRail updates",
          "expected": "Duplicate thumbnail appears immediately after original, highlighted as active"
        }
      ],
      "acceptance_criteria": [
        "Duplicate has unique temp ID",
        "Duplicate has identical layoutId, styleKit, content as original",
        "Duplicate is inserted immediately after original (not at end)",
        "Active slide switches to duplicate",
        "ThumbnailRail shows correct order",
        "Slide counter increments (e.g., '3 of 4')",
        "Duplicate is NOT saved to backend until modified"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/editor/[id]/page.tsx",
        "apps/nextjs/src/components/editor/ThumbnailRail.tsx"
      ],
      "tags": [
        "editor",
        "duplicate-slide",
        "integration",
        "ux"
      ],
      "notes": "handleSlideDuplicate at lines 166-172. Uses Array.splice to insert at specific position."
    },
    {
      "id": "TC-EDPAGE-010",
      "name": "Delete slide removes slide and adjusts active index",
      "module": "editor_page",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that deleting a slide removes it from the array, adjusts activeSlideIndex, and prevents deleting the last slide",
      "business_context": "Slide deletion must be safe (can't delete last slide) and smart (adjust active index to show nearest remaining slide).",
      "preconditions": [
        "Editor page is loaded",
        "Project has 3 slides",
        "Active slide is slide 2 (index 1)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Click Delete button in ThumbnailRail for active slide (slide 2)",
          "expected": "onSlideDelete(1) called (line 298)"
        },
        {
          "step": 2,
          "action": "Verify handleSlideDelete logic",
          "expected": "Guard check passes (slides.length > 1 at line 175), filter removes slide at index 1 (line 176)"
        },
        {
          "step": 3,
          "action": "Verify active index adjustment",
          "expected": "activeSlideIndex updated to Math.min(activeSlideIndex, newSlides.length - 1) = min(1, 1) = 1 (line 178)"
        },
        {
          "step": 4,
          "action": "Check canvas updates",
          "expected": "EditorCanvas shows slide 3 (now at index 1 after deletion)"
        },
        {
          "step": 5,
          "action": "Verify ThumbnailRail updates",
          "expected": "Only 2 thumbnails remain, slide 3 is now active"
        },
        {
          "step": 6,
          "action": "Attempt to delete when only 1 slide remains",
          "expected": "Guard check fails (slides.length <= 1), early return (line 175), no deletion occurs"
        }
      ],
      "acceptance_criteria": [
        "Slide is removed from slides array",
        "Active index adjusts to show nearest remaining slide",
        "If deleting active slide, show previous or next slide",
        "If deleting last slide, show second-to-last slide",
        "Cannot delete when only 1 slide remains",
        "ThumbnailRail Delete button is disabled when slides.length <= 1",
        "Auto-save triggers after deletion",
        "Slide counter updates correctly"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/editor/[id]/page.tsx",
        "apps/nextjs/src/components/editor/ThumbnailRail.tsx"
      ],
      "tags": [
        "editor",
        "delete-slide",
        "integration",
        "safety"
      ],
      "notes": "handleSlideDelete at lines 174-179. Guard at line 175 prevents deleting last slide. Index adjustment at line 178."
    },
    {
      "id": "TC-EDPAGE-011",
      "name": "Drag-and-drop slide reordering updates order and active index",
      "module": "editor_page",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "medium",
      "description": "Validates that dragging a slide to a new position reorders the slides array and updates activeSlideIndex to follow the moved slide",
      "business_context": "Slide reordering is a key editing workflow for structuring carousel flow. Order changes must be instant and persist.",
      "preconditions": [
        "Editor page is loaded",
        "Project has 4 slides",
        "Active slide is slide 2 (index 1)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Drag slide 2 (index 1) to position 4 (index 3)",
          "expected": "onSlideReorder(1, 3) called (line 299)"
        },
        {
          "step": 2,
          "action": "Verify handleSlideReorder logic",
          "expected": "Array.splice removes slide at index 1 (line 183), inserts at index 3 (line 184)"
        },
        {
          "step": 3,
          "action": "Verify active index follows moved slide",
          "expected": "setActiveSlideIndex(toIndex) = 3 (line 186)"
        },
        {
          "step": 4,
          "action": "Check ThumbnailRail updates",
          "expected": "Slides reorder visually, previously slide 2 now at position 4, still active"
        },
        {
          "step": 5,
          "action": "Verify auto-save triggers",
          "expected": "useEffect detects slides change, calls save() with updated orderIndex for each slide"
        },
        {
          "step": 6,
          "action": "Reload page",
          "expected": "Slides load in new order (orderIndex persisted to database)"
        }
      ],
      "acceptance_criteria": [
        "Slides array reorders correctly (moved slide at new position)",
        "Active index updates to follow moved slide",
        "ThumbnailRail shows new order immediately",
        "Canvas continues showing the moved slide (no content change)",
        "Auto-save updates orderIndex for all slides",
        "Order persists after page refresh",
        "No visual glitches during drag"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/editor/[id]/page.tsx",
        "apps/nextjs/src/components/editor/ThumbnailRail.tsx"
      ],
      "tags": [
        "editor",
        "reorder",
        "drag-drop",
        "integration"
      ],
      "notes": "handleSlideReorder at lines 181-187. Uses Array.splice for in-place reordering. Auto-save includes orderIndex (line 40)."
    },
    {
      "id": "TC-EDPAGE-012",
      "name": "Export button opens export modal with correct props",
      "module": "editor_page",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that clicking Export button opens the ExportModal component and handleExport callback is wired correctly",
      "business_context": "Export is the final step in the carousel creation workflow. Modal must open with correct project data.",
      "preconditions": [
        "Editor page is loaded",
        "Project has at least 1 slide"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Click Export button in header (data-testid='export_button')",
          "expected": "setShowExportModal(true) called (line 281)"
        },
        {
          "step": 2,
          "action": "Verify ExportModal renders",
          "expected": "ExportModal component renders (lines 339-344), receives onClose and onExport props"
        },
        {
          "step": 3,
          "action": "Click Close button in modal",
          "expected": "onClose() \u2192 setShowExportModal(false) hides modal (line 341)"
        },
        {
          "step": 4,
          "action": "Re-open modal and click Export with options (e.g., PDF, All slides)",
          "expected": "onExport(options) \u2192 handleExport(options) called (line 342)"
        },
        {
          "step": 5,
          "action": "Verify handleExport logs options",
          "expected": "console.log('Exporting:', options) (line 205), modal closes (line 207)"
        }
      ],
      "acceptance_criteria": [
        "Export button is always visible in header",
        "Export button has data-testid='export_button' for testing",
        "Modal opens on button click",
        "Modal closes on cancel/close button",
        "handleExport receives export options (format, slides, etc.)",
        "Modal closes after successful export initiation",
        "Export modal is only rendered when showExportModal is true (line 339)"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/editor/[id]/page.tsx",
        "apps/nextjs/src/components/editor/ExportModal.tsx"
      ],
      "tags": [
        "editor",
        "export",
        "modal",
        "integration"
      ],
      "notes": "Export modal at lines 339-344. handleExport at lines 204-208 is a placeholder (actual export logic to be implemented)."
    },
    {
      "id": "TC-EDPAGE-013",
      "name": "Free tier users see watermark on canvas",
      "module": "editor_page",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "medium",
      "description": "Validates that free tier users see 'QuickCarousals.com' watermark on canvas while paid tier users do not",
      "business_context": "Watermark is a key feature gate for free tier. Must display consistently for free users, hidden for paid users.",
      "preconditions": [
        "Editor page is loaded"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Load editor as free tier user",
          "expected": "useSubscription hook returns subscription.canUse('watermark') = true (line 24)"
        },
        {
          "step": 2,
          "action": "Verify watermark prop passed to canvas",
          "expected": "EditorCanvas receives showWatermark={true} (line 309)"
        },
        {
          "step": 3,
          "action": "Check canvas rendering",
          "expected": "Canvas displays 'QuickCarousals.com' watermark at (540, 1320) in semi-transparent gray"
        },
        {
          "step": 4,
          "action": "Load editor as Creator/Pro tier user",
          "expected": "subscription.canUse('watermark') = false, showWatermark={false}"
        },
        {
          "step": 5,
          "action": "Verify no watermark on paid tier",
          "expected": "Canvas does not render watermark"
        }
      ],
      "acceptance_criteria": [
        "Free tier users see watermark on ALL slides",
        "Creator/Pro tier users do NOT see watermark",
        "Watermark is visible but non-intrusive (semi-transparent)",
        "Watermark persists across slide navigation",
        "Watermark appears in exported PDF/PNG for free tier"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/editor/[id]/page.tsx",
        "apps/nextjs/src/components/editor/EditorCanvas.tsx",
        "apps/nextjs/src/hooks/use-subscription.ts"
      ],
      "tags": [
        "editor",
        "watermark",
        "feature-gating",
        "subscription"
      ],
      "notes": "Watermark logic at line 24. Passed to EditorCanvas at line 309. Canvas renders watermark based on this prop."
    },
    {
      "id": "TC-EDPAGE-014",
      "name": "Back button navigates to dashboard",
      "module": "editor_page",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "low",
      "description": "Validates that clicking the Back button in header returns user to the dashboard",
      "business_context": "Navigation back to dashboard is a common exit flow from editor. Must work reliably.",
      "preconditions": [
        "Editor page is loaded"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Click the '\u2190 Back' button in header",
          "expected": "router.push('/en/dashboard') called (line 264)"
        },
        {
          "step": 2,
          "action": "Verify navigation occurs",
          "expected": "Page navigates to /en/dashboard, dashboard loads with project list"
        },
        {
          "step": 3,
          "action": "Check if unsaved changes are lost",
          "expected": "Auto-save has already saved changes (debounce 500ms), or changes are in-flight during navigation"
        }
      ],
      "acceptance_criteria": [
        "Back button always visible in header",
        "Click triggers navigation to /en/dashboard",
        "No confirmation modal (auto-save handles data persistence)",
        "Navigation completes within 1 second",
        "Browser back button also works (Next.js router history)"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/editor/[id]/page.tsx"
      ],
      "tags": [
        "editor",
        "navigation",
        "ux"
      ],
      "notes": "Back button at lines 263-268. No unsaved changes warning (auto-save handles this)."
    },
    {
      "id": "TC-EDPAGE-015",
      "name": "Test page provides isolated environment for component testing",
      "module": "editor_page",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "low",
      "description": "Validates that /editor/test page renders all editor components with sample data for testing without database dependencies",
      "business_context": "Test page allows developers to test editor components in isolation without needing a real project. Useful for development and debugging.",
      "preconditions": [
        "Dev environment running"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to /en/editor/test",
          "expected": "Test page loads with sample slides (6 slides with different layouts)"
        },
        {
          "step": 2,
          "action": "Verify all components render",
          "expected": "ThumbnailRail, EditorCanvas, StyleKitSelector, ThemeControls, LayoutVariantSelector all visible"
        },
        {
          "step": 3,
          "action": "Test auto-save indicator",
          "expected": "Save status shows saving \u2192 saved transitions, console.log shows auto-save triggered (line 230)"
        },
        {
          "step": 4,
          "action": "Test all slide actions (add, duplicate, delete, reorder)",
          "expected": "All actions work, state updates correctly, no API calls made"
        },
        {
          "step": 5,
          "action": "Test export button",
          "expected": "Export modal opens, mock handleExport returns mock export ID (lines 391-413)"
        }
      ],
      "acceptance_criteria": [
        "Test page loads without database connection",
        "All 6 sample slides render correctly (different layouts)",
        "All editor interactions work (add, duplicate, delete, reorder, edit)",
        "Auto-save logs to console instead of calling API",
        "Export returns mock data",
        "Overflow test slide (slide 6) shows red border and Fix with AI button",
        "All style kits available in selector",
        "Layout variants filter correctly by slideType"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/editor/test/page.tsx"
      ],
      "tags": [
        "editor",
        "testing",
        "development",
        "isolated-environment"
      ],
      "notes": "Test page at editor/test/page.tsx. Sample data defined at lines 8-205. Mock auto-save at lines 229-234. Mock export at lines 391-413."
    },
    {
      "id": "TC-EXPORT-001",
      "name": "User can initiate PDF export from ExportModal",
      "module": "export_system",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that user can successfully configure and start a PDF export from the export modal UI",
      "business_context": "PDF export is the primary export format for LinkedIn carousels. Must be intuitive and work reliably for all users.",
      "preconditions": [
        "User is on editor page with saved project",
        "Project has at least 1 slide",
        "Export button is clicked to open modal"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Verify modal opens with PDF format selected by default",
          "expected": "ExportModal renders with format state = 'PDF' (line 30), PDF button has blue border and 'Selected' text"
        },
        {
          "step": 2,
          "action": "Enter custom filename 'my-linkedin-carousel' in filename input",
          "expected": "Filename state updates (line 215), input shows entered text"
        },
        {
          "step": 3,
          "action": "Check 'Include cover thumbnail' checkbox",
          "expected": "includeCoverThumbnail state = true (line 231)"
        },
        {
          "step": 4,
          "action": "Click 'Start Export' button",
          "expected": "handleExport called (line 97-115), onExport prop invoked with { format: 'PDF', filename: 'my-linkedin-carousel', includeCoverThumbnail: true }"
        },
        {
          "step": 5,
          "action": "Verify export initiated",
          "expected": "isExporting state = true (line 98), exportId set (line 108), status = 'PENDING' (line 109), progress UI shows"
        }
      ],
      "acceptance_criteria": [
        "PDF format is selected by default",
        "Filename input accepts alphanumeric and special characters",
        "Cover thumbnail checkbox is optional (unchecked by default)",
        "Start Export button is always enabled (no validation required)",
        "Modal transitions to progress UI after export starts",
        "onExport callback receives correct export options",
        "Format description shows 'Single PDF file with all slides (best for LinkedIn upload)'"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/ExportModal.tsx"
      ],
      "tags": [
        "export",
        "pdf",
        "ui",
        "modal",
        "core-feature"
      ],
      "notes": "ExportModal component at lines 1-351. Format selection at lines 165-204. Filename input at lines 206-223. Export button at lines 254-260."
    },
    {
      "id": "TC-EXPORT-002",
      "name": "User can switch to PNG export format",
      "module": "export_system",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that user can select PNG format and export receives multiple image files",
      "business_context": "PNG export provides individual slide images for social media posting. Must support multiple file downloads.",
      "preconditions": [
        "Export modal is open",
        "Project has at least 1 slide"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Click on PNG format button",
          "expected": "setFormat('PNG') called (line 185), PNG button gets blue border and 'Selected' text, PDF button returns to default styling"
        },
        {
          "step": 2,
          "action": "Verify format description updates",
          "expected": "Description text shows 'Individual PNG images for each slide' (line 202)"
        },
        {
          "step": 3,
          "action": "Click Start Export with PNG selected",
          "expected": "onExport called with { format: 'PNG', filename, includeCoverThumbnail }"
        },
        {
          "step": 4,
          "action": "Wait for export completion",
          "expected": "downloadUrls array contains multiple URLs (one per slide), line 313 shows 'Download Slides (N images)' heading"
        },
        {
          "step": 5,
          "action": "Verify multiple download buttons appear",
          "expected": "One button per slide (lines 313-324), each labeled 'Download Slide 1', 'Download Slide 2', etc."
        }
      ],
      "acceptance_criteria": [
        "PNG format can be selected by clicking button",
        "Format description updates to show PNG-specific text",
        "Export produces multiple PNG files (one per slide)",
        "Each PNG gets individual download button",
        "Filenames append slide number: 'filename-1.png', 'filename-2.png', etc. (line 120)",
        "All PNGs have same dimensions (1080x1350px)"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/ExportModal.tsx",
        "apps/nextjs/src/app/api/exports/[id]/route.ts"
      ],
      "tags": [
        "export",
        "png",
        "ui",
        "multiple-files"
      ],
      "notes": "PNG format selection at lines 182-197. Multiple download UI at lines 309-325. Export API handles PNG array at exports/[id]/route.ts lines 82-93."
    },
    {
      "id": "TC-EXPORT-003",
      "name": "Export job queues successfully via POST /api/exports",
      "module": "export_system",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that POST /api/exports creates Export record and queues BullMQ job for background processing",
      "business_context": "Export queueing is the entry point for all exports. Must handle project validation, ownership checks, and queue initialization reliably.",
      "preconditions": [
        "User is authenticated with valid userId",
        "User has a project with at least 1 slide",
        "Redis/BullMQ is running and accessible"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST /api/exports with body { projectId, type: 'PDF' }",
          "expected": "Request passes validation (line 29), body matches CreateExportSchema (lines 18-21)"
        },
        {
          "step": 2,
          "action": "Check user profile lookup",
          "expected": "Profile found by clerkUserId (lines 32-36), profile.id available"
        },
        {
          "step": 3,
          "action": "Check project ownership verification",
          "expected": "Project found and userId matches profile.id (lines 43-52), 404 if not found or access denied"
        },
        {
          "step": 4,
          "action": "Check slide validation",
          "expected": "Slides fetched and ordered by orderIndex (lines 54-60), 400 validation error if 0 slides (lines 62-64)"
        },
        {
          "step": 5,
          "action": "Verify Export record creation",
          "expected": "Export inserted with status PENDING, projectId, exportType (lines 67-76)"
        },
        {
          "step": 6,
          "action": "Verify job queued",
          "expected": "addRenderJob called with projectId, exportId, exportType, userId, slideIds (lines 79-85)"
        },
        {
          "step": 7,
          "action": "Check API response",
          "expected": "201 status with { id, projectId, type, status: 'PENDING', createdAt } (lines 88-94)"
        }
      ],
      "acceptance_criteria": [
        "API returns 401 if user not authenticated",
        "API returns 404 if project not found or user doesn't own it",
        "API returns 400 if project has 0 slides",
        "Export record created in database with PENDING status",
        "BullMQ job added to 'render' queue with correct data",
        "Response includes exportId for polling",
        "Job uses exportId as jobId for idempotency (render-queue.ts line 134)",
        "All slide IDs are included in job data"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/exports/route.ts",
        "apps/nextjs/src/lib/queues/render-queue.ts"
      ],
      "tags": [
        "export",
        "api",
        "queue",
        "bullmq",
        "validation"
      ],
      "notes": "POST handler at lines 27-95. Validation at lines 29-64. Export creation at lines 67-76. Queue job at lines 79-85."
    },
    {
      "id": "TC-EXPORT-004",
      "name": "Export status polling returns correct status via GET /api/exports/[id]",
      "module": "export_system",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that GET /api/exports/[id] returns current export status and signed download URLs when complete",
      "business_context": "Status polling is how frontend tracks export progress. Must provide real-time updates and secure download URLs.",
      "preconditions": [
        "User is authenticated",
        "Export record exists in database",
        "User owns the project associated with the export"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send GET /api/exports/[exportId] while export is PENDING",
          "expected": "Response: { id, projectId, type, status: 'PENDING', createdAt, completedAt: null } (lines 60-76)"
        },
        {
          "step": 2,
          "action": "Send GET while export is PROCESSING",
          "expected": "Response: { status: 'PROCESSING' }, no fileUrl yet"
        },
        {
          "step": 3,
          "action": "Send GET after export completes (COMPLETED)",
          "expected": "Response includes status: 'COMPLETED', completedAt timestamp (line 75)"
        },
        {
          "step": 4,
          "action": "Check signed URL generation for PDF",
          "expected": "fileUrl string, getSignedUrl called for single path (lines 96), signed URL expires in 24 hours (storage.ts line 70)"
        },
        {
          "step": 5,
          "action": "Check signed URL generation for PNG",
          "expected": "fileUrl parsed as JSON array (line 83), signedUrls array with one URL per PNG (lines 85-89)"
        },
        {
          "step": 6,
          "action": "Send GET after export fails (FAILED)",
          "expected": "Response: { status: 'FAILED', errorMessage: 'error details' } (lines 106-108)"
        },
        {
          "step": 7,
          "action": "Verify ownership enforcement",
          "expected": "404 if user doesn't own project (lines 38-57), inner join ensures ownership check"
        }
      ],
      "acceptance_criteria": [
        "API returns 401 if user not authenticated",
        "API returns 404 if export not found or user doesn't own project",
        "Status transitions: PENDING \u2192 PROCESSING \u2192 COMPLETED or FAILED",
        "Signed URLs generated for COMPLETED exports (24-hour expiry)",
        "PNG exports return array of URLs (one per slide)",
        "PDF exports return single URL string",
        "FAILED exports include errorMessage field",
        "Signed URL generation failure doesn't crash request (line 99-102)",
        "Response format is consistent across all statuses"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/exports/[id]/route.ts",
        "apps/nextjs/src/lib/storage.ts"
      ],
      "tags": [
        "export",
        "api",
        "polling",
        "signed-urls",
        "security"
      ],
      "notes": "GET handler at lines 17-111. Ownership check via join at lines 38-53. Signed URL generation at lines 79-103."
    },
    {
      "id": "TC-EXPORT-005",
      "name": "BullMQ worker processes PDF export job successfully",
      "module": "export_system",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that render worker fetches slide data, generates PDF, uploads to storage, and updates Export record",
      "business_context": "Worker is the core of export processing. Must reliably render slides, generate PDFs, and handle storage uploads.",
      "preconditions": [
        "BullMQ worker is running",
        "Redis is accessible",
        "Database has project with slides",
        "Supabase Storage is configured"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Worker picks up job from queue",
          "expected": "processRenderJob called with job data (line 296)"
        },
        {
          "step": 2,
          "action": "Worker updates Export status to PROCESSING",
          "expected": "Export.status = 'PROCESSING' (lines 118-122)"
        },
        {
          "step": 3,
          "action": "Worker fetches slide data from database",
          "expected": "fetchSlideDataForRendering returns SlideData[] with content, styleKit, blueprint (lines 65-106)"
        },
        {
          "step": 4,
          "action": "Check watermark logic for free tier",
          "expected": "profile.subscriptionTier = 'FREE' \u2192 showWatermark = true (line 131), otherwise false"
        },
        {
          "step": 5,
          "action": "Worker generates PDF from slide data",
          "expected": "generatePDF(slides, showWatermark) returns PDF buffer (line 137), uses render-slide.ts and generate-pdf.ts"
        },
        {
          "step": 6,
          "action": "Worker uploads PDF to storage",
          "expected": "uploadFile to EXPORTS bucket, path: userId/projectId-timestamp.pdf (lines 140-148)"
        },
        {
          "step": 7,
          "action": "Worker updates Export to COMPLETED",
          "expected": "Export.status = 'COMPLETED', fileUrl = storage path, completedAt = now (lines 151-159)"
        },
        {
          "step": 8,
          "action": "Check job completion",
          "expected": "Worker logs success, job marked as completed, returns { success: true, fileUrl } (line 320)"
        }
      ],
      "acceptance_criteria": [
        "Worker processes jobs with concurrency = 2 (render-worker.ts line 350)",
        "Export status updates: PENDING \u2192 PROCESSING \u2192 COMPLETED",
        "PDF generated with correct dimensions (1080x1350 per page)",
        "All slides included in PDF in correct order (orderIndex ASC)",
        "Watermark applied for free tier users, omitted for paid tiers",
        "PDF uploaded to storage successfully",
        "Export record updated with fileUrl and completedAt",
        "Worker logs all steps for debugging",
        "Job marked as completed in BullMQ"
      ],
      "related_files": [
        "apps/nextjs/src/lib/queues/render-worker.ts",
        "apps/nextjs/src/lib/generate-pdf.ts",
        "apps/nextjs/src/lib/render-slide.ts",
        "apps/nextjs/src/lib/storage.ts"
      ],
      "tags": [
        "export",
        "worker",
        "bullmq",
        "pdf",
        "background-job"
      ],
      "notes": "processPDFExport at lines 111-162. Main processor at lines 296-338. Worker setup at lines 345-369."
    },
    {
      "id": "TC-EXPORT-006",
      "name": "BullMQ worker processes PNG export job successfully",
      "module": "export_system",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that worker renders each slide as individual PNG, uploads all to storage, and stores URLs as JSON array",
      "business_context": "PNG export provides individual images for social media. Must generate high-quality PNGs and handle multi-file uploads.",
      "preconditions": [
        "BullMQ worker is running",
        "Job data has exportType = 'PNG'",
        "Project has multiple slides"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Worker picks up PNG export job",
          "expected": "processPNGExport called (line 167-231)"
        },
        {
          "step": 2,
          "action": "Worker updates Export to PROCESSING",
          "expected": "Export.status = 'PROCESSING' (lines 174-178)"
        },
        {
          "step": 3,
          "action": "Worker fetches slide data and checks watermark",
          "expected": "showWatermark = (subscriptionTier === 'FREE') (line 187)"
        },
        {
          "step": 4,
          "action": "Worker renders each slide to PNG buffer",
          "expected": "renderSlideToCanvas called for each slide (line 195), buffers array contains one Buffer per slide"
        },
        {
          "step": 5,
          "action": "Worker uploads each PNG to storage",
          "expected": "Loop uploads all buffers (lines 200-214), filenames: projectId-slide-N-timestamp.png"
        },
        {
          "step": 6,
          "action": "Worker collects all URLs",
          "expected": "urls array contains storage path for each PNG (line 212)"
        },
        {
          "step": 7,
          "action": "Worker stores URLs as JSON array",
          "expected": "fileUrl = JSON.stringify(urls) (line 217), stored in Export.fileUrl"
        },
        {
          "step": 8,
          "action": "Worker updates Export to COMPLETED",
          "expected": "Export.status = 'COMPLETED', fileUrl = JSON array string, completedAt = now (lines 220-228)"
        }
      ],
      "acceptance_criteria": [
        "One PNG generated per slide",
        "All PNGs have 1080x1350 dimensions",
        "Watermark applied to all PNGs for free tier",
        "Each PNG uploaded to storage with unique filename",
        "URLs stored as JSON array in Export.fileUrl",
        "Export status updated to COMPLETED after all uploads",
        "Worker handles failures gracefully (if one upload fails, job fails)",
        "PNG generation uses @napi-rs/canvas (Skia-based) for consistent quality"
      ],
      "related_files": [
        "apps/nextjs/src/lib/queues/render-worker.ts",
        "apps/nextjs/src/lib/render-slide.ts"
      ],
      "tags": [
        "export",
        "worker",
        "png",
        "multiple-files"
      ],
      "notes": "processPNGExport at lines 167-231. PNG array parsing in exports/[id]/route.ts at lines 82-93."
    },
    {
      "id": "TC-EXPORT-007",
      "name": "THUMBNAIL export generates cover image from first slide",
      "module": "export_system",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that THUMBNAIL export type renders only the first slide as a PNG for use as project cover",
      "business_context": "Thumbnails are used for project previews on dashboard. Must be fast and use first slide only.",
      "preconditions": [
        "Project has at least 1 slide",
        "Export created with type: 'THUMBNAIL'"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Worker picks up THUMBNAIL job",
          "expected": "processThumbnailExport called (line 236-291)"
        },
        {
          "step": 2,
          "action": "Worker fetches all slide data",
          "expected": "fetchSlideDataForRendering returns full slide array (line 259)"
        },
        {
          "step": 3,
          "action": "Worker validates slides exist",
          "expected": "Throws error if slides.length === 0 (lines 261-263)"
        },
        {
          "step": 4,
          "action": "Worker renders ONLY first slide",
          "expected": "renderSlideToCanvas(slides[0], showWatermark) called (line 266), single buffer returned"
        },
        {
          "step": 5,
          "action": "Worker uploads thumbnail PNG",
          "expected": "uploadFile with filename: projectId-thumbnail-timestamp.png (line 269-277)"
        },
        {
          "step": 6,
          "action": "Worker updates Export to COMPLETED",
          "expected": "Export.status = 'COMPLETED', fileUrl = storage path (single string, not array) (lines 280-288)"
        }
      ],
      "acceptance_criteria": [
        "Only first slide rendered (slides[0])",
        "Thumbnail has same dimensions as full export (1080x1350)",
        "Watermark applied for free tier",
        "Single PNG file generated and uploaded",
        "fileUrl stored as string (not JSON array like PNG export)",
        "Error thrown if project has 0 slides",
        "Thumbnail filename includes 'thumbnail' identifier"
      ],
      "related_files": [
        "apps/nextjs/src/lib/queues/render-worker.ts",
        "apps/nextjs/src/lib/render-slide.ts"
      ],
      "tags": [
        "export",
        "thumbnail",
        "worker",
        "cover-image"
      ],
      "notes": "processThumbnailExport at lines 236-291. Always uses slides[0] only."
    },
    {
      "id": "TC-EXPORT-008",
      "name": "ExportModal polls status every 2 seconds until completion",
      "module": "export_system",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that ExportModal continuously polls GET /api/exports/[id] and updates progress UI based on status",
      "business_context": "Polling provides real-time feedback to users. Must update UI smoothly and stop polling when done.",
      "preconditions": [
        "Export initiated via onExport callback",
        "exportId state is set"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Export starts, exportId set",
          "expected": "useEffect polling starts (lines 42-95), setInterval every 2000ms (line 92)"
        },
        {
          "step": 2,
          "action": "First poll returns PENDING",
          "expected": "setStatus('PENDING') (line 74), progress UI shows 'Starting export...' (line 285), progress bar at 25% (line 291)"
        },
        {
          "step": 3,
          "action": "Second poll returns PROCESSING",
          "expected": "setStatus('PROCESSING'), progress UI shows 'Processing slides...' (line 285), progress bar at 75%"
        },
        {
          "step": 4,
          "action": "Third poll returns COMPLETED with fileUrl",
          "expected": "setStatus('COMPLETED'), setDownloadUrls (line 78), clearInterval stops polling (line 79)"
        },
        {
          "step": 5,
          "action": "UI updates to completion state",
          "expected": "Heading: 'Export Complete!' (line 268), download button visible (lines 298-326), green button with '\u2b07\ufe0f Download' text"
        },
        {
          "step": 6,
          "action": "Verify polling stops",
          "expected": "Interval cleared, no more API calls, status remains COMPLETED"
        }
      ],
      "acceptance_criteria": [
        "Polling starts only when exportId is set",
        "Polling interval is 2000ms (2 seconds)",
        "Polling stops when status = COMPLETED or FAILED",
        "Progress bar animates between PENDING (25%) and PROCESSING (75%)",
        "Download buttons appear only after COMPLETED",
        "Error state shows if fetch fails",
        "useEffect cleanup clears interval on unmount (line 94)",
        "Polling doesn't start if exportId is null or status is terminal"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/ExportModal.tsx"
      ],
      "tags": [
        "export",
        "polling",
        "ui",
        "progress",
        "realtime"
      ],
      "notes": "Polling useEffect at lines 42-95. Progress UI at lines 280-295. Status transitions: PENDING \u2192 PROCESSING \u2192 COMPLETED/FAILED."
    },
    {
      "id": "TC-EXPORT-009",
      "name": "Download button triggers browser download with correct filename",
      "module": "export_system",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that clicking download button creates hidden anchor, triggers download, and uses correct filename with extension",
      "business_context": "Download flow is the final user-facing step. Must work across all browsers and provide meaningful filenames.",
      "preconditions": [
        "Export completed successfully",
        "downloadUrls array populated",
        "User is on completion screen"
      ],
      "steps": [
        {
          "step": 1,
          "action": "User clicks download button for PDF",
          "expected": "handleDownload(url) called (line 302), url is signed URL from storage"
        },
        {
          "step": 2,
          "action": "Check anchor element creation",
          "expected": "document.createElement('a') (line 118), link.href = url (line 119), link.download = 'filename.pdf' (line 120)"
        },
        {
          "step": 3,
          "action": "Check filename logic for single file",
          "expected": "Filename: '{filename}.{format.toLowerCase()}' (line 120), e.g., 'my-carousel.pdf'"
        },
        {
          "step": 4,
          "action": "Trigger download programmatically",
          "expected": "link.click() (line 122), browser downloads file with specified filename"
        },
        {
          "step": 5,
          "action": "Check cleanup",
          "expected": "document.body.removeChild(link) (line 123), anchor removed from DOM"
        },
        {
          "step": 6,
          "action": "User clicks download for PNG (multiple files)",
          "expected": "handleDownload(url, index) called (line 316), filename: 'filename-{index+1}.png', e.g., 'my-carousel-1.png'"
        }
      ],
      "acceptance_criteria": [
        "PDF downloads with filename: '{filename}.pdf'",
        "PNG downloads with filename: '{filename}-{index+1}.png'",
        "Anchor element is hidden (never visible to user)",
        "Download triggers immediately on click",
        "Anchor removed after download starts",
        "Works in Chrome, Firefox, Safari (standard download API)",
        "Signed URLs remain valid for 24 hours",
        "No CORS errors on download"
      ],
      "related_files": [
        "apps/nextjs/src/components/editor/ExportModal.tsx"
      ],
      "tags": [
        "export",
        "download",
        "browser",
        "ux"
      ],
      "notes": "handleDownload function at lines 117-124. Single download button at lines 300-308. Multiple download buttons at lines 309-325."
    },
    {
      "id": "TC-EXPORT-010",
      "name": "Free tier users get watermark in exports",
      "module": "export_system",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that free tier users' exports include 'QuickCarousals.com' watermark while paid tiers do not",
      "business_context": "Watermark is a key feature gate for monetization. Must be applied consistently across all export types for free users.",
      "preconditions": [
        "User with FREE subscription tier initiates export",
        "Worker processes export job"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Worker fetches user profile",
          "expected": "profile.subscriptionTier = 'FREE' (render-worker.ts lines 125-129)"
        },
        {
          "step": 2,
          "action": "Worker sets watermark flag",
          "expected": "showWatermark = true for FREE, false for CREATOR/PRO (line 131)"
        },
        {
          "step": 3,
          "action": "Worker renders slide with watermark",
          "expected": "renderSlideToCanvas(slide, showWatermark=true) (line 137), watermark added at (540, 1320) in semi-transparent gray (render-slide.ts lines 279-284)"
        },
        {
          "step": 4,
          "action": "Verify watermark text and styling",
          "expected": "Text: 'QuickCarousals.com', fillStyle: 'rgba(0, 0, 0, 0.4)', font: '14px Inter', centered at canvas width/2"
        },
        {
          "step": 5,
          "action": "Check PDF export includes watermark",
          "expected": "generatePDF(slides, showWatermark=true) (line 137), all pages in PDF have watermark"
        },
        {
          "step": 6,
          "action": "Verify paid tier users don't get watermark",
          "expected": "subscriptionTier = 'CREATOR' or 'PRO' \u2192 showWatermark = false, no watermark rendered"
        }
      ],
      "acceptance_criteria": [
        "FREE tier: watermark on ALL slides in PDF and PNG",
        "CREATOR/PRO tier: NO watermark on any slides",
        "Watermark text is 'QuickCarousals.com'",
        "Watermark is semi-transparent (40% opacity)",
        "Watermark positioned bottom center (540px from left, 1320px from top)",
        "Watermark uses 14px Inter font",
        "Watermark applies to PDF, PNG, and THUMBNAIL exports",
        "No way for free tier to bypass watermark (server-side enforcement)"
      ],
      "related_files": [
        "apps/nextjs/src/lib/queues/render-worker.ts",
        "apps/nextjs/src/lib/render-slide.ts",
        "apps/nextjs/src/lib/generate-pdf.ts"
      ],
      "tags": [
        "export",
        "watermark",
        "feature-gating",
        "subscription",
        "monetization"
      ],
      "notes": "Watermark logic in render-worker.ts at lines 125-131 (PDF), 180-187 (PNG), 249-256 (THUMBNAIL). Rendering in render-slide.ts at lines 279-284."
    },
    {
      "id": "TC-EXPORT-011",
      "name": "Export fails gracefully with error message",
      "module": "export_system",
      "user_journey": null,
      "category": "integration",
      "type": "error_path",
      "priority": "high",
      "description": "Validates that failed exports update status to FAILED, store error message, and display error to user",
      "business_context": "Export failures can occur due to rendering errors, storage issues, or timeouts. Must provide clear error messages for debugging.",
      "preconditions": [
        "Export job queued",
        "Worker attempts to process job",
        "An error occurs during processing (e.g., storage upload fails)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Worker encounters error during PDF generation",
          "expected": "try-catch block catches error (render-worker.ts line 321)"
        },
        {
          "step": 2,
          "action": "Worker logs error",
          "expected": "console.error logs job ID and error details (line 322)"
        },
        {
          "step": 3,
          "action": "Worker updates Export to FAILED",
          "expected": "Export.status = 'FAILED', errorMessage = error.message (lines 325-332)"
        },
        {
          "step": 4,
          "action": "Worker re-throws error",
          "expected": "throw error (line 334), BullMQ marks job as failed, may retry based on job options"
        },
        {
          "step": 5,
          "action": "Frontend polls and receives FAILED status",
          "expected": "GET /api/exports/[id] returns { status: 'FAILED', errorMessage } (exports/[id]/route.ts lines 106-108)"
        },
        {
          "step": 6,
          "action": "ExportModal updates UI to error state",
          "expected": "Heading: 'Export Failed', error message displayed in red banner (ExportModal.tsx lines 330-335)"
        },
        {
          "step": 7,
          "action": "Polling stops",
          "expected": "clearInterval called (line 90), no more status checks"
        }
      ],
      "acceptance_criteria": [
        "Export status updates to FAILED on error",
        "errorMessage field populated with error details",
        "Error logged to console for debugging",
        "Job may be retried (up to 3 attempts, render-queue.ts line 80)",
        "Frontend displays user-friendly error message",
        "Polling stops after FAILED status received",
        "User can close modal and retry export",
        "Error doesn't crash worker or leave orphan jobs"
      ],
      "related_files": [
        "apps/nextjs/src/lib/queues/render-worker.ts",
        "apps/nextjs/src/app/api/exports/[id]/route.ts",
        "apps/nextjs/src/components/editor/ExportModal.tsx"
      ],
      "tags": [
        "export",
        "error-handling",
        "worker",
        "failure"
      ],
      "notes": "Error handling in render-worker.ts at lines 321-334. API error response at exports/[id]/route.ts lines 106-108. UI error display at ExportModal.tsx lines 330-335."
    },
    {
      "id": "TC-EXPORT-012",
      "name": "Export API validates project ownership",
      "module": "export_system",
      "user_journey": null,
      "category": "security",
      "type": "error_path",
      "priority": "critical",
      "description": "Validates that users cannot export projects they don't own",
      "business_context": "Project ownership is critical for data security. Users must only be able to export their own carousels.",
      "preconditions": [
        "User A is authenticated",
        "Project exists but is owned by User B"
      ],
      "steps": [
        {
          "step": 1,
          "action": "User A sends POST /api/exports with User B's projectId",
          "expected": "Request passes authentication (withAuthAndErrors) (line 27)"
        },
        {
          "step": 2,
          "action": "API fetches User A's profile",
          "expected": "Profile lookup succeeds (lines 32-36)"
        },
        {
          "step": 3,
          "action": "API checks project ownership",
          "expected": "Query filters by projectId AND userId (lines 43-48), WHERE clauses enforce ownership"
        },
        {
          "step": 4,
          "action": "Project not found due to ownership mismatch",
          "expected": "executeTakeFirst returns null (line 48), 404 error thrown (lines 50-52)"
        },
        {
          "step": 5,
          "action": "API returns error response",
          "expected": "404 status with message 'Project not found or access denied', no export created"
        },
        {
          "step": 6,
          "action": "Check status polling also enforces ownership",
          "expected": "GET /api/exports/[id] inner joins Project table and filters by userId (exports/[id]/route.ts lines 38-53)"
        }
      ],
      "acceptance_criteria": [
        "POST /api/exports returns 404 if user doesn't own project",
        "Error message is generic ('not found or access denied') to avoid leaking existence",
        "GET /api/exports/[id] also enforces ownership via join",
        "No export record created if ownership check fails",
        "No queue job added if ownership check fails",
        "Ownership checked on EVERY export API call (creation and status)",
        "Cannot bypass check by manipulating exportId"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/exports/route.ts",
        "apps/nextjs/src/app/api/exports/[id]/route.ts"
      ],
      "tags": [
        "export",
        "security",
        "authorization",
        "ownership"
      ],
      "notes": "Ownership check in POST at lines 43-52. Ownership check in GET via join at lines 38-53."
    },
    {
      "id": "TC-EXPORT-013",
      "name": "Export API rejects empty projects",
      "module": "export_system",
      "user_journey": null,
      "category": "api",
      "type": "error_path",
      "priority": "high",
      "description": "Validates that API returns validation error if project has zero slides",
      "business_context": "Cannot export an empty carousel. Must validate before queueing job to avoid wasted worker resources.",
      "preconditions": [
        "User owns a project",
        "Project has 0 slides in database"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST /api/exports with projectId of empty project",
          "expected": "Request passes authentication and ownership checks"
        },
        {
          "step": 2,
          "action": "API fetches slides for project",
          "expected": "SELECT FROM Slide WHERE projectId returns empty array (lines 54-60)"
        },
        {
          "step": 3,
          "action": "API validates slide count",
          "expected": "slides.length === 0 check passes (line 62)"
        },
        {
          "step": 4,
          "action": "API throws validation error",
          "expected": "ApiErrors.validation('Project has no slides to export') (line 63)"
        },
        {
          "step": 5,
          "action": "Check error response",
          "expected": "400 status with error message, no export record created, no job queued"
        }
      ],
      "acceptance_criteria": [
        "API returns 400 validation error if slides.length === 0",
        "Error message: 'Project has no slides to export'",
        "No Export record created in database",
        "No BullMQ job queued",
        "Request fails before any worker processing",
        "User receives clear error in frontend"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/exports/route.ts"
      ],
      "tags": [
        "export",
        "validation",
        "error-handling"
      ],
      "notes": "Slide validation at lines 54-64. Prevents empty project exports."
    },
    {
      "id": "TC-EXPORT-014",
      "name": "Render worker handles font loading gracefully",
      "module": "export_system",
      "user_journey": null,
      "category": "integration",
      "type": "edge_case",
      "priority": "medium",
      "description": "Validates that worker continues rendering if custom fonts fail to load, falling back to system fonts",
      "business_context": "Font loading can fail due to network issues or missing files. Must not block exports.",
      "preconditions": [
        "Worker processes export job",
        "Custom font not available or fails to load"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Worker calls loadDefaultFonts before rendering",
          "expected": "loadDefaultFonts attempts to register fonts (render-slide.ts lines 41-70)"
        },
        {
          "step": 2,
          "action": "Font registration fails",
          "expected": "try-catch catches error (line 66), console.warn logs warning (line 67)"
        },
        {
          "step": 3,
          "action": "Worker continues with available fonts",
          "expected": "Comment: 'Continue rendering with available fonts' (line 68), no error thrown"
        },
        {
          "step": 4,
          "action": "Worker renders slides with fallback fonts",
          "expected": "Slides render using system fonts or already-registered fonts"
        },
        {
          "step": 5,
          "action": "Export completes successfully",
          "expected": "Export status = COMPLETED, PDF/PNG generated with fallback fonts"
        }
      ],
      "acceptance_criteria": [
        "Font loading failure doesn't crash worker",
        "Warning logged to console for debugging",
        "Rendering continues with available/system fonts",
        "Export completes successfully despite font issue",
        "Font cache (registeredFonts Set) prevents re-registration attempts",
        "Visual quality may be degraded but export is functional"
      ],
      "related_files": [
        "apps/nextjs/src/lib/render-slide.ts"
      ],
      "tags": [
        "export",
        "fonts",
        "error-handling",
        "resilience"
      ],
      "notes": "Font loading at lines 41-70. Fallback logic at lines 66-69. Font cache at line 21."
    },
    {
      "id": "TC-EXPORT-015",
      "name": "BullMQ retries failed jobs with exponential backoff",
      "module": "export_system",
      "user_journey": null,
      "category": "integration",
      "type": "error_path",
      "priority": "medium",
      "description": "Validates that transient failures (e.g., network issues) trigger automatic retries with increasing delays",
      "business_context": "Transient errors shouldn't fail exports permanently. Retries improve reliability for temporary issues.",
      "preconditions": [
        "Export job queued",
        "Transient error occurs (e.g., storage upload timeout)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Worker attempts to process job, first attempt fails",
          "expected": "Error thrown, job marked as failed by BullMQ"
        },
        {
          "step": 2,
          "action": "BullMQ checks retry configuration",
          "expected": "Job options: attempts = 3, backoff type = 'exponential', delay = 5000ms (render-queue.ts lines 80-84)"
        },
        {
          "step": 3,
          "action": "BullMQ schedules first retry",
          "expected": "Retry after 5 seconds (5000ms base delay)"
        },
        {
          "step": 4,
          "action": "First retry fails",
          "expected": "Second retry scheduled after ~10 seconds (exponential backoff: 5000 * 2)"
        },
        {
          "step": 5,
          "action": "Second retry fails",
          "expected": "Third retry scheduled after ~20 seconds (exponential backoff: 5000 * 4)"
        },
        {
          "step": 6,
          "action": "Third retry also fails",
          "expected": "Job permanently failed (attemptsMade = 3), Export status = FAILED, errorMessage set"
        },
        {
          "step": 7,
          "action": "Check job history",
          "expected": "Failed job retained for 7 days (render-queue.ts lines 89-92), count = max 5000"
        }
      ],
      "acceptance_criteria": [
        "Jobs retry up to 3 times on failure",
        "Exponential backoff: 5s, 10s, 20s between retries",
        "Transient errors (network, timeout) resolved by retry",
        "Permanent errors (validation, not found) not retried",
        "Export status shows FAILED only after all retries exhausted",
        "Failed jobs kept for 7 days for debugging",
        "Completed jobs kept for 24 hours",
        "Job cleanup prevents unbounded growth (removeOnComplete/removeOnFail)"
      ],
      "related_files": [
        "apps/nextjs/src/lib/queues/render-queue.ts",
        "apps/nextjs/src/lib/queues/render-worker.ts"
      ],
      "tags": [
        "export",
        "bullmq",
        "retry",
        "reliability",
        "error-handling"
      ],
      "notes": "Retry config at render-queue.ts lines 79-93. Worker error handling at render-worker.ts lines 321-334."
    },
    {
      "id": "TC-EXPORT-016",
      "name": "Server-side rendering produces consistent output across environments",
      "module": "export_system",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that slide rendering using @napi-rs/canvas produces identical output regardless of server environment",
      "business_context": "Export quality must be consistent for all users. Skia-based rendering ensures pixel-perfect consistency.",
      "preconditions": [
        "Same slide data with same styleKit",
        "Worker running on different servers (dev, staging, production)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Render same slide on dev environment",
          "expected": "renderSlideToCanvas uses @napi-rs/canvas (Skia-based) (render-slide.ts line 6)"
        },
        {
          "step": 2,
          "action": "Render same slide on production environment",
          "expected": "Same canvas API, same font rendering, same text measurement"
        },
        {
          "step": 3,
          "action": "Compare PNG buffers",
          "expected": "Byte-identical output (or negligible difference due to timestamps)"
        },
        {
          "step": 4,
          "action": "Verify auto-fit algorithm consistency",
          "expected": "calculateOptimalFontSize returns same result for same input (lines 76-112), binary search is deterministic"
        },
        {
          "step": 5,
          "action": "Verify brand kit rendering consistency",
          "expected": "Logo placement (940, 20), handle placement (540, 1310) identical across environments"
        }
      ],
      "acceptance_criteria": [
        "PNG output is identical across dev, staging, production",
        "Font rendering is consistent (Skia-based, not browser-dependent)",
        "Text measurement produces same results",
        "Auto-fit font size is deterministic",
        "Canvas dimensions always 1080x1350 (never scaled)",
        "Brand kit elements positioned identically",
        "No environment-specific rendering differences",
        "@napi-rs/canvas provides cross-platform consistency"
      ],
      "related_files": [
        "apps/nextjs/src/lib/render-slide.ts",
        "apps/nextjs/src/lib/generate-pdf.ts"
      ],
      "tags": [
        "export",
        "rendering",
        "consistency",
        "quality",
        "cross-platform"
      ],
      "notes": "@napi-rs/canvas import at render-slide.ts line 6. Binary search at lines 76-112. Canvas creation at lines 245-246."
    },
    {
      "id": "TC-PROJCRUD-001",
      "name": "User can list all their projects",
      "module": "projects_crud",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that GET /api/projects returns all projects belonging to the authenticated user, ordered by most recently updated",
      "business_context": "Users need to see all their carousels on the dashboard. Projects must be isolated by user and ordered logically.",
      "preconditions": [
        "User is authenticated with valid Clerk session",
        "User has Profile record in database",
        "User has created at least one project"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send GET request to /api/projects with valid auth header",
          "expected": "Request is authenticated by withAuthAndErrors middleware (route.ts line 27)"
        },
        {
          "step": 2,
          "action": "API fetches Profile by clerkUserId",
          "expected": "Profile found (lines 30-38), profile.id retrieved"
        },
        {
          "step": 3,
          "action": "API queries Project table where userId = profile.id",
          "expected": "Kysely query filters by userId, orders by updatedAt desc (lines 41-54)"
        },
        {
          "step": 4,
          "action": "API returns projects array",
          "expected": "200 response with JSON array, each project has id, title, brandKitId, styleKitId, status, createdAt, updatedAt (line 56)"
        }
      ],
      "acceptance_criteria": [
        "Response status is 200",
        "Response is valid JSON array",
        "Each project has all required fields (id, title, styleKitId, status, createdAt, updatedAt)",
        "Projects are ordered by updatedAt descending (most recent first)",
        "Only user's own projects are returned (no other users' projects)",
        "Empty array returned if user has no projects"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/projects/route.ts"
      ],
      "tags": [
        "api",
        "projects",
        "list",
        "crud",
        "auth"
      ],
      "notes": "Uses Kysely query builder for type-safe database queries. Profile lookup is critical - no Profile means 404."
    },
    {
      "id": "TC-PROJCRUD-002",
      "name": "User can create a new project with valid data",
      "module": "projects_crud",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that POST /api/projects creates a new project with validated input, links to user, and returns the created project",
      "business_context": "Project creation is the first step after generation completes. Must validate styleKit and brandKit references.",
      "preconditions": [
        "User is authenticated",
        "User has Profile record",
        "Valid styleKitId exists in database",
        "If brandKitId provided, it belongs to the user"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST to /api/projects with body { title: 'My Carousel', styleKitId: 'valid-id', brandKitId: 'user-brand-id' }",
          "expected": "Request body validated by validateBody (line 75), matches createProjectSchema (lines 14-18)"
        },
        {
          "step": 2,
          "action": "API fetches Profile by clerkUserId",
          "expected": "Profile found (lines 78-86), profile.id retrieved"
        },
        {
          "step": 3,
          "action": "API verifies styleKit exists",
          "expected": "StyleKit query succeeds (lines 88-97), styleKit.id found"
        },
        {
          "step": 4,
          "action": "API verifies brandKit exists and belongs to user (if provided)",
          "expected": "BrandKit query filters by id AND userId (lines 100-111), brandKit found or validation error thrown"
        },
        {
          "step": 5,
          "action": "API inserts new Project record",
          "expected": "Project created with userId, title, styleKitId, brandKitId, status='DRAFT', timestamps (lines 114-126)"
        },
        {
          "step": 6,
          "action": "API returns created project",
          "expected": "201 status with full project object including auto-generated id (line 128)"
        }
      ],
      "acceptance_criteria": [
        "Response status is 201 (Created)",
        "Response contains project object with id, title, styleKitId, brandKitId, status='DRAFT', createdAt, updatedAt",
        "Project is linked to correct user (userId = profile.id)",
        "Project appears in GET /api/projects after creation",
        "Auto-generated UUID is valid",
        "Timestamps (createdAt, updatedAt) are set to current time"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/projects/route.ts"
      ],
      "tags": [
        "api",
        "projects",
        "create",
        "crud",
        "validation"
      ],
      "notes": "Zod validation schema at lines 14-18. BrandKit ownership check is critical security feature (line 104)."
    },
    {
      "id": "TC-PROJCRUD-003",
      "name": "Create project fails with invalid styleKitId",
      "module": "projects_crud",
      "user_journey": null,
      "category": "api",
      "type": "error_path",
      "priority": "high",
      "description": "Validates that project creation fails with 400 error when styleKitId doesn't exist in database",
      "business_context": "StyleKit is required for rendering. Invalid references must be rejected before database insert.",
      "preconditions": [
        "User is authenticated",
        "User sends POST with non-existent styleKitId"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST to /api/projects with { title: 'Test', styleKitId: 'invalid-uuid' }",
          "expected": "Request passes Zod validation (styleKitId is string)"
        },
        {
          "step": 2,
          "action": "API queries StyleKit table",
          "expected": "Query returns null (lines 89-93), no matching styleKit"
        },
        {
          "step": 3,
          "action": "API throws validation error",
          "expected": "ApiErrors.validation thrown with message 'Invalid styleKitId' (line 96)"
        },
        {
          "step": 4,
          "action": "Error handler returns error response",
          "expected": "400 status with JSON { code: 'VALIDATION_ERROR', message: 'Invalid styleKitId' }"
        }
      ],
      "acceptance_criteria": [
        "Response status is 400",
        "Error message clearly states 'Invalid styleKitId'",
        "No project is created in database",
        "Error response matches ApiError format"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/projects/route.ts"
      ],
      "tags": [
        "api",
        "projects",
        "create",
        "error",
        "validation"
      ],
      "notes": "StyleKit validation at lines 89-97. No partial creation occurs (transaction-safe)."
    },
    {
      "id": "TC-PROJCRUD-004",
      "name": "Create project fails when brandKit doesn't belong to user",
      "module": "projects_crud",
      "user_journey": null,
      "category": "security",
      "type": "error_path",
      "priority": "critical",
      "description": "Validates that users cannot link other users' brand kits to their projects - ownership check prevents unauthorized access",
      "business_context": "Brand kits contain user branding (logos, colors). Must prevent users from accessing other users' brand assets.",
      "preconditions": [
        "User A is authenticated",
        "User B has a brand kit with id 'brand-kit-b'",
        "User A tries to create project with brandKitId: 'brand-kit-b'"
      ],
      "steps": [
        {
          "step": 1,
          "action": "User A sends POST with { title: 'Test', styleKitId: 'valid-id', brandKitId: 'brand-kit-b' }",
          "expected": "Request passes initial validation"
        },
        {
          "step": 2,
          "action": "API queries BrandKit with WHERE id = 'brand-kit-b' AND userId = userA.profile.id",
          "expected": "Query returns null (lines 101-106) because brandKit belongs to User B"
        },
        {
          "step": 3,
          "action": "API throws validation error",
          "expected": "ApiErrors.validation thrown with message 'Invalid brandKitId or brand kit not owned by user' (line 109)"
        },
        {
          "step": 4,
          "action": "Error handler returns 400",
          "expected": "400 status with validation error message"
        }
      ],
      "acceptance_criteria": [
        "Response status is 400",
        "Error message indicates brandKit validation failure",
        "No project is created",
        "User cannot access other users' brand assets",
        "Ownership check is performed on every create request"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/projects/route.ts"
      ],
      "tags": [
        "api",
        "projects",
        "create",
        "security",
        "authorization",
        "data-isolation"
      ],
      "notes": "Critical security check at line 104: WHERE userId = profile.id. Prevents cross-user data access."
    },
    {
      "id": "TC-PROJCRUD-005",
      "name": "User can get a single project by ID",
      "module": "projects_crud",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that GET /api/projects/:id returns project details for a specific project owned by the user",
      "business_context": "Editor page loads project data on mount. Must verify ownership before returning data.",
      "preconditions": [
        "User is authenticated",
        "User has created a project with known ID",
        "Project belongs to the user"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send GET to /api/projects/:id with valid project ID in URL",
          "expected": "Request authenticated, projectId extracted from URL path (lines 30-32)"
        },
        {
          "step": 2,
          "action": "API fetches Profile",
          "expected": "Profile found by clerkUserId (lines 35-43)"
        },
        {
          "step": 3,
          "action": "API queries Project with WHERE id = projectId AND userId = profile.id",
          "expected": "Project found (lines 46-59), ownership verified inline"
        },
        {
          "step": 4,
          "action": "API returns project details",
          "expected": "200 response with project object (id, title, brandKitId, styleKitId, status, createdAt, updatedAt) (line 65)"
        }
      ],
      "acceptance_criteria": [
        "Response status is 200",
        "Response contains full project object",
        "All fields match database values",
        "Only returns project if user is owner",
        "Response time is fast (single query)"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/projects/[id]/route.ts"
      ],
      "tags": [
        "api",
        "projects",
        "get",
        "crud",
        "auth"
      ],
      "notes": "Ownership check happens in WHERE clause (line 49), not as separate query. Efficient and secure."
    },
    {
      "id": "TC-PROJCRUD-006",
      "name": "User cannot access another user's project",
      "module": "projects_crud",
      "user_journey": null,
      "category": "security",
      "type": "error_path",
      "priority": "critical",
      "description": "Validates that GET /api/projects/:id returns 404 when user tries to access a project they don't own",
      "business_context": "Projects contain user content. Must prevent unauthorized access to other users' projects.",
      "preconditions": [
        "User A is authenticated",
        "User B has a project with id 'project-b'",
        "User A tries to access /api/projects/project-b"
      ],
      "steps": [
        {
          "step": 1,
          "action": "User A sends GET to /api/projects/project-b",
          "expected": "Request authenticated, projectId extracted"
        },
        {
          "step": 2,
          "action": "API queries Project with WHERE id = 'project-b' AND userId = userA.profile.id",
          "expected": "Query returns null (lines 46-59) because project belongs to User B"
        },
        {
          "step": 3,
          "action": "API checks if project is null",
          "expected": "project is null (line 61), throws ApiErrors.notFound (line 62)"
        },
        {
          "step": 4,
          "action": "Error handler returns 404",
          "expected": "404 status with message 'Project not found'"
        }
      ],
      "acceptance_criteria": [
        "Response status is 404",
        "Error message is 'Project not found' (doesn't reveal project exists)",
        "No project data is returned",
        "User cannot infer existence of other users' projects",
        "Ownership check is automatic via WHERE clause"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/projects/[id]/route.ts"
      ],
      "tags": [
        "api",
        "projects",
        "get",
        "security",
        "authorization",
        "data-isolation"
      ],
      "notes": "Same 404 response whether project doesn't exist or belongs to another user - prevents enumeration attacks."
    },
    {
      "id": "TC-PROJCRUD-007",
      "name": "User can update project title and styleKit",
      "module": "projects_crud",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that PATCH /api/projects/:id updates project fields and returns updated project",
      "business_context": "Users can rename projects and switch style kits from the editor. All fields are optional for partial updates.",
      "preconditions": [
        "User is authenticated",
        "User owns a project",
        "New values are valid (if styleKitId changed, it exists)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send PATCH to /api/projects/:id with { title: 'Updated Title', styleKitId: 'new-style-id' }",
          "expected": "Request body validated by updateProjectSchema (lines 16-21), partial updates allowed"
        },
        {
          "step": 2,
          "action": "API verifies project exists and belongs to user",
          "expected": "Project found with WHERE id AND userId (lines 99-108)"
        },
        {
          "step": 3,
          "action": "API builds updates object with provided fields",
          "expected": "Updates object contains only provided fields + updatedAt (lines 111-118)"
        },
        {
          "step": 4,
          "action": "API updates Project record",
          "expected": "Kysely updateTable executed with WHERE id = projectId (lines 121-126)"
        },
        {
          "step": 5,
          "action": "API returns updated project",
          "expected": "200 response with updated project object (line 128)"
        }
      ],
      "acceptance_criteria": [
        "Response status is 200",
        "Updated fields reflect new values",
        "Unchanged fields remain the same",
        "updatedAt timestamp is updated to current time",
        "title and styleKitId are updated in database",
        "Partial updates work (can update only title without styleKitId)"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/projects/[id]/route.ts"
      ],
      "tags": [
        "api",
        "projects",
        "update",
        "crud",
        "partial-update"
      ],
      "notes": "Optional fields in schema (line 17-20) enable partial updates. updatedAt is always set (line 112)."
    },
    {
      "id": "TC-PROJCRUD-008",
      "name": "User can change project status",
      "module": "projects_crud",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "medium",
      "description": "Validates that PATCH can update project status through DRAFT, PUBLISHED, ARCHIVED lifecycle",
      "business_context": "Projects have status workflow. Users may publish or archive projects. Status affects visibility and actions.",
      "preconditions": [
        "User owns a project with status='DRAFT'"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send PATCH with { status: 'PUBLISHED' }",
          "expected": "Status field validated as enum ['DRAFT', 'PUBLISHED', 'ARCHIVED'] (line 20)"
        },
        {
          "step": 2,
          "action": "API updates project status",
          "expected": "status field updated in database (line 118)"
        },
        {
          "step": 3,
          "action": "API returns updated project",
          "expected": "Project object has status='PUBLISHED'"
        }
      ],
      "acceptance_criteria": [
        "Status can be changed from DRAFT to PUBLISHED",
        "Status can be changed from PUBLISHED to ARCHIVED",
        "Invalid status values are rejected (Zod validation)",
        "Only enum values ['DRAFT', 'PUBLISHED', 'ARCHIVED'] are accepted",
        "Status change is reflected immediately"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/projects/[id]/route.ts"
      ],
      "tags": [
        "api",
        "projects",
        "update",
        "status",
        "workflow"
      ],
      "notes": "Status enum defined in Prisma schema. Zod enum validation at line 20 matches database enum."
    },
    {
      "id": "TC-PROJCRUD-009",
      "name": "User can delete a project",
      "module": "projects_crud",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that DELETE /api/projects/:id removes project and cascades to delete all slides",
      "business_context": "Users need to remove old projects. Cascade delete ensures no orphaned slides remain in database.",
      "preconditions": [
        "User is authenticated",
        "User owns a project",
        "Project has associated slides"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send DELETE to /api/projects/:id",
          "expected": "Request authenticated, projectId extracted (lines 142-145)"
        },
        {
          "step": 2,
          "action": "API fetches Profile",
          "expected": "Profile found (lines 148-156)"
        },
        {
          "step": 3,
          "action": "API executes DELETE with WHERE id AND userId",
          "expected": "Kysely deleteFrom with ownership check (lines 159-163)"
        },
        {
          "step": 4,
          "action": "Database cascades delete to Slide table",
          "expected": "All slides with projectId are deleted (Prisma schema onDelete: Cascade)"
        },
        {
          "step": 5,
          "action": "API checks numDeletedRows",
          "expected": "If 0 rows deleted, throws 404 (lines 165-167). If >0, returns success (line 169)"
        }
      ],
      "acceptance_criteria": [
        "Response status is 200",
        "Response is { success: true }",
        "Project is removed from database",
        "All associated slides are deleted (cascade)",
        "User cannot delete another user's project (404 returned)",
        "Attempting to delete non-existent project returns 404"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/projects/[id]/route.ts",
        "packages/db/prisma/schema.prisma"
      ],
      "tags": [
        "api",
        "projects",
        "delete",
        "crud",
        "cascade"
      ],
      "notes": "Cascade delete defined in Prisma schema (Project.slides relation onDelete: Cascade). NumDeletedRows is BigInt (line 165)."
    },
    {
      "id": "TC-PROJCRUD-010",
      "name": "User can list all slides for a project",
      "module": "projects_crud",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that GET /api/projects/:id/slides returns all slides ordered by orderIndex",
      "business_context": "Editor page loads slides on mount. Must verify project ownership before returning slides.",
      "preconditions": [
        "User is authenticated",
        "User owns a project",
        "Project has at least one slide"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send GET to /api/projects/:id/slides",
          "expected": "Request authenticated, projectId extracted from URL (lines 32-35)"
        },
        {
          "step": 2,
          "action": "API verifies project exists and belongs to user",
          "expected": "Project query with WHERE id AND userId (lines 49-58), ownership check passes"
        },
        {
          "step": 3,
          "action": "API fetches all slides for project",
          "expected": "Slide query with WHERE projectId, ordered by orderIndex asc (lines 61-76)"
        },
        {
          "step": 4,
          "action": "API returns slides array",
          "expected": "200 response with JSON array of slides (line 78)"
        }
      ],
      "acceptance_criteria": [
        "Response status is 200",
        "Response is array of slide objects",
        "Each slide has id, projectId, orderIndex, layoutId, slideType, layers, content, createdAt, updatedAt",
        "Slides are ordered by orderIndex ascending (first slide is index 0)",
        "layers and content are JSON objects (parsed automatically)",
        "Only returns slides for specified project",
        "Returns 404 if project doesn't exist or user doesn't own it"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/projects/[id]/slides/route.ts"
      ],
      "tags": [
        "api",
        "projects",
        "slides",
        "list",
        "crud"
      ],
      "notes": "Ownership check via project lookup (lines 49-58) prevents unauthorized slide access. URL parsing at line 35."
    },
    {
      "id": "TC-PROJCRUD-011",
      "name": "User can update all slides in bulk",
      "module": "projects_crud",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that PUT /api/projects/:id/slides updates multiple slides atomically via auto-save",
      "business_context": "Auto-save hook sends all slides every 500ms. Bulk update is more efficient than individual PATCH requests.",
      "preconditions": [
        "User is authenticated",
        "User owns project",
        "Request includes slides array with valid data"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send PUT with { slides: [{id, layoutId, content, orderIndex}, ...] }",
          "expected": "Request body validated by updateSlidesSchema (lines 15-24)"
        },
        {
          "step": 2,
          "action": "API verifies project ownership",
          "expected": "Project found with WHERE id AND userId (lines 112-121)"
        },
        {
          "step": 3,
          "action": "API updates each slide in parallel",
          "expected": "Promise.all executes updates (lines 124-143), skips temp-* IDs (line 126)"
        },
        {
          "step": 4,
          "action": "Each update sets layoutId, slideType, orderIndex, content, layers, updatedAt",
          "expected": "JSON.stringify for content and layers (lines 136-137), WHERE id AND projectId (line 141)"
        },
        {
          "step": 5,
          "action": "API fetches updated slides",
          "expected": "Fresh query returns all slides ordered by orderIndex (lines 148-153)"
        },
        {
          "step": 6,
          "action": "API returns success + slides",
          "expected": "200 response with { success: true, slides: [...] } (line 155)"
        }
      ],
      "acceptance_criteria": [
        "Response status is 200",
        "All slides are updated in database",
        "Temp IDs (temp-*) are skipped without error",
        "orderIndex is updated for all slides",
        "content and layers JSON is stored correctly",
        "Response includes fresh slides array",
        "No slides are updated if project ownership check fails",
        "Parallel updates complete successfully"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/projects/[id]/slides/route.ts"
      ],
      "tags": [
        "api",
        "projects",
        "slides",
        "update",
        "bulk",
        "auto-save"
      ],
      "notes": "Temp ID skip at line 126 prevents auto-save from updating client-only slides. Promise.all at line 145 runs updates in parallel."
    },
    {
      "id": "TC-PROJCRUD-012",
      "name": "Slides API rejects request if project not owned by user",
      "module": "projects_crud",
      "user_journey": null,
      "category": "security",
      "type": "error_path",
      "priority": "critical",
      "description": "Validates that slides API endpoints verify project ownership before any slide operations",
      "business_context": "Slides contain project content. Must prevent unauthorized access to other users' slides via project ownership check.",
      "preconditions": [
        "User A is authenticated",
        "User B owns project 'project-b' with slides",
        "User A tries to access /api/projects/project-b/slides"
      ],
      "steps": [
        {
          "step": 1,
          "action": "User A sends GET to /api/projects/project-b/slides",
          "expected": "Request authenticated"
        },
        {
          "step": 2,
          "action": "API queries Project with WHERE id AND userId",
          "expected": "Query returns null (lines 49-58) because project belongs to User B"
        },
        {
          "step": 3,
          "action": "API throws 404 error",
          "expected": "ApiErrors.notFound with message 'Project not found' (line 57)"
        },
        {
          "step": 4,
          "action": "Error handler returns 404",
          "expected": "404 response, no slides data returned"
        }
      ],
      "acceptance_criteria": [
        "Response status is 404",
        "No slide data is leaked",
        "Same behavior for GET and PUT endpoints",
        "Error message doesn't reveal project exists",
        "Ownership check happens before any slide queries",
        "Cannot bypass via URL manipulation"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/projects/[id]/slides/route.ts"
      ],
      "tags": [
        "api",
        "projects",
        "slides",
        "security",
        "authorization",
        "data-isolation"
      ],
      "notes": "Project ownership acts as gate for slide access. Both GET and PUT check ownership (lines 49-58 GET, 112-121 PUT)."
    },
    {
      "id": "TC-PROJCRUD-013",
      "name": "Create project without brandKitId succeeds",
      "module": "projects_crud",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "medium",
      "description": "Validates that brandKitId is optional - projects can be created without a brand kit",
      "business_context": "Brand kits are optional premium features. Users without brand kits should still create projects.",
      "preconditions": [
        "User is authenticated",
        "User has no brand kits or chooses not to use one"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST with { title: 'No Brand', styleKitId: 'valid-id' } (no brandKitId)",
          "expected": "Request passes Zod validation - brandKitId is optional (line 17)"
        },
        {
          "step": 2,
          "action": "API skips brandKit validation if not provided",
          "expected": "if (body.brandKitId) block is skipped (line 100)"
        },
        {
          "step": 3,
          "action": "API creates project with brandKitId = null",
          "expected": "Project created with brandKitId: body.brandKitId || null (line 120)"
        },
        {
          "step": 4,
          "action": "API returns project",
          "expected": "201 response with project object where brandKitId is null"
        }
      ],
      "acceptance_criteria": [
        "Project is created successfully",
        "brandKitId field is null in database",
        "No validation errors occur",
        "Project can be edited and exported without brand kit",
        "Response status is 201"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/projects/route.ts"
      ],
      "tags": [
        "api",
        "projects",
        "create",
        "optional",
        "brand-kit"
      ],
      "notes": "Optional field in Zod schema (line 17). Null coalescing at line 120. Prisma schema allows null (brandKitId?)."
    },
    {
      "id": "TC-DASH-001",
      "name": "Dashboard loads successfully with projects displayed",
      "module": "dashboard",
      "user_journey": "returning_user",
      "category": "frontend",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that the dashboard page successfully loads and displays the user's existing carousel projects",
      "business_context": "The dashboard is the primary navigation hub after login. Users need to see their projects at a glance and access them quickly.",
      "preconditions": [
        "User is authenticated and has active session",
        "User has at least 1 project in the database",
        "Database is accessible"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to /en/dashboard",
          "expected": "Page loads within 2 seconds, showing loading skeleton"
        },
        {
          "step": 2,
          "action": "Wait for projects to load from API",
          "expected": "Loading skeleton disappears, project cards appear in a grid layout"
        },
        {
          "step": 3,
          "action": "Verify dashboard header is present",
          "expected": "Heading 'My Carousels' is visible, subtitle 'Create and manage your LinkedIn carousels' is visible"
        },
        {
          "step": 4,
          "action": "Verify 'New Carousel' button is present in header",
          "expected": "Button is visible, clickable, with data-testid='new_project_button'"
        },
        {
          "step": 5,
          "action": "Inspect project cards",
          "expected": "Each card shows: project title, status badge (Draft/Published/Archived), last updated date in format 'MMM DD, YYYY'"
        },
        {
          "step": 6,
          "action": "Hover over a project card",
          "expected": "Card border changes to primary color, shadow appears, title text changes to primary color, cursor is pointer"
        }
      ],
      "acceptance_criteria": [
        "Dashboard page loads within 2 seconds",
        "All projects from GET /api/projects are displayed",
        "Project cards are in a responsive grid: 1 column mobile, 2 columns tablet (md), 3 columns desktop (lg)",
        "Each project card is clickable and links to /editor/{projectId}",
        "Status badge colors are correct: Draft=yellow, Published=green, Archived=gray",
        "Date formatting is consistent across all cards",
        "No console errors during page load",
        "Loading skeleton shows 6 placeholder cards during fetch"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/dashboard/page.tsx",
        "apps/nextjs/src/app/[lang]/(dashboard)/dashboard/layout.tsx",
        "apps/nextjs/src/components/header.tsx"
      ],
      "tags": [
        "dashboard",
        "project-list",
        "core-feature",
        "navigation"
      ]
    },
    {
      "id": "TC-DASH-002",
      "name": "Empty state displays for new users with no projects",
      "module": "dashboard",
      "user_journey": "new_user_onboarding",
      "category": "e2e",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that first-time users see a welcoming empty state with clear call-to-action",
      "business_context": "New users should be guided to create their first carousel. The empty state is critical for conversion and engagement.",
      "preconditions": [
        "User is authenticated",
        "User has 0 projects in database",
        "GET /api/projects returns empty array []"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to /en/dashboard",
          "expected": "Page loads, shows loading skeleton briefly"
        },
        {
          "step": 2,
          "action": "Wait for API response",
          "expected": "Loading skeleton disappears, empty state component appears with data-testid='empty_state'"
        },
        {
          "step": 3,
          "action": "Verify empty state icon",
          "expected": "Sparkles icon is visible in a circular gradient background (primary/10 to primary/5)"
        },
        {
          "step": 4,
          "action": "Verify empty state heading",
          "expected": "Text 'No carousels yet' is displayed in large, bold font"
        },
        {
          "step": 5,
          "action": "Verify empty state description",
          "expected": "Text 'Get started by creating your first LinkedIn carousel. It only takes 3 minutes!' is visible"
        },
        {
          "step": 6,
          "action": "Verify CTA button",
          "expected": "Button labeled 'Create Your First Carousel' is visible, large size, primary styling"
        },
        {
          "step": 7,
          "action": "Click the CTA button",
          "expected": "Navigates to /create page"
        }
      ],
      "acceptance_criteria": [
        "Empty state appears only when projects array is empty (not null or undefined)",
        "Empty state has min-height of 450px and is vertically/horizontally centered",
        "Empty state has dashed border and subtle hover effect (background changes on hover)",
        "CTA button links to /create",
        "Icon, title, description, and button are all properly aligned and spaced",
        "Empty state has fade-in animation on mount",
        "No console errors",
        "Dashboard header 'New Carousel' button is still visible and functional"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/dashboard/page.tsx",
        "apps/nextjs/src/components/empty-placeholder.tsx"
      ],
      "tags": [
        "dashboard",
        "empty-state",
        "onboarding",
        "conversion"
      ]
    },
    {
      "id": "TC-DASH-003",
      "name": "Clicking 'New Carousel' button navigates to create page",
      "module": "dashboard",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates the primary CTA button in the dashboard header navigates correctly",
      "business_context": "Creating new carousels is the primary user action. The button must be easily accessible and functional.",
      "preconditions": [
        "User is on dashboard page",
        "Dashboard is fully loaded (not in loading state)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Locate the 'New Carousel' button in the dashboard header",
          "expected": "Button is visible in top-right area of DashboardHeader, has shadow-sm class, size is lg, data-testid='new_project_button'"
        },
        {
          "step": 2,
          "action": "Hover over the button",
          "expected": "Cursor changes to pointer, button shows hover state (if defined in Button component)"
        },
        {
          "step": 3,
          "action": "Click the 'New Carousel' button",
          "expected": "Page navigates to /en/create (or current locale's /create path)"
        },
        {
          "step": 4,
          "action": "Verify navigation completed",
          "expected": "Create page loads, URL is /en/create, page shows mode selection (Topic/Text)"
        }
      ],
      "acceptance_criteria": [
        "Button is always visible regardless of projects array state (empty or populated)",
        "Button uses Next.js Link component for client-side navigation (no full page reload)",
        "Navigation completes within 1 second",
        "Button remains functional on mobile and tablet viewports",
        "No console errors during navigation"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/dashboard/page.tsx",
        "apps/nextjs/src/components/header.tsx"
      ],
      "tags": [
        "dashboard",
        "navigation",
        "cta",
        "create-flow"
      ]
    },
    {
      "id": "TC-DASH-004",
      "name": "Clicking project card navigates to editor",
      "module": "dashboard",
      "user_journey": "returning_user",
      "category": "frontend",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that clicking on a project card opens the editor for that project",
      "business_context": "Users need quick access to edit their existing projects. Card click is the primary interaction on the dashboard.",
      "preconditions": [
        "User is on dashboard",
        "At least 1 project is displayed",
        "Projects have valid IDs"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Identify a project card on the dashboard",
          "expected": "Card is visible with project title, status badge, and last updated date"
        },
        {
          "step": 2,
          "action": "Hover over the project card",
          "expected": "Card shows hover state: border changes to primary, shadow appears, title changes to primary color, cursor is pointer"
        },
        {
          "step": 3,
          "action": "Click anywhere on the project card",
          "expected": "Page navigates to /en/editor/{projectId} where {projectId} is the project's id field"
        },
        {
          "step": 4,
          "action": "Verify navigation completed",
          "expected": "Editor page loads, URL is /en/editor/{projectId}, editor canvas and controls are visible"
        }
      ],
      "acceptance_criteria": [
        "Entire card is clickable (not just the title)",
        "Card uses Next.js Link for client-side navigation",
        "Navigation preserves current locale in URL",
        "Correct project ID is passed to editor route",
        "Hover effects are smooth with transition-all duration-200",
        "Card remains clickable on all viewport sizes",
        "No console errors during navigation"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/dashboard/page.tsx"
      ],
      "tags": [
        "dashboard",
        "navigation",
        "project-card",
        "editor"
      ]
    },
    {
      "id": "TC-DASH-005",
      "name": "Dashboard handles API fetch error gracefully",
      "module": "dashboard",
      "user_journey": null,
      "category": "frontend",
      "type": "error_path",
      "priority": "high",
      "description": "Validates that if the GET /api/projects call fails, the dashboard doesn't crash and provides feedback",
      "business_context": "Network errors and API failures should not break the user experience. Users should understand what went wrong.",
      "preconditions": [
        "User is authenticated",
        "Network is available but API returns error (500, 503, etc.) OR network request fails"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to /en/dashboard",
          "expected": "Page loads, shows loading skeleton"
        },
        {
          "step": 2,
          "action": "API call to /api/projects fails (simulated: return 500 error or network timeout)",
          "expected": "Loading skeleton disappears after fetch completes/fails"
        },
        {
          "step": 3,
          "action": "Observe dashboard state after error",
          "expected": "Empty state is shown OR no project cards appear (projects array remains empty [])"
        },
        {
          "step": 4,
          "action": "Check browser console",
          "expected": "Error is logged: 'Failed to fetch projects: [error details]'"
        },
        {
          "step": 5,
          "action": "Verify page is still functional",
          "expected": "Dashboard header, navigation, 'New Carousel' button all remain functional and clickable"
        }
      ],
      "acceptance_criteria": [
        "Page does not crash or show white screen",
        "Error is logged to console (line 35: console.error('Failed to fetch projects:', error))",
        "Empty state is displayed (since projects array is empty)",
        "User can still click 'New Carousel' to create a project",
        "Page layout remains intact (header, sidebar, footer visible)",
        "No unhandled promise rejections in console"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/dashboard/page.tsx"
      ],
      "tags": [
        "dashboard",
        "error-handling",
        "api-error",
        "resilience"
      ],
      "notes": "Current implementation: Catch block logs error but doesn't show user-facing error message. Projects array stays empty, so empty state appears. This is acceptable UX but could be improved with explicit error message."
    },
    {
      "id": "TC-DASH-006",
      "name": "Dashboard displays correct status badges with colors",
      "module": "dashboard",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that project status badges are correctly styled based on project status field",
      "business_context": "Status badges help users quickly identify the state of their projects (Draft, Published, Archived).",
      "preconditions": [
        "User is on dashboard",
        "User has projects with different status values: 'DRAFT', 'PUBLISHED', 'ARCHIVED'"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Identify a project card with status='DRAFT'",
          "expected": "Badge shows text 'Draft', background is yellow-100, text is yellow-800, dark mode: bg yellow-900, text yellow-200"
        },
        {
          "step": 2,
          "action": "Identify a project card with status='PUBLISHED'",
          "expected": "Badge shows text 'Published', background is green-100, text is green-800, dark mode: bg green-900, text green-200"
        },
        {
          "step": 3,
          "action": "Identify a project card with status='ARCHIVED'",
          "expected": "Badge shows text 'Archived', background is gray-100, text is gray-800, dark mode: bg gray-800, text gray-200"
        },
        {
          "step": 4,
          "action": "Verify badge styling",
          "expected": "All badges have: rounded-full border, px-2.5 py-0.5 padding, text-xs font-medium"
        }
      ],
      "acceptance_criteria": [
        "Status badge text matches status value (DRAFT\u2192'Draft', PUBLISHED\u2192'Published', ARCHIVED\u2192'Archived')",
        "Color schemes are distinct and accessible (sufficient contrast)",
        "Dark mode colors are properly applied based on system/user preference",
        "Badge is displayed in CardDescription area, aligned with timestamp",
        "Badge text is capitalized correctly (first letter uppercase, rest lowercase)",
        "Badge styling is consistent across all cards"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/dashboard/page.tsx"
      ],
      "tags": [
        "dashboard",
        "status-badge",
        "visual",
        "project-card"
      ]
    },
    {
      "id": "TC-DASH-007",
      "name": "Dashboard loading skeleton displays during initial load",
      "module": "dashboard",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that a loading skeleton appears while projects are being fetched, providing visual feedback",
      "business_context": "Loading states prevent perceived lag and improve user experience by showing that content is loading.",
      "preconditions": [
        "User navigates to dashboard for the first time in session",
        "API call to /api/projects takes at least 500ms (not cached)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to /en/dashboard",
          "expected": "Page loads immediately, loading state is true"
        },
        {
          "step": 2,
          "action": "Observe initial render before API response",
          "expected": "Loading skeleton appears: 6 placeholder cards in a grid (1 col mobile, 2 md, 3 lg)"
        },
        {
          "step": 3,
          "action": "Inspect skeleton card structure",
          "expected": "Each skeleton card has: Card component with h-full, CardHeader with pb-3, 3 animated pulse elements (h-6 mb-2 for title, h-4 w-20 for subtitle, h-4 w-32 in CardContent)"
        },
        {
          "step": 4,
          "action": "Verify animation",
          "expected": "All skeleton elements have animate-pulse class, creating pulsing effect"
        },
        {
          "step": 5,
          "action": "Wait for API response",
          "expected": "Skeleton disappears, replaced by actual project cards OR empty state (based on projects array)"
        }
      ],
      "acceptance_criteria": [
        "Loading skeleton shows exactly 6 placeholder cards",
        "Skeleton layout matches actual project card layout (grid columns responsive)",
        "Pulse animation is smooth and continuous",
        "Skeleton disappears immediately when API response arrives (loading set to false in finally block)",
        "No layout shift (CLS) when skeleton is replaced by real content",
        "Header and 'New Carousel' button are visible even during loading state",
        "No console errors during loading state"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/dashboard/page.tsx"
      ],
      "tags": [
        "dashboard",
        "loading-state",
        "skeleton",
        "ux"
      ]
    },
    {
      "id": "TC-DASH-008",
      "name": "Dashboard respects layout and auth requirements",
      "module": "dashboard",
      "user_journey": null,
      "category": "e2e",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that dashboard layout includes authentication check and proper UI structure (header, sidebar, footer)",
      "business_context": "The dashboard layout provides consistent navigation and ensures only authenticated users can access dashboard content.",
      "preconditions": [
        "User is attempting to access /en/dashboard"
      ],
      "steps": [
        {
          "step": 1,
          "action": "As unauthenticated user, navigate to /en/dashboard",
          "expected": "User is redirected to /en/login-clerk before dashboard renders (layout.tsx line 32: redirect)"
        },
        {
          "step": 2,
          "action": "As authenticated user, navigate to /en/dashboard",
          "expected": "Dashboard loads successfully with full layout"
        },
        {
          "step": 3,
          "action": "Verify header is present",
          "expected": "Sticky header at top with: MainNav items, LocaleChange dropdown, UserAccountNav with user name/email/image"
        },
        {
          "step": 4,
          "action": "Verify sidebar is present (desktop only)",
          "expected": "Left sidebar at 200px width, visible on md+ breakpoints, hidden on mobile, contains DashboardNav with sidebar nav items"
        },
        {
          "step": 5,
          "action": "Verify main content area",
          "expected": "Main content area (children) is rendered in center, flex-1 width, overflow-hidden"
        },
        {
          "step": 6,
          "action": "Verify footer is present",
          "expected": "Footer at bottom with border-t, contains SiteFooter component"
        },
        {
          "step": 7,
          "action": "Verify locale is passed correctly",
          "expected": "All components receive lang param (from params: { lang })"
        }
      ],
      "acceptance_criteria": [
        "Unauthenticated users cannot access dashboard (redirected to login)",
        "getCurrentUser() is called in layout (Server Component) before page renders",
        "Layout is responsive: sidebar hidden on mobile, visible on md+",
        "Header is sticky (top-0 z-40) and stays visible during scroll",
        "All navigation items are localized based on lang param",
        "User info is displayed correctly in UserAccountNav (name, email, image)",
        "Layout has min-h-screen and proper spacing (space-y-6)",
        "Grid layout is 200px sidebar + flex-1 main on md+ breakpoints",
        "No console errors during layout render"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/dashboard/layout.tsx",
        "apps/nextjs/src/app/[lang]/(dashboard)/dashboard/page.tsx"
      ],
      "tags": [
        "dashboard",
        "layout",
        "authentication",
        "navigation",
        "e2e"
      ]
    },
    {
      "id": "TC-BRANDKIT-001",
      "name": "User can list all their brand kits",
      "module": "brand_kit",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that authenticated users can retrieve all their brand kits via GET /api/brand-kits",
      "business_context": "Users need to view all their saved brand identities to select which one to apply to new carousels",
      "preconditions": [
        "User is authenticated with valid Clerk session",
        "User has at least one brand kit created in database"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send GET request to /api/brand-kits with valid auth token",
          "expected": "API returns 200 status code"
        },
        {
          "step": 2,
          "action": "Verify response body structure",
          "expected": "Response is JSON array of brand kit objects"
        },
        {
          "step": 3,
          "action": "Check each brand kit object",
          "expected": "Each object contains: id, userId, name, colors (JSON), fonts (JSON), logoUrl, handle, footerStyle, isDefault (boolean), createdAt, updatedAt"
        },
        {
          "step": 4,
          "action": "Verify ordering",
          "expected": "Brand kits are ordered by isDefault DESC (default first), then createdAt DESC (newest first)"
        },
        {
          "step": 5,
          "action": "Verify data isolation",
          "expected": "Response only includes brand kits where userId matches authenticated user's Profile.id"
        }
      ],
      "acceptance_criteria": [
        "API returns 200 status for authenticated user",
        "Response is valid JSON array",
        "All brand kits belong to requesting user (data isolation)",
        "Default brand kit appears first in list",
        "Colors and fonts fields are JSON strings (not parsed objects)",
        "logoUrl is either valid URL string or null",
        "No brand kits from other users are included",
        "API returns 401 for unauthenticated requests"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/brand-kits/route.ts"
      ],
      "tags": [
        "brand_kit",
        "api",
        "list",
        "auth"
      ],
      "notes": "Route.ts lines 40-62 - fetches via Profile.clerkUserId lookup, ordered by isDefault desc then createdAt desc"
    },
    {
      "id": "TC-BRANDKIT-002",
      "name": "User can create brand kit with JSON body",
      "module": "brand_kit",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that users can create a new brand kit using JSON request body (without logo upload)",
      "business_context": "Users need to save brand identity settings (colors, fonts, handle) to apply consistent branding to carousels",
      "preconditions": [
        "User is authenticated",
        "User's subscription tier allows brand kit creation (Creator: 1, Pro: 5)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST request to /api/brand-kits with JSON body: {name: 'My Brand', colors: {primary: '#000000', secondary: '#FFFFFF', accent: '#FF5733'}, fonts: {headline: 'Inter', body: 'Inter'}, handle: '@myhandle', isDefault: true}",
          "expected": "API returns 201 status code"
        },
        {
          "step": 2,
          "action": "Verify response contains created brand kit",
          "expected": "Response includes: generated id (UUID), userId (Profile.id), name 'My Brand', colors JSON, fonts JSON, handle '@myhandle', logoUrl null, isDefault true, createdAt and updatedAt timestamps"
        },
        {
          "step": 3,
          "action": "Verify isDefault flag behavior",
          "expected": "If isDefault is true, all other user's brand kits have isDefault set to false (lines 147-153)"
        },
        {
          "step": 4,
          "action": "Verify database record created",
          "expected": "BrandKit table has new record with correct values, colors and fonts stored as JSON strings"
        }
      ],
      "acceptance_criteria": [
        "API returns 201 Created with brand kit object",
        "Brand kit is created with correct userId (Profile.id, not Clerk userId)",
        "Colors and fonts objects are stringified to JSON before storage",
        "isDefault flag works: setting true unsets all other user's brand kits",
        "logoUrl is null when no logo uploaded",
        "createdAt and updatedAt are set to current timestamp",
        "API validates name (min 1, max 100 characters)",
        "API validates handle (max 100 characters)",
        "API returns 401 for unauthenticated requests",
        "API returns 404 if user profile not found"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/brand-kits/route.ts"
      ],
      "tags": [
        "brand_kit",
        "api",
        "create",
        "json"
      ],
      "notes": "Route.ts lines 69-174 - supports both JSON and multipart/form-data, validates with CreateBrandKitSchema (lines 19-34)"
    },
    {
      "id": "TC-BRANDKIT-003",
      "name": "User can create brand kit with logo upload",
      "module": "brand_kit",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that users can upload a logo when creating a brand kit via multipart/form-data",
      "business_context": "Users need to upload their logo to display on all generated carousels, ensuring consistent brand identity",
      "preconditions": [
        "User is authenticated",
        "User has image file (PNG, JPEG, SVG, or WebP) under 5MB"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST request to /api/brand-kits with Content-Type: multipart/form-data, including: name='My Brand', colors='{\\'primary\\': \\'#000\\'}', fonts='{\\'headline\\': \\'Inter\\'}', logo=<File>",
          "expected": "API parses form data and extracts fields (lines 88-110)"
        },
        {
          "step": 2,
          "action": "API validates logo file",
          "expected": "File type must be in ['image/png', 'image/jpeg', 'image/jpg', 'image/svg+xml', 'image/webp'] (line 117), file size must be <= 5MB (line 124)"
        },
        {
          "step": 3,
          "action": "API uploads logo to Supabase Storage",
          "expected": "Logo uploaded to 'logos' bucket at path '{userId}/{uniqueFilename}' (lines 128-139), filename includes timestamp for uniqueness"
        },
        {
          "step": 4,
          "action": "API creates brand kit with logoUrl",
          "expected": "Brand kit created with logoUrl set to public URL from storage (line 163)"
        },
        {
          "step": 5,
          "action": "Verify response",
          "expected": "API returns 201 with brand kit object including logoUrl field with full URL"
        }
      ],
      "acceptance_criteria": [
        "Logo uploads successfully to Supabase Storage 'logos' bucket",
        "Logo is stored at path: {userId}/{sanitizedName}-{timestamp}.{extension}",
        "Brand kit logoUrl contains public URL from storage",
        "API rejects invalid file types with validation error",
        "API rejects files over 5MB with validation error",
        "Filename is sanitized (replaces special chars with dashes)",
        "Logo is accessible via returned URL",
        "JSON fields (colors, fonts) are parsed correctly from form data",
        "Logo upload is optional - can create brand kit without it"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/brand-kits/route.ts",
        "apps/nextjs/src/lib/storage.ts"
      ],
      "tags": [
        "brand_kit",
        "api",
        "create",
        "logo",
        "upload",
        "storage"
      ],
      "notes": "Uses uploadFile from storage.ts (lines 31-57) with STORAGE_BUCKETS.LOGOS, generates unique filename with timestamp"
    },
    {
      "id": "TC-BRANDKIT-004",
      "name": "User can update brand kit colors and fonts",
      "module": "brand_kit",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that users can update their brand kit's colors and fonts via PATCH request",
      "business_context": "Users need to refine their brand identity over time as their design preferences evolve",
      "preconditions": [
        "User is authenticated",
        "User has at least one brand kit created",
        "User knows the brand kit ID"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send PATCH request to /api/brand-kits/{id} with JSON body: {colors: {primary: '#FF0000', accent: '#00FF00'}}",
          "expected": "API verifies brand kit ownership (lines 38-63)"
        },
        {
          "step": 2,
          "action": "API validates update data",
          "expected": "UpdateBrandKitSchema validates fields (lines 19-33), all fields are optional for PATCH"
        },
        {
          "step": 3,
          "action": "API updates only provided fields",
          "expected": "Only colors field is updated (lines 172-183), other fields remain unchanged, updatedAt is set to current timestamp"
        },
        {
          "step": 4,
          "action": "Verify response",
          "expected": "API returns 200 with updated brand kit object showing new colors, unchanged fonts/name/handle"
        }
      ],
      "acceptance_criteria": [
        "API returns 200 OK with updated brand kit",
        "Only provided fields are updated (partial update supported)",
        "updatedAt timestamp is refreshed",
        "Other fields remain unchanged",
        "API verifies ownership: returns 404 if brand kit doesn't belong to user",
        "API returns 404 if brand kit ID doesn't exist",
        "Colors are stringified to JSON before storage",
        "isDefault flag behavior: setting true unsets other kits",
        "API returns 401 for unauthenticated requests"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/brand-kits/[id]/route.ts"
      ],
      "tags": [
        "brand_kit",
        "api",
        "update",
        "patch"
      ],
      "notes": "Route.ts lines 70-194 - verifyBrandKitOwnership helper (lines 38-63) ensures data isolation"
    },
    {
      "id": "TC-BRANDKIT-005",
      "name": "User can update brand kit logo (replaces old logo)",
      "module": "brand_kit",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that users can replace an existing logo with a new one via PATCH with multipart/form-data",
      "business_context": "Users need to update their logo when rebranding or improving design quality",
      "preconditions": [
        "User is authenticated",
        "User has brand kit with existing logo",
        "User has new logo file under 5MB"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send PATCH request to /api/brand-kits/{id} with Content-Type: multipart/form-data, including: logo=<NewFile>",
          "expected": "API parses form data and extracts logo file (lines 84-109)"
        },
        {
          "step": 2,
          "action": "API validates new logo file",
          "expected": "File type and size validated (lines 114-123)"
        },
        {
          "step": 3,
          "action": "API deletes old logo from storage",
          "expected": "Old logo file removed from 'logos' bucket (lines 126-140), extraction of path from logoUrl, deletion with deleteFile()"
        },
        {
          "step": 4,
          "action": "API uploads new logo",
          "expected": "New logo uploaded to storage at new path with timestamp (lines 143-153)"
        },
        {
          "step": 5,
          "action": "API updates brand kit logoUrl",
          "expected": "Brand kit logoUrl updated to new public URL (line 182)"
        }
      ],
      "acceptance_criteria": [
        "Old logo is deleted from storage before uploading new one",
        "New logo uploads successfully to 'logos' bucket",
        "Brand kit logoUrl is updated to new logo's URL",
        "Old logo file is no longer accessible (deleted)",
        "If old logo deletion fails, update continues anyway (logged warning, lines 136-139)",
        "New logo gets unique filename with timestamp",
        "API returns 200 with updated brand kit showing new logoUrl",
        "Storage cleanup happens even if URL parsing fails"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/brand-kits/[id]/route.ts",
        "apps/nextjs/src/lib/storage.ts"
      ],
      "tags": [
        "brand_kit",
        "api",
        "update",
        "logo",
        "upload",
        "storage"
      ],
      "notes": "Graceful error handling for old logo deletion (lines 136-139) - doesn't fail update if deletion fails"
    },
    {
      "id": "TC-BRANDKIT-006",
      "name": "User can delete brand kit",
      "module": "brand_kit",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that users can permanently delete their brand kit and associated logo",
      "business_context": "Users need to remove outdated brand identities to keep their account organized",
      "preconditions": [
        "User is authenticated",
        "User has at least one brand kit",
        "Brand kit is not currently in use by any projects"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send DELETE request to /api/brand-kits/{id}",
          "expected": "API verifies ownership (lines 38-63 in helper)"
        },
        {
          "step": 2,
          "action": "API deletes logo from storage if exists",
          "expected": "If brand kit has logoUrl, logo file deleted from 'logos' bucket (lines 209-222)"
        },
        {
          "step": 3,
          "action": "API deletes brand kit record from database",
          "expected": "BrandKit record removed from database (lines 225-229)"
        },
        {
          "step": 4,
          "action": "Verify response",
          "expected": "API returns 200 with {success: true} (line 231)"
        }
      ],
      "acceptance_criteria": [
        "Brand kit is permanently deleted from database",
        "Associated logo is deleted from storage",
        "API returns 200 OK with success: true",
        "API returns 404 if brand kit doesn't exist",
        "API returns 404 if brand kit belongs to different user",
        "If logo deletion fails, database deletion continues (logged warning, lines 219-221)",
        "No orphaned files left in storage",
        "API returns 401 for unauthenticated requests",
        "Deletion is permanent (no soft delete)"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/brand-kits/[id]/route.ts"
      ],
      "tags": [
        "brand_kit",
        "api",
        "delete"
      ],
      "notes": "Route.ts lines 200-232 - graceful error handling for logo deletion, doesn't block database deletion"
    },
    {
      "id": "TC-BRANDKIT-007",
      "name": "Brand Kit Settings page loads existing kits",
      "module": "brand_kit",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that the brand kit settings page loads and displays user's existing brand kits",
      "business_context": "Users need to see all their saved brand kits to select which one to edit",
      "preconditions": [
        "User is authenticated",
        "User navigates to /en/settings/brand-kit",
        "User has at least one brand kit created"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Page loads and calls loadBrandKits() on mount (useEffect line 26-28)",
          "expected": "GET request sent to /api/brand-kits"
        },
        {
          "step": 2,
          "action": "API returns user's brand kits",
          "expected": "brandKits state populated with array of kits (line 36)"
        },
        {
          "step": 3,
          "action": "Page displays brand kit selector card",
          "expected": "Card with title 'Your Brand Kits' appears (lines 190-211), shows button for each kit"
        },
        {
          "step": 4,
          "action": "First kit is loaded automatically",
          "expected": "loadBrandKit() called with first kit (line 40), form fields populated with kit data (lines 50-69)"
        },
        {
          "step": 5,
          "action": "Verify form field population",
          "expected": "Name, handle, colors (primary/secondary/accent), fonts (headline/body) all populated from kit data, logo preview shown if logoUrl exists"
        }
      ],
      "acceptance_criteria": [
        "Page loads without errors",
        "GET /api/brand-kits is called on mount",
        "All user's brand kits displayed as buttons",
        "First kit's data auto-loads into form",
        "Color pickers show correct hex values",
        "Font dropdowns show correct selections",
        "Logo preview displays if kit has logo",
        "+ New Kit button is always visible (line 205-207)",
        "Loading state shows during fetch (setLoading(true) line 31)",
        "Empty state handled gracefully if no kits exist"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/settings/brand-kit/page.tsx"
      ],
      "tags": [
        "brand_kit",
        "frontend",
        "settings",
        "load"
      ],
      "notes": "Page.tsx lines 26-48 loadBrandKits(), lines 50-69 loadBrandKit() - populates all form fields from kit data"
    },
    {
      "id": "TC-BRANDKIT-008",
      "name": "User can create brand kit via settings UI",
      "module": "brand_kit",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates complete brand kit creation flow through the settings UI with all fields",
      "business_context": "Users need an intuitive UI to set up their brand identity without manually calling APIs",
      "preconditions": [
        "User is authenticated",
        "User is on /en/settings/brand-kit page",
        "User clicks '+ New Kit' button or page has no kits"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Enter 'My Personal Brand' in Brand Name input (data-testid='brand_name_input')",
          "expected": "Name state updates (line 230)"
        },
        {
          "step": 2,
          "action": "Enter '@mypersonalbrand' in Handle input (data-testid='brand_handle_input')",
          "expected": "Handle state updates (line 240)"
        },
        {
          "step": 3,
          "action": "Select logo file via file input (data-testid='logo_upload')",
          "expected": "Logo preview appears (80x80 box with image), logoFile state set (lines 72-83)"
        },
        {
          "step": 4,
          "action": "Change primary color to #FF0000 using color picker",
          "expected": "Color picker and text input both show #FF0000 (lines 279-292)"
        },
        {
          "step": 5,
          "action": "Select 'Poppins' for headline font dropdown",
          "expected": "Headline font state updates to 'Poppins' (line 342)"
        },
        {
          "step": 6,
          "action": "Click 'Create Kit' button (data-testid='save_button')",
          "expected": "Form validation passes (name not empty, line 86-89), saving state set to true (line 91)"
        },
        {
          "step": 7,
          "action": "API request is sent",
          "expected": "POST /api/brand-kits with multipart/form-data including all fields and logo file (lines 93-120)"
        },
        {
          "step": 8,
          "action": "API returns success",
          "expected": "Alert shows 'Brand kit created!' (line 124), loadBrandKits() called to refresh list (line 125)"
        }
      ],
      "acceptance_criteria": [
        "All form fields work correctly (name, handle, colors, fonts, logo)",
        "Logo preview updates in real-time via FileReader (lines 77-81)",
        "Color pickers have dual input: color picker + hex text (lines 279-329)",
        "Font dropdowns show 5 options: Inter, Lora, Poppins, Source Sans Pro, Roboto Mono",
        "Save button disabled if name is empty (!name.trim())",
        "Save button shows 'Saving...' during request (line 377)",
        "Preview card updates in real-time as fields change (lines 401-443)",
        "Success alert shown after creation",
        "Brand kit list refreshes to include new kit",
        "isDefault is always set to true for new kits (line 105)"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/settings/brand-kit/page.tsx"
      ],
      "tags": [
        "brand_kit",
        "frontend",
        "create",
        "form",
        "e2e"
      ],
      "notes": "handleSave function (lines 85-136) - uses FormData for multipart upload, includes all fields"
    },
    {
      "id": "TC-BRANDKIT-009",
      "name": "User can update existing brand kit via settings UI",
      "module": "brand_kit",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that users can select and update an existing brand kit through the UI",
      "business_context": "Users need to refine their brand identity over time without creating duplicate kits",
      "preconditions": [
        "User is authenticated",
        "User has at least 2 brand kits",
        "User is on /en/settings/brand-kit page"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Click on second brand kit button in 'Your Brand Kits' card",
          "expected": "loadBrandKit() called with selected kit (line 200), form fields populated with kit's data"
        },
        {
          "step": 2,
          "action": "Verify form shows existing values",
          "expected": "All fields display kit's current values: name, handle, colors, fonts, logo preview if exists"
        },
        {
          "step": 3,
          "action": "Change accent color from current value to #0000FF",
          "expected": "Accent color state updates, preview card shows new color border"
        },
        {
          "step": 4,
          "action": "Click 'Update Kit' button (button text changes based on selectedKitId, line 377)",
          "expected": "PATCH request sent to /api/brand-kits/{selectedKitId} (lines 111-120)"
        },
        {
          "step": 5,
          "action": "API returns updated kit",
          "expected": "Alert shows 'Brand kit updated!' (line 124), list refreshes with updated kit"
        },
        {
          "step": 6,
          "action": "Verify updated kit is still selected",
          "expected": "Form still shows updated kit data, selectedKitId unchanged"
        }
      ],
      "acceptance_criteria": [
        "Clicking kit button loads its data into form",
        "Active kit button has 'default' variant (blue), others have 'outline' (line 199)",
        "Form title changes to 'Edit Brand Kit' when kit selected (line 217)",
        "Save button text changes to 'Update Kit' (line 377)",
        "Delete and Cancel buttons appear when editing (lines 379-396)",
        "PATCH request only includes changed fields (multipart still sends all)",
        "Brand kit list refreshes after update",
        "Preview card reflects changes in real-time",
        "Logo can be updated without changing other fields"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/settings/brand-kit/page.tsx"
      ],
      "tags": [
        "brand_kit",
        "frontend",
        "update",
        "form",
        "e2e"
      ],
      "notes": "loadBrandKit (lines 50-69) populates form, selectedKitId determines create vs update (lines 111-115)"
    },
    {
      "id": "TC-BRANDKIT-010",
      "name": "User can delete brand kit via settings UI",
      "module": "brand_kit",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "medium",
      "description": "Validates that users can delete a brand kit with confirmation dialog",
      "business_context": "Users need to remove outdated brand kits to keep their settings organized",
      "preconditions": [
        "User is authenticated",
        "User has at least one brand kit",
        "User has selected a kit for editing"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Select brand kit to delete",
          "expected": "Form shows kit data, selectedKitId is set, Delete button is visible (line 379-386)"
        },
        {
          "step": 2,
          "action": "Click 'Delete' button",
          "expected": "Browser confirm dialog appears with message 'Are you sure you want to delete this brand kit?' (line 154)"
        },
        {
          "step": 3,
          "action": "Click 'OK' in confirm dialog",
          "expected": "DELETE request sent to /api/brand-kits/{selectedKitId} (line 157-159)"
        },
        {
          "step": 4,
          "action": "API returns success",
          "expected": "Alert shows 'Brand kit deleted!' (line 162), handleNewKit() called to reset form (line 163), loadBrandKits() refreshes list (line 164)"
        },
        {
          "step": 5,
          "action": "Verify form state after deletion",
          "expected": "Form is cleared (name, handle, colors reset to defaults), selectedKitId set to null, deleted kit removed from list"
        }
      ],
      "acceptance_criteria": [
        "Delete button only visible when editing existing kit (selectedKitId check, line 379)",
        "Confirmation dialog prevents accidental deletion",
        "Clicking 'Cancel' in confirm aborts deletion (line 154 early return)",
        "DELETE request sent only after confirmation",
        "Success alert shown after deletion",
        "Form resets to 'Create Brand Kit' mode after deletion",
        "Brand kit list refreshes to exclude deleted kit",
        "No errors if API call fails (caught and alerted, lines 168-171)",
        "Delete button disabled during save operation (line 383)"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/settings/brand-kit/page.tsx"
      ],
      "tags": [
        "brand_kit",
        "frontend",
        "delete",
        "confirmation"
      ],
      "notes": "handleDelete (lines 151-172) - uses browser confirm(), calls handleNewKit to reset form state"
    },
    {
      "id": "TC-BRANDKIT-011",
      "name": "Brand kit preview updates in real-time",
      "module": "brand_kit",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "medium",
      "description": "Validates that the preview card reflects all changes as user edits brand kit fields",
      "business_context": "Users need immediate visual feedback to see how their brand settings will look on carousels",
      "preconditions": [
        "User is on /en/settings/brand-kit page",
        "User is creating or editing a brand kit"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Change brand name to 'Tech Startup'",
          "expected": "Preview card headline updates to 'Tech Startup' (line 421)"
        },
        {
          "step": 2,
          "action": "Change handle to '@techstartup'",
          "expected": "Preview card text updates to '@techstartup' (line 430)"
        },
        {
          "step": 3,
          "action": "Change secondary color to #F0F0F0 (light gray)",
          "expected": "Preview card background color changes to #F0F0F0 (line 410)"
        },
        {
          "step": 4,
          "action": "Change accent color to #00FFFF (cyan)",
          "expected": "Preview card border color changes to #00FFFF (line 411)"
        },
        {
          "step": 5,
          "action": "Change primary color to #333333 (dark gray)",
          "expected": "Preview card headline and text color change to #333333 (lines 417, 425)"
        },
        {
          "step": 6,
          "action": "Change headline font to 'Poppins'",
          "expected": "Preview card headline font changes to Poppins (line 418)"
        },
        {
          "step": 7,
          "action": "Upload logo image",
          "expected": "Logo preview appears in preview card (64x64 box with logo image, lines 432-440)"
        }
      ],
      "acceptance_criteria": [
        "Preview updates immediately on every field change (no debounce)",
        "Preview shows placeholder text if name empty: 'Your Brand Name' (line 421)",
        "Preview shows placeholder handle if empty: '@yourhandle' (line 430)",
        "Background color applied via inline style (line 410)",
        "Border color applied via inline style (line 411)",
        "Text colors applied via inline style (lines 417, 425)",
        "Fonts applied via inline style (lines 418, 427)",
        "Logo preview only shown if logoPreview exists (line 432)",
        "Preview card has rounded corners, 2px border (line 408)",
        "Preview accurately represents final carousel appearance"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/settings/brand-kit/page.tsx"
      ],
      "tags": [
        "brand_kit",
        "frontend",
        "preview",
        "ui"
      ],
      "notes": "Preview card (lines 401-443) uses inline styles with dynamic values from state, updates reactively"
    },
    {
      "id": "TC-BRANDKIT-012",
      "name": "Logo upload validates file type and size",
      "module": "brand_kit",
      "user_journey": null,
      "category": "frontend",
      "type": "error_path",
      "priority": "high",
      "description": "Validates that invalid logo uploads are rejected with clear error messages",
      "business_context": "Users should be prevented from uploading unsupported file types or excessively large files",
      "preconditions": [
        "User is on /en/settings/brand-kit page",
        "User is creating or editing a brand kit"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Attempt to upload a .txt file via logo upload input",
          "expected": "Frontend accept attribute blocks selection (line 262: accept='image/png,image/jpeg,image/svg+xml,image/webp')"
        },
        {
          "step": 2,
          "action": "Bypass frontend validation and upload .txt file to API",
          "expected": "API rejects with validation error: 'Invalid logo file type. Allowed: PNG, JPEG, SVG, WebP' (route.ts line 118)"
        },
        {
          "step": 3,
          "action": "Attempt to upload 6MB PNG file (exceeds 5MB limit)",
          "expected": "API rejects with validation error: 'Logo file too large. Maximum size: 5MB' (route.ts line 124)"
        },
        {
          "step": 4,
          "action": "Upload valid 4MB PNG file",
          "expected": "File uploads successfully, no error"
        }
      ],
      "acceptance_criteria": [
        "File input accept attribute restricts to: PNG, JPEG, SVG, WebP",
        "UI shows help text: 'Supported formats: PNG, JPEG, SVG, WebP (max 5MB)' (line 267-269)",
        "API validates file type server-side (can't rely on client validation)",
        "API validates file size server-side (max 5MB = 5 * 1024 * 1024 bytes)",
        "Clear error messages shown for invalid uploads",
        "Error alerts appear for API validation failures (line 128 in page.tsx)",
        "Valid files under 5MB upload successfully",
        "SVG files are supported (vector format for scalability)"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/brand-kits/route.ts",
        "apps/nextjs/src/app/[lang]/(dashboard)/settings/brand-kit/page.tsx"
      ],
      "tags": [
        "brand_kit",
        "validation",
        "error_path",
        "logo",
        "upload"
      ],
      "notes": "Double validation: frontend accept attribute (UX) + backend type/size checks (security). Route.ts lines 116-125"
    },
    {
      "id": "TC-BRANDKIT-013",
      "name": "Cannot access other users' brand kits",
      "module": "brand_kit",
      "user_journey": null,
      "category": "security",
      "type": "error_path",
      "priority": "critical",
      "description": "Validates that brand kit data isolation prevents users from accessing or modifying other users' brand kits",
      "business_context": "Brand kits contain proprietary brand assets - must be fully isolated per user for security and privacy",
      "preconditions": [
        "Two users exist: User A and User B",
        "User A has brand kit with ID 'kit-a-123'",
        "User B is authenticated"
      ],
      "steps": [
        {
          "step": 1,
          "action": "User B sends GET request to /api/brand-kits",
          "expected": "Response only includes User B's brand kits, User A's kit not included"
        },
        {
          "step": 2,
          "action": "User B sends GET request to /api/brand-kits/kit-a-123 (User A's kit)",
          "expected": "API returns 404 Not Found with message 'Brand kit' (verifyBrandKitOwnership check fails, [id]/route.ts line 58-60)"
        },
        {
          "step": 3,
          "action": "User B sends PATCH request to /api/brand-kits/kit-a-123 with {name: 'Hacked'}",
          "expected": "API returns 404 Not Found, no update occurs (ownership check at line 76)"
        },
        {
          "step": 4,
          "action": "User B sends DELETE request to /api/brand-kits/kit-a-123",
          "expected": "API returns 404 Not Found, User A's kit not deleted (ownership check at line 206)"
        }
      ],
      "acceptance_criteria": [
        "GET /api/brand-kits only returns requesting user's kits (WHERE userId = profile.id, route.ts line 55)",
        "All individual kit operations verify ownership via verifyBrandKitOwnership()",
        "Ownership check queries: WHERE id = kitId AND userId = profile.id ([id]/route.ts line 53-54)",
        "404 returned if kit doesn't exist OR belongs to different user (same error, no info leakage)",
        "Cannot read, update, or delete other users' kits",
        "Logo files stored at {userId}/{filename} - path isolation prevents access",
        "Profile lookup uses clerkUserId to get internal Profile.id",
        "No cross-user data leakage in any brand kit operation"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/brand-kits/route.ts",
        "apps/nextjs/src/app/api/brand-kits/[id]/route.ts"
      ],
      "tags": [
        "brand_kit",
        "security",
        "data_isolation",
        "auth",
        "critical"
      ],
      "notes": "verifyBrandKitOwnership helper ([id]/route.ts lines 38-63) is critical for all operations on individual kits"
    },
    {
      "id": "TC-BRANDKIT-014",
      "name": "Brand kit validation enforces field limits",
      "module": "brand_kit",
      "user_journey": null,
      "category": "api",
      "type": "error_path",
      "priority": "high",
      "description": "Validates that brand kit API enforces Zod schema validation on all fields",
      "business_context": "Field limits prevent database bloat and ensure data quality",
      "preconditions": [
        "User is authenticated"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST /api/brand-kits with empty name: {name: ''}",
          "expected": "API returns 400 validation error: name must have min length 1 (CreateBrandKitSchema line 20)"
        },
        {
          "step": 2,
          "action": "Send POST with 101-character name",
          "expected": "API returns 400 validation error: name max length is 100 (line 20)"
        },
        {
          "step": 3,
          "action": "Send POST with 101-character handle",
          "expected": "API returns 400 validation error: handle max length is 100 (line 30)"
        },
        {
          "step": 4,
          "action": "Send POST with 501-character footerStyle",
          "expected": "API returns 400 validation error: footerStyle max length is 500 (line 31)"
        },
        {
          "step": 5,
          "action": "Send POST with invalid isDefault type (string instead of boolean)",
          "expected": "API returns 400 validation error: isDefault must be boolean (line 32)"
        },
        {
          "step": 6,
          "action": "Send POST with valid fields within limits",
          "expected": "API returns 201 Created, brand kit created successfully"
        }
      ],
      "acceptance_criteria": [
        "Name is required (min 1 char), max 100 chars",
        "Handle is optional, max 100 chars",
        "footerStyle is optional, max 500 chars",
        "isDefault is optional boolean",
        "colors is optional object with optional primary/secondary/accent strings",
        "fonts is optional object with optional headline/body strings",
        "All validation errors return 400 status with clear messages",
        "Valid requests within limits succeed",
        "Both POST and PATCH enforce validation (different schemas)",
        "UpdateBrandKitSchema (PATCH) makes all fields optional"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/brand-kits/route.ts",
        "apps/nextjs/src/app/api/brand-kits/[id]/route.ts"
      ],
      "tags": [
        "brand_kit",
        "validation",
        "api",
        "error_path"
      ],
      "notes": "CreateBrandKitSchema (route.ts lines 19-34), UpdateBrandKitSchema ([id]/route.ts lines 19-33) - all fields optional for PATCH"
    },
    {
      "id": "TC-STYLEKIT-001",
      "name": "List all style kits via GET /api/style-kits",
      "module": "style_kits",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that the style kits API returns all 8 seeded style kits in correct order",
      "business_context": "Style kits are core to carousel design. Users must be able to view all available options to select a style that matches their brand.",
      "preconditions": [
        "Database has been seeded with 8 style kits (4 free, 4 premium)",
        "Dev server is running"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send GET request to /api/style-kits (no authentication required)",
          "expected": "API returns 200 OK with JSON array of 8 style kits"
        },
        {
          "step": 2,
          "action": "Verify response order - free kits come before premium kits",
          "expected": "First 4 items have isPremium: false, next 4 items have isPremium: true"
        },
        {
          "step": 3,
          "action": "Check each style kit has required fields: id, name, typography, colors, spacingRules, isPremium",
          "expected": "All 8 kits contain all required fields with correct data types"
        },
        {
          "step": 4,
          "action": "Verify free kit IDs match seed data: minimal_clean, high_contrast_punch, marker_highlight, sticky_note",
          "expected": "First 4 kits have these exact IDs (seed.ts lines 16-96)"
        },
        {
          "step": 5,
          "action": "Verify premium kit IDs match seed data: corporate_pro, gradient_modern, dark_mode_punch, soft_pastel",
          "expected": "Last 4 kits have these exact IDs (seed.ts lines 97-177)"
        }
      ],
      "acceptance_criteria": [
        "Endpoint is publicly accessible (no auth required)",
        "Returns exactly 8 style kits",
        "Free kits (isPremium: false) appear first, ordered by id asc",
        "Premium kits (isPremium: true) appear second, ordered by id asc",
        "Each kit has valid typography object with headline_font, body_font, weights",
        "Each kit has valid colors object with background, foreground, accent",
        "Each kit has valid spacingRules object with padding and line_height",
        "Response matches StyleKit schema from database"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/style-kits/route.ts",
        "packages/db/prisma/seed.ts"
      ],
      "tags": [
        "style_kits",
        "api",
        "list",
        "core"
      ],
      "notes": "Public endpoint (route.ts lines 10-20). Ordering: isPremium asc, id asc (lines 15-16). Seed data defines 4 free + 4 premium kits (seed.ts lines 15-177)."
    },
    {
      "id": "TC-STYLEKIT-002",
      "name": "Get single style kit by ID via GET /api/style-kits/:id",
      "module": "style_kits",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that fetching a single style kit by ID returns complete kit details",
      "business_context": "Editor and creation flow need to fetch individual style kit details to apply typography, colors, and spacing to carousels.",
      "preconditions": [
        "Database has been seeded with style kits",
        "Style kit with ID 'minimal_clean' exists"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send GET request to /api/style-kits/minimal_clean",
          "expected": "API returns 200 OK with complete style kit object"
        },
        {
          "step": 2,
          "action": "Verify returned kit matches seed data for minimal_clean",
          "expected": "id: 'minimal_clean', name: 'Minimal Clean', isPremium: false"
        },
        {
          "step": 3,
          "action": "Check typography fields",
          "expected": "headline_font: 'Inter', headline_weight: 700, body_font: 'Inter', body_weight: 400"
        },
        {
          "step": 4,
          "action": "Check colors fields",
          "expected": "background: '#FFFFFF', foreground: '#000000', accent: '#F5F5F5'"
        },
        {
          "step": 5,
          "action": "Check spacingRules fields",
          "expected": "padding: 'normal', line_height: 1.5"
        }
      ],
      "acceptance_criteria": [
        "Returns exact style kit matching the ID parameter",
        "All fields match seed data definition (seed.ts lines 16-35)",
        "Response is JSON object (not array)",
        "No authentication required (public endpoint)",
        "Request completes in under 500ms"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/style-kits/[id]/route.ts",
        "packages/db/prisma/seed.ts"
      ],
      "tags": [
        "style_kits",
        "api",
        "detail",
        "core"
      ],
      "notes": "Route extracts ID from URL path (route.ts lines 17-19). Uses executeTakeFirst() for single record (line 26)."
    },
    {
      "id": "TC-STYLEKIT-003",
      "name": "Style kit not found returns 404",
      "module": "style_kits",
      "user_journey": null,
      "category": "api",
      "type": "error_path",
      "priority": "high",
      "description": "Validates proper error handling when requesting a non-existent style kit ID",
      "business_context": "Graceful error handling prevents crashes when users or frontend code reference invalid style kit IDs.",
      "preconditions": [
        "Database is accessible"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send GET request to /api/style-kits/nonexistent_kit_id",
          "expected": "API returns 404 Not Found"
        },
        {
          "step": 2,
          "action": "Check error response format",
          "expected": "Response body contains: {error: {message: 'Style kit not found', code: 'NOT_FOUND'}}"
        },
        {
          "step": 3,
          "action": "Verify error message is user-friendly",
          "expected": "Message doesn't expose internal database details or stack traces"
        }
      ],
      "acceptance_criteria": [
        "Returns 404 status code for non-existent IDs",
        "Error response has consistent format matching ApiErrors pattern",
        "Error code is 'NOT_FOUND' (route.ts line 29)",
        "No database errors or crashes",
        "Request completes quickly (< 200ms) even on error"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/style-kits/[id]/route.ts",
        "apps/nextjs/src/lib/api-error.ts"
      ],
      "tags": [
        "style_kits",
        "api",
        "error_path",
        "validation"
      ],
      "notes": "Uses ApiErrors.notFound() helper (route.ts line 29). Error response format matches project pattern (lines 35-38)."
    },
    {
      "id": "TC-STYLEKIT-004",
      "name": "Free tier users can access all 4 free style kits",
      "module": "style_kits",
      "user_journey": "new_user_onboarding",
      "category": "integration",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that FREE tier users have access to all 4 free style kits when creating carousels",
      "business_context": "Free tier users should have a meaningful selection of styles to create professional carousels without requiring a paid subscription.",
      "preconditions": [
        "User is logged in with FREE subscription tier",
        "User is on /en/create page"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to create page at /en/create",
          "expected": "Page loads successfully with style selection UI"
        },
        {
          "step": 2,
          "action": "Click on style kit selector or open style options",
          "expected": "Free section displays 4 style kits: Minimal Clean, High Contrast Punch, Marker Highlight, Sticky Note"
        },
        {
          "step": 3,
          "action": "Verify premium section shows 4 locked/unavailable kits",
          "expected": "Premium section displays: Corporate Pro, Gradient Modern, Dark Mode Punch, Soft Pastel with upgrade indicator"
        },
        {
          "step": 4,
          "action": "Select a free style kit (e.g., Minimal Clean)",
          "expected": "Kit is selected, preview updates, no error or upgrade prompt"
        },
        {
          "step": 5,
          "action": "Complete carousel generation with free style kit",
          "expected": "Carousel generates successfully using selected free style kit"
        }
      ],
      "acceptance_criteria": [
        "All 4 free kits are selectable without restriction",
        "Premium kits show visual indicator (lock icon, badge, or disabled state)",
        "No upgrade prompt when selecting free kits",
        "Generated carousel applies free kit styling correctly",
        "Frontend filtering matches backend isPremium: false flag"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/create/page.tsx",
        "apps/nextjs/src/hooks/use-subscription.ts",
        "packages/db/prisma/seed.ts"
      ],
      "tags": [
        "style_kits",
        "feature_gating",
        "free_tier",
        "core"
      ],
      "notes": "Seed data: 4 free kits have isPremium: false (seed.ts lines 34, 54, 75, 95). Frontend filters by isPremium flag. No backend enforcement observed - frontend responsibility."
    },
    {
      "id": "TC-STYLEKIT-005",
      "name": "Creator tier users can access all 8 style kits (free + premium)",
      "module": "style_kits",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that CREATOR tier subscription grants access to all 8 style kits including premium options",
      "business_context": "Creator tier is a paid subscription. Users paying for this tier should have access to all style options to differentiate their carousels.",
      "preconditions": [
        "User is logged in with CREATOR subscription tier",
        "User is on /en/create or /en/editor/:id page"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to create page or editor",
          "expected": "Page loads with full style kit selector"
        },
        {
          "step": 2,
          "action": "Open style kit selector",
          "expected": "Both Free and Premium sections are available without lock icons"
        },
        {
          "step": 3,
          "action": "Select a premium style kit (e.g., Corporate Pro)",
          "expected": "Kit is selected without error or upgrade prompt"
        },
        {
          "step": 4,
          "action": "Generate/edit carousel with premium kit",
          "expected": "Premium kit styles (colors, fonts, spacing) are applied correctly"
        },
        {
          "step": 5,
          "action": "Switch between free and premium kits",
          "expected": "All 8 kits are selectable, preview updates instantly"
        }
      ],
      "acceptance_criteria": [
        "All 8 style kits (4 free + 4 premium) are unlocked",
        "No visual indicators of locked/unavailable kits",
        "Premium kits apply styles correctly (gradient backgrounds, custom fonts)",
        "useSubscription hook returns canUse('styleKits') = true for all 8 kits",
        "No upgrade prompts when using premium kits"
      ],
      "related_files": [
        "apps/nextjs/src/hooks/use-subscription.ts",
        "apps/nextjs/src/components/editor/StyleKitSelector.tsx",
        "packages/db/prisma/seed.ts"
      ],
      "tags": [
        "style_kits",
        "feature_gating",
        "creator_tier",
        "premium"
      ],
      "notes": "Premium kits have isPremium: true (seed.ts lines 115, 135, 154, 175). Creator tier should have full access per tier limits documented in use-subscription.ts."
    },
    {
      "id": "TC-STYLEKIT-006",
      "name": "Pro tier users can access all 8 style kits (same as Creator)",
      "module": "style_kits",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that PRO tier subscription grants access to all 8 style kits including premium options",
      "business_context": "Pro tier is the highest paid tier. Users should have unrestricted access to all styling options.",
      "preconditions": [
        "User is logged in with PRO subscription tier",
        "User is on /en/create or /en/editor/:id page"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to create page or editor",
          "expected": "Page loads with full style kit selector"
        },
        {
          "step": 2,
          "action": "Open style kit selector",
          "expected": "All 8 style kits visible with no lock indicators"
        },
        {
          "step": 3,
          "action": "Select each premium kit one by one (Corporate Pro, Gradient Modern, Dark Mode Punch, Soft Pastel)",
          "expected": "Each premium kit is selectable and preview updates correctly"
        },
        {
          "step": 4,
          "action": "Create carousel with Gradient Modern (premium kit with gradient background)",
          "expected": "Carousel applies gradient background correctly: linear-gradient(135deg, #667eea 0%, #764ba2 100%)"
        }
      ],
      "acceptance_criteria": [
        "All 8 style kits are unlocked and selectable",
        "Premium kits render advanced features (gradients, custom fonts)",
        "No restrictions or upgrade prompts",
        "PRO tier has same style kit access as CREATOR tier",
        "Complex gradients render correctly in editor and export"
      ],
      "related_files": [
        "apps/nextjs/src/hooks/use-subscription.ts",
        "packages/db/prisma/seed.ts"
      ],
      "tags": [
        "style_kits",
        "feature_gating",
        "pro_tier",
        "premium"
      ],
      "notes": "Pro tier is highest subscription level. Gradient Modern kit has gradient background (seed.ts lines 127-129). Frontend CSS must support linear-gradient rendering."
    },
    {
      "id": "TC-STYLEKIT-007",
      "name": "Premium style kit has unique styling (gradient background)",
      "module": "style_kits",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "medium",
      "description": "Validates that premium style kits apply advanced visual features like gradient backgrounds",
      "business_context": "Premium kits must offer clear visual differentiation to justify paid subscriptions. Gradients are a key premium feature.",
      "preconditions": [
        "User has CREATOR or PRO tier",
        "User is in editor with a project using Gradient Modern style kit"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Select Gradient Modern kit in StyleKitSelector",
          "expected": "Preview shows gradient background: purple-to-purple gradient (135deg, #667eea to #764ba2)"
        },
        {
          "step": 2,
          "action": "Apply kit to canvas in editor",
          "expected": "Canvas background renders gradient instead of solid color"
        },
        {
          "step": 3,
          "action": "Check text contrast against gradient",
          "expected": "Foreground text is white (#FFFFFF) for readability against dark gradient"
        },
        {
          "step": 4,
          "action": "Export carousel as PDF",
          "expected": "Exported PDF preserves gradient background (not solid color fallback)"
        }
      ],
      "acceptance_criteria": [
        "Gradient renders in editor canvas (EditorCanvas uses CSS or canvas gradient)",
        "Gradient background preserved in exports (render-slide.ts handles gradients)",
        "Text remains readable over gradient (white foreground)",
        "Gradient matches seed data: linear-gradient(135deg, #667eea 0%, #764ba2 100%)",
        "No rendering errors or fallback to solid color"
      ],
      "related_files": [
        "packages/db/prisma/seed.ts",
        "apps/nextjs/src/components/editor/EditorCanvas.tsx",
        "apps/nextjs/src/lib/render-slide.ts"
      ],
      "tags": [
        "style_kits",
        "premium",
        "rendering",
        "gradient"
      ],
      "notes": "Gradient Modern seed data (seed.ts lines 118-136). CSS linear-gradient format: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'. Canvas rendering may need special handling."
    },
    {
      "id": "TC-STYLEKIT-008",
      "name": "Style kit applies typography correctly (headline + body fonts)",
      "module": "style_kits",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that style kit typography settings apply correct fonts and weights to headline and body text",
      "business_context": "Typography is core to visual identity. Headline and body fonts must render distinctly and match selected style kit.",
      "preconditions": [
        "User is in editor with project using High Contrast Punch style kit",
        "Slide has both headline and body text layers"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Select High Contrast Punch kit (headline_font: Poppins 800, body_font: Inter 600)",
          "expected": "Kit is applied, editor canvas updates fonts"
        },
        {
          "step": 2,
          "action": "Inspect headline text layer in canvas",
          "expected": "Font-family is Poppins, font-weight is 800 (extra bold)"
        },
        {
          "step": 3,
          "action": "Inspect body text layer in canvas",
          "expected": "Font-family is Inter, font-weight is 600 (semi-bold)"
        },
        {
          "step": 4,
          "action": "Switch to different kit (Minimal Clean: Inter 700 headline, Inter 400 body)",
          "expected": "Fonts update: headline becomes Inter 700, body becomes Inter 400"
        },
        {
          "step": 5,
          "action": "Export carousel and check PDF fonts",
          "expected": "Exported PDF uses correct fonts (Poppins headline, Inter body)"
        }
      ],
      "acceptance_criteria": [
        "Headline layers use headline_font and headline_weight from styleKit.typography",
        "Body layers use body_font and body_weight from styleKit.typography",
        "Font changes apply immediately when switching kits",
        "Export preserves font selection (not fallback to system fonts)",
        "Google Fonts load correctly (Inter, Poppins, Lora, Source Sans, Roboto Mono)",
        "Font weights render correctly: 400 (regular), 600 (semi-bold), 700 (bold), 800 (extra-bold)"
      ],
      "related_files": [
        "packages/db/prisma/seed.ts",
        "apps/nextjs/src/components/editor/EditorCanvas.tsx",
        "apps/nextjs/src/lib/render-slide.ts"
      ],
      "tags": [
        "style_kits",
        "typography",
        "fonts",
        "rendering"
      ],
      "notes": "High Contrast Punch seed data (seed.ts lines 37-55). Typography object has 4 fields: headline_font, headline_weight, body_font, body_weight. Fonts must be loaded before rendering."
    },
    {
      "id": "TC-STYLEKIT-009",
      "name": "Style kit applies spacing rules (line height)",
      "module": "style_kits",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that style kit spacingRules.line_height applies correctly to text rendering",
      "business_context": "Line height affects text density and readability. Different kits optimize for different use cases (tight vs roomy).",
      "preconditions": [
        "User is in editor with project using Sticky Note style kit",
        "Slide has multi-line body text"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Select Sticky Note kit (line_height: 1.7, padding: roomy)",
          "expected": "Kit applies, text layers update with increased line spacing"
        },
        {
          "step": 2,
          "action": "Measure line height on body text (e.g., font-size 24px)",
          "expected": "Line height calculates as 24px * 1.7 = 40.8px between lines"
        },
        {
          "step": 3,
          "action": "Switch to High Contrast Punch kit (line_height: 1.3, padding: tight)",
          "expected": "Line spacing decreases, text becomes more compact"
        },
        {
          "step": 4,
          "action": "Measure new line height (font-size 24px)",
          "expected": "Line height calculates as 24px * 1.3 = 31.2px between lines"
        },
        {
          "step": 5,
          "action": "Verify line height applies in exported PDF",
          "expected": "PDF preserves line height spacing (not reset to default 1.2)"
        }
      ],
      "acceptance_criteria": [
        "spacingRules.line_height multiplier applies to all text layers",
        "Three line height options exist: tight (1.3), normal (1.5), roomy (1.7)",
        "Line height calculated as: fontSize * line_height",
        "Spacing updates immediately when switching kits",
        "Export rendering applies line height correctly (text-measure.ts uses lineHeight)",
        "Tighter spacing allows more content, roomier spacing improves readability"
      ],
      "related_files": [
        "packages/db/prisma/seed.ts",
        "apps/nextjs/src/lib/text-measure.ts",
        "apps/nextjs/src/lib/render-slide.ts"
      ],
      "tags": [
        "style_kits",
        "spacing",
        "line_height",
        "rendering"
      ],
      "notes": "Sticky Note: line_height 1.7 (seed.ts line 93). High Contrast Punch: line_height 1.3 (line 52). text-measure.ts applies lineHeight in line breaking (lines 40-70)."
    },
    {
      "id": "TC-STYLEKIT-010",
      "name": "Database contains exactly 8 seeded style kits",
      "module": "style_kits",
      "user_journey": null,
      "category": "database",
      "type": "happy_path",
      "priority": "critical",
      "description": "Validates that database seed script successfully inserts all 8 style kits with correct data",
      "business_context": "Style kits are foundational data. Missing or incorrect seed data breaks the entire styling system.",
      "preconditions": [
        "Database has been reset and seeded via: cd packages/db && bun db:push && bun run seed"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Query StyleKit table: SELECT COUNT(*) FROM StyleKit",
          "expected": "Returns exactly 8 rows"
        },
        {
          "step": 2,
          "action": "Query free kits: SELECT * FROM StyleKit WHERE isPremium = false",
          "expected": "Returns 4 kits: minimal_clean, high_contrast_punch, marker_highlight, sticky_note"
        },
        {
          "step": 3,
          "action": "Query premium kits: SELECT * FROM StyleKit WHERE isPremium = true",
          "expected": "Returns 4 kits: corporate_pro, gradient_modern, dark_mode_punch, soft_pastel"
        },
        {
          "step": 4,
          "action": "Verify each kit has all required fields populated",
          "expected": "All kits have: id (string), name (string), typography (JSON), colors (JSON), spacingRules (JSON), isPremium (boolean)"
        },
        {
          "step": 5,
          "action": "Check for duplicate IDs: SELECT id, COUNT(*) FROM StyleKit GROUP BY id HAVING COUNT(*) > 1",
          "expected": "Returns 0 rows (no duplicates)"
        }
      ],
      "acceptance_criteria": [
        "Seed script inserts exactly 8 style kits",
        "No duplicate IDs exist",
        "Each kit has valid JSON in typography, colors, spacingRules fields",
        "isPremium flag correctly set (4 false, 4 true)",
        "Seed script is idempotent (running twice doesn't create duplicates)",
        "Seed log confirms: '\u2705 Successfully seeded 8 StyleKits' (seed.ts line 432)"
      ],
      "related_files": [
        "packages/db/prisma/seed.ts",
        "packages/db/prisma/schema.prisma"
      ],
      "tags": [
        "style_kits",
        "database",
        "seed",
        "data_integrity"
      ],
      "notes": "Seed script checks for existing kits before inserting (seed.ts lines 421-438). Idempotent design prevents duplicates. JSON fields validated by Prisma schema."
    },
    {
      "id": "TC-BILLING-001",
      "name": "Stripe Checkout Session Creation - Creator Tier",
      "module": "billing",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "critical",
      "description": "Verify authenticated user can create a Stripe checkout session for Creator tier subscription",
      "business_context": "Users must be able to upgrade from Free to Creator tier ($15/mo) through Stripe hosted checkout. This is the primary monetization flow for the platform.",
      "preconditions": [
        "User is authenticated via Clerk",
        "User's profile exists in database with FREE tier",
        "NEXT_PUBLIC_STRIPE_CREATOR_PRICE_ID environment variable is set",
        "Stripe API keys are configured"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST request to /api/stripe/checkout with valid Creator priceId in body",
          "expected": "Returns 201 status with checkout session URL and sessionId"
        },
        {
          "step": 2,
          "action": "Verify the session URL is a valid Stripe checkout URL (stripe.com/checkout/)",
          "expected": "URL points to Stripe's hosted checkout page"
        },
        {
          "step": 3,
          "action": "Check that session includes successUrl and cancelUrl parameters",
          "expected": "Success URL redirects to /en/dashboard?session_id={CHECKOUT_SESSION_ID}, cancel URL to /en/pricing"
        },
        {
          "step": 4,
          "action": "Verify session metadata includes userId (Clerk user ID)",
          "expected": "Session metadata contains userId for webhook processing"
        }
      ],
      "acceptance_criteria": [
        "API returns 201 status code",
        "Response includes valid Stripe checkout URL",
        "Response includes sessionId for tracking",
        "Session mode is set to 'subscription'",
        "Session includes userId in metadata and client_reference_id",
        "Success and cancel URLs are properly configured"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/stripe/checkout/route.ts"
      ],
      "tags": [
        "stripe",
        "checkout",
        "subscription",
        "monetization",
        "critical-path"
      ],
      "notes": "This is the entry point for all subscription upgrades. Failures here block revenue generation."
    },
    {
      "id": "TC-BILLING-002",
      "name": "Stripe Checkout Validation - Invalid Price ID",
      "module": "billing",
      "user_journey": null,
      "category": "api",
      "type": "error_path",
      "priority": "high",
      "description": "Verify checkout API rejects requests with invalid or malicious price IDs",
      "business_context": "Prevents users from attempting to subscribe to invalid plans or manipulate pricing by providing arbitrary Stripe price IDs.",
      "preconditions": [
        "User is authenticated",
        "Valid Stripe price IDs are configured in environment"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST request with invalid priceId (e.g., 'price_invalid123')",
          "expected": "Returns 400 Bad Request with validation error"
        },
        {
          "step": 2,
          "action": "Send POST request with empty priceId string",
          "expected": "Returns 400 Bad Request with 'Price ID is required' message"
        },
        {
          "step": 3,
          "action": "Send POST request with priceId from different Stripe account",
          "expected": "Returns 400 Bad Request or 500 error from Stripe API"
        }
      ],
      "acceptance_criteria": [
        "Invalid priceId returns 400 status code",
        "Error message clearly states 'Invalid price ID provided'",
        "Only CREATOR and PRO price IDs from env are accepted",
        "No Stripe session is created for invalid requests",
        "Request fails before reaching Stripe API"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/stripe/checkout/route.ts"
      ],
      "tags": [
        "stripe",
        "validation",
        "security",
        "error-handling"
      ],
      "notes": "Lines 31-38 in route.ts validate priceId against env vars. This prevents price manipulation attacks."
    },
    {
      "id": "TC-BILLING-003",
      "name": "Stripe Webhook - Checkout Completed Event",
      "module": "billing",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "critical",
      "description": "Verify Stripe webhook successfully processes checkout.session.completed event and updates user's subscription tier",
      "business_context": "When user completes payment on Stripe checkout, webhook must immediately update their tier in database so they gain access to paid features. This is critical for user experience and feature gating.",
      "preconditions": [
        "User has completed Stripe checkout session",
        "Webhook endpoint is configured in Stripe dashboard",
        "STRIPE_WEBHOOK_SECRET is set",
        "User profile exists with FREE tier"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Simulate Stripe sending checkout.session.completed webhook with CREATOR subscription",
          "expected": "Webhook handler receives event and validates signature"
        },
        {
          "step": 2,
          "action": "Handler retrieves subscription from Stripe API using session.subscription ID",
          "expected": "Subscription object includes userId in metadata and CREATOR priceId"
        },
        {
          "step": 3,
          "action": "Handler queries Profile table by clerkUserId from metadata",
          "expected": "Profile record is found"
        },
        {
          "step": 4,
          "action": "Handler updates Profile.subscriptionTier to CREATOR based on priceId",
          "expected": "Database update succeeds, tier changes from FREE to CREATOR"
        },
        {
          "step": 5,
          "action": "Handler returns 200 status with {received: true}",
          "expected": "Stripe receives success response and marks webhook as delivered"
        }
      ],
      "acceptance_criteria": [
        "Webhook returns 200 status code",
        "Profile.subscriptionTier is updated to CREATOR in database",
        "No errors logged during processing",
        "Webhook processing completes within 5 seconds (Stripe timeout)",
        "User immediately gains access to Creator tier features"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/webhooks/stripe/route.ts",
        "packages/stripe/src/webhooks.ts",
        "packages/stripe/src/plans.ts"
      ],
      "tags": [
        "stripe",
        "webhook",
        "subscription",
        "tier-update",
        "critical-path"
      ],
      "notes": "Lines 10-48 in webhooks.ts handle checkout completion. This is the ONLY way subscriptionTier gets updated to paid tiers."
    },
    {
      "id": "TC-BILLING-004",
      "name": "Stripe Webhook - Subscription Cancelled Event",
      "module": "billing",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "critical",
      "description": "Verify webhook downgrades user to FREE tier when subscription is cancelled",
      "business_context": "When user cancels paid subscription (or payment fails repeatedly), they must be downgraded to FREE tier to prevent access to paid features without payment. Critical for revenue protection.",
      "preconditions": [
        "User has active CREATOR or PRO subscription",
        "Profile.subscriptionTier is set to CREATOR or PRO",
        "User cancels subscription through Stripe customer portal or Stripe admin"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Stripe sends customer.subscription.deleted webhook event",
          "expected": "Webhook handler receives event with subscription metadata including userId"
        },
        {
          "step": 2,
          "action": "Handler queries Profile by clerkUserId from subscription metadata",
          "expected": "Profile found with current tier CREATOR or PRO"
        },
        {
          "step": 3,
          "action": "Handler updates Profile.subscriptionTier to FREE",
          "expected": "Tier reverted to FREE in database"
        },
        {
          "step": 4,
          "action": "User attempts to access Creator-only feature (e.g., create 4th carousel)",
          "expected": "Feature gating blocks access, shows upgrade prompt"
        }
      ],
      "acceptance_criteria": [
        "Profile.subscriptionTier set to FREE after webhook",
        "User loses access to paid features immediately",
        "Carousel count limit enforced at 3 (FREE tier)",
        "Watermark re-applied to new exports",
        "No data loss (existing carousels remain accessible)"
      ],
      "related_files": [
        "packages/stripe/src/webhooks.ts",
        "apps/nextjs/src/hooks/use-subscription.ts"
      ],
      "tags": [
        "stripe",
        "webhook",
        "cancellation",
        "downgrade",
        "feature-gating"
      ],
      "notes": "Lines 85-108 in webhooks.ts handle cancellation. Existing projects/brand kits are NOT deleted on downgrade."
    },
    {
      "id": "TC-BILLING-005",
      "name": "Stripe Webhook - Subscription Plan Change",
      "module": "billing",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "high",
      "description": "Verify webhook handles plan changes between CREATOR and PRO tiers",
      "business_context": "Users may upgrade from Creator to Pro or downgrade from Pro to Creator. Tier must update correctly to reflect new feature limits.",
      "preconditions": [
        "User has active CREATOR subscription",
        "User changes plan to PRO through Stripe customer portal"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Stripe sends customer.subscription.updated webhook with new PRO priceId",
          "expected": "Webhook handler receives event with updated subscription"
        },
        {
          "step": 2,
          "action": "Handler extracts new priceId from subscription.items.data[0].price.id",
          "expected": "PriceId matches NEXT_PUBLIC_STRIPE_PRO_PRICE_ID"
        },
        {
          "step": 3,
          "action": "Handler calls getSubscriptionPlan(priceId) to map priceId to tier",
          "expected": "Returns SubscriptionTier.PRO"
        },
        {
          "step": 4,
          "action": "Profile.subscriptionTier updated from CREATOR to PRO",
          "expected": "Database update succeeds"
        },
        {
          "step": 5,
          "action": "User accesses brand kit settings and sees limit increased from 1 to 5",
          "expected": "UI reflects new PRO tier limits"
        }
      ],
      "acceptance_criteria": [
        "Tier updates correctly on plan change (CREATOR \u2192 PRO or PRO \u2192 CREATOR)",
        "Feature limits update immediately (carousel limit, slide limit, brand kit limit)",
        "No downtime or feature access issues during transition",
        "Both upgrade and downgrade scenarios work correctly"
      ],
      "related_files": [
        "packages/stripe/src/webhooks.ts",
        "packages/stripe/src/plans.ts"
      ],
      "tags": [
        "stripe",
        "webhook",
        "plan-change",
        "tier-update"
      ],
      "notes": "Lines 110-139 in webhooks.ts handle subscription updates. Uses same logic as checkout completion."
    },
    {
      "id": "TC-BILLING-006",
      "name": "Billing Page - Current Plan Display",
      "module": "billing",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Verify billing page correctly displays user's current subscription tier and plan details",
      "business_context": "Users need clear visibility into their current plan, price, and next billing date to manage their subscription and understand their feature access.",
      "preconditions": [
        "User is authenticated",
        "User has profile with subscriptionTier set (FREE, CREATOR, or PRO)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to /en/settings/billing page",
          "expected": "Page loads without errors, shows loading state initially"
        },
        {
          "step": 2,
          "action": "Page fetches profile from GET /api/profile",
          "expected": "API returns profile with subscriptionTier field"
        },
        {
          "step": 3,
          "action": "Check 'Current Plan' card displays correct tier name and price",
          "expected": "Shows 'Creator' and '$15/month' for CREATOR tier users"
        },
        {
          "step": 4,
          "action": "For paid tiers, verify next billing date is displayed",
          "expected": "Next billing date shows approximately 30 days from current date"
        },
        {
          "step": 5,
          "action": "Verify current plan card in available plans section has blue border and 'Current Plan' badge",
          "expected": "Visual indicator clearly shows which plan is active"
        }
      ],
      "acceptance_criteria": [
        "Current plan name, tier, and price display correctly",
        "Next billing date shown for CREATOR/PRO, hidden for FREE",
        "Current plan has visual distinction (blue border, badge)",
        "data-testid='current_plan' attribute present for testing",
        "Loading state shown while fetching profile"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/settings/billing/page.tsx"
      ],
      "tags": [
        "billing",
        "ui",
        "subscription-display"
      ],
      "notes": "Lines 136-165 in page.tsx render current plan card. Next billing date calculation is simplified (current + 30 days)."
    },
    {
      "id": "TC-BILLING-007",
      "name": "Billing Page - Upgrade Button Flow",
      "module": "billing",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "critical",
      "description": "Verify user can click upgrade button and be redirected to Stripe checkout",
      "business_context": "Primary conversion flow for free users to become paying customers. Button must work reliably to generate revenue.",
      "preconditions": [
        "User is on FREE tier",
        "Viewing /en/settings/billing page"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Identify Creator plan card, click 'Upgrade to Creator' button",
          "expected": "Button shows loading state (spinner and 'Processing...' text)"
        },
        {
          "step": 2,
          "action": "Frontend sends POST to /api/stripe/checkout with Creator priceId",
          "expected": "API creates Stripe checkout session and returns URL"
        },
        {
          "step": 3,
          "action": "Frontend redirects to Stripe checkout URL via window.location.href",
          "expected": "User is taken to Stripe's hosted checkout page"
        },
        {
          "step": 4,
          "action": "User completes payment on Stripe",
          "expected": "Redirected back to /en/settings/billing?success=true"
        },
        {
          "step": 5,
          "action": "Page reloads and fetches updated profile",
          "expected": "Current plan now shows CREATOR tier"
        }
      ],
      "acceptance_criteria": [
        "Upgrade button is enabled for plans higher than current tier",
        "Button shows loading state during checkout session creation",
        "Successful redirect to Stripe checkout page",
        "Success parameter in URL after successful payment",
        "All other buttons disabled during checkout session creation",
        "Error alert shown if checkout creation fails"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/settings/billing/page.tsx"
      ],
      "tags": [
        "billing",
        "ui",
        "checkout",
        "conversion",
        "critical-path"
      ],
      "notes": "handleUpgrade function (lines 84-113) creates checkout session and redirects. Uses data-testid='upgrade_button'."
    },
    {
      "id": "TC-BILLING-008",
      "name": "Billing Page - Plan Features Display",
      "module": "billing",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "medium",
      "description": "Verify each plan card displays correct feature list with checkmarks",
      "business_context": "Users compare plans based on features. Clear feature lists drive conversion by showing value of paid tiers.",
      "preconditions": [
        "User viewing /en/settings/billing page"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Check FREE plan card features list",
          "expected": "Shows: 3 carousels/month, 8 slides max, Watermark included, 3 style kits"
        },
        {
          "step": 2,
          "action": "Check CREATOR plan card features list",
          "expected": "Shows: 30 carousels/month, 15 slides max, No watermark, All 8 style kits, 1 brand kit"
        },
        {
          "step": 3,
          "action": "Check PRO plan card features list",
          "expected": "Shows: Unlimited carousels, 20 slides max, No watermark, All 8 style kits, 5 brand kits, Custom fonts, Priority exports"
        },
        {
          "step": 4,
          "action": "Verify each feature has green checkmark icon",
          "expected": "Check icon renders for all features in all plans"
        }
      ],
      "acceptance_criteria": [
        "All features match PRICING_TIERS constant (lines 17-57)",
        "Features are specific and measurable (not vague)",
        "Each feature has Check icon from lucide-react",
        "Feature text is readable and properly formatted",
        "Plan cards use consistent layout and spacing"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/settings/billing/page.tsx"
      ],
      "tags": [
        "billing",
        "ui",
        "pricing",
        "conversion"
      ],
      "notes": "PRICING_TIERS array defines all plan features. Must match actual tier limits in use-subscription.ts."
    },
    {
      "id": "TC-BILLING-009",
      "name": "useSubscription Hook - Feature Gating Logic",
      "module": "billing",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "critical",
      "description": "Verify useSubscription hook correctly gates features based on user's subscription tier",
      "business_context": "Central feature gating mechanism ensures users only access features they've paid for. Critical for monetization and preventing unauthorized feature access.",
      "preconditions": [
        "User is authenticated with known tier (FREE, CREATOR, or PRO)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Component calls useSubscription hook",
          "expected": "Hook fetches profile from /api/profile and extracts subscriptionTier"
        },
        {
          "step": 2,
          "action": "Component calls canUse('brand_kits') for FREE tier user",
          "expected": "Returns false (FREE tier limit is 0 brand kits)"
        },
        {
          "step": 3,
          "action": "Component calls canUse('brand_kits') for CREATOR tier user",
          "expected": "Returns true (CREATOR tier has 1 brand kit allowed)"
        },
        {
          "step": 4,
          "action": "Component calls getLimit('carousels') for PRO tier user",
          "expected": "Returns -1 (unlimited carousels for PRO)"
        },
        {
          "step": 5,
          "action": "Component calls requiresUpgrade('custom_fonts') for CREATOR user",
          "expected": "Returns true (custom fonts require PRO tier)"
        }
      ],
      "acceptance_criteria": [
        "canUse() correctly returns boolean based on tier limits",
        "getLimit() returns correct numeric limits (-1 for unlimited, 0 for disabled, >0 for limit)",
        "requiresUpgrade() returns true if feature not available in current tier",
        "Hook fetches tier from /api/profile on mount",
        "Loading state is true during initial fetch",
        "Error state set if API call fails (defaults to FREE tier)"
      ],
      "related_files": [
        "apps/nextjs/src/hooks/use-subscription.ts"
      ],
      "tags": [
        "feature-gating",
        "subscription",
        "authorization",
        "hook",
        "critical-path"
      ],
      "notes": "TIER_LIMITS constant (lines 34-62) defines all feature limits. Used across entire app for feature gating."
    },
    {
      "id": "TC-BILLING-010",
      "name": "useSubscription Hook - Tier Limits Validation",
      "module": "billing",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "high",
      "description": "Verify all tier limits in useSubscription match business requirements and pricing page display",
      "business_context": "Tier limits must be consistent across hook, pricing page, and actual enforcement. Discrepancies confuse users and cause support issues.",
      "preconditions": [
        "useSubscription hook TIER_LIMITS constant is defined",
        "Billing page PRICING_TIERS array is defined"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Compare FREE tier carousel limit (TIER_LIMITS.FREE.carousels)",
          "expected": "Value is 3, matches billing page '3 carousels/month'"
        },
        {
          "step": 2,
          "action": "Compare CREATOR tier slide limit (TIER_LIMITS.CREATOR.slides)",
          "expected": "Value is 15, matches billing page '15 slides max'"
        },
        {
          "step": 3,
          "action": "Compare PRO tier brand kit limit (TIER_LIMITS.PRO.brand_kits)",
          "expected": "Value is 5, matches billing page '5 brand kits'"
        },
        {
          "step": 4,
          "action": "Verify watermark flag (TIER_LIMITS.FREE.watermark)",
          "expected": "Value is true for FREE, false for CREATOR/PRO"
        },
        {
          "step": 5,
          "action": "Verify PRO exclusive features (custom_fonts, priority_exports)",
          "expected": "Only PRO tier has these set to true"
        }
      ],
      "acceptance_criteria": [
        "All carousel limits match: FREE=3, CREATOR=30, PRO=-1 (unlimited)",
        "All slide limits match: FREE=8, CREATOR=15, PRO=20",
        "All brand kit limits match: FREE=0, CREATOR=1, PRO=5",
        "Style kit limits: FREE=3, CREATOR/PRO=8",
        "Watermark: only FREE tier has watermark=true",
        "Custom fonts and priority exports only available in PRO"
      ],
      "related_files": [
        "apps/nextjs/src/hooks/use-subscription.ts",
        "apps/nextjs/src/app/[lang]/(dashboard)/settings/billing/page.tsx"
      ],
      "tags": [
        "feature-gating",
        "validation",
        "consistency"
      ],
      "notes": "This is a data validation test. Discrepancies between TIER_LIMITS and PRICING_TIERS cause user confusion."
    },
    {
      "id": "TC-BILLING-011",
      "name": "Webhook Signature Validation",
      "module": "billing",
      "user_journey": null,
      "category": "security",
      "type": "error_path",
      "priority": "critical",
      "description": "Verify webhook endpoint rejects requests with invalid or missing Stripe signature",
      "business_context": "Webhook signature validation prevents malicious actors from sending fake subscription events to upgrade accounts without payment. Critical security control.",
      "preconditions": [
        "STRIPE_WEBHOOK_SECRET is configured",
        "Webhook endpoint is publicly accessible"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST request to /api/webhooks/stripe without Stripe-Signature header",
          "expected": "Request rejected with 400 error"
        },
        {
          "step": 2,
          "action": "Send POST request with invalid signature (random string)",
          "expected": "stripe.webhooks.constructEvent throws error, returns 400"
        },
        {
          "step": 3,
          "action": "Send request with valid payload but signature for different secret",
          "expected": "Signature validation fails, returns 400"
        },
        {
          "step": 4,
          "action": "Send request with correctly signed payload using STRIPE_WEBHOOK_SECRET",
          "expected": "Validation passes, event processed, returns 200"
        }
      ],
      "acceptance_criteria": [
        "Requests without Stripe-Signature header return 400",
        "Invalid signatures return 400 with error message",
        "No database changes occur for invalid signatures",
        "Error logged with message 'Error when handling Stripe Event'",
        "Valid signatures allow event processing"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/webhooks/stripe/route.ts"
      ],
      "tags": [
        "security",
        "webhook",
        "stripe",
        "authentication",
        "critical-path"
      ],
      "notes": "Lines 11-15 in route.ts validate signature using stripe.webhooks.constructEvent. This is the ONLY security check."
    },
    {
      "id": "TC-BILLING-012",
      "name": "Profile API - Subscription Tier Retrieval",
      "module": "billing",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "high",
      "description": "Verify GET /api/profile returns user's current subscription tier",
      "business_context": "Profile API is the source of truth for user's subscription tier. Used by billing page, useSubscription hook, and feature gating logic throughout the app.",
      "preconditions": [
        "User is authenticated",
        "User's Profile exists in database"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send GET request to /api/profile with valid auth token",
          "expected": "Returns 200 with profile object"
        },
        {
          "step": 2,
          "action": "Check response includes subscriptionTier field",
          "expected": "subscriptionTier is one of: FREE, CREATOR, or PRO"
        },
        {
          "step": 3,
          "action": "Verify other profile fields present (id, clerkUserId, email, name, avatarUrl)",
          "expected": "All expected fields returned in response"
        },
        {
          "step": 4,
          "action": "Verify timestamps (createdAt, updatedAt) are in ISO 8601 format",
          "expected": "Dates are properly formatted strings"
        }
      ],
      "acceptance_criteria": [
        "API returns 200 status code for authenticated users",
        "Response includes subscriptionTier field",
        "subscriptionTier value matches database Profile table",
        "Response is JSON with correct content-type header",
        "No sensitive data (Stripe IDs, payment info) exposed"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/profile/route.ts"
      ],
      "tags": [
        "api",
        "profile",
        "subscription",
        "data-access"
      ],
      "notes": "Lines 16-20 query Profile by clerkUserId. This is called frequently by useSubscription hook."
    },
    {
      "id": "TC-BILLING-013",
      "name": "Webhook Error Handling - Missing userId",
      "module": "billing",
      "user_journey": null,
      "category": "integration",
      "type": "error_path",
      "priority": "high",
      "description": "Verify webhook handles missing userId in subscription metadata gracefully",
      "business_context": "If checkout session was created without userId metadata (edge case), webhook must fail gracefully and log error for manual investigation. Prevents silent failures.",
      "preconditions": [
        "Stripe sends webhook event",
        "Subscription metadata does NOT include userId field"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Webhook receives checkout.session.completed event without userId in metadata",
          "expected": "Handler throws Error('Missing user id') at line 20"
        },
        {
          "step": 2,
          "action": "Error bubbles up to route handler catch block",
          "expected": "Error logged to console with message prefix '\u274c Error when handling Stripe Event'"
        },
        {
          "step": 3,
          "action": "Handler returns 400 status to Stripe",
          "expected": "Stripe marks webhook delivery as failed, will retry"
        },
        {
          "step": 4,
          "action": "No database changes occur",
          "expected": "Profile.subscriptionTier remains unchanged"
        }
      ],
      "acceptance_criteria": [
        "Missing userId throws error with clear message",
        "Error logged to console for debugging",
        "Returns 400 status to trigger Stripe retry",
        "No partial database updates occur",
        "Error includes enough context for manual investigation"
      ],
      "related_files": [
        "packages/stripe/src/webhooks.ts",
        "apps/nextjs/src/app/api/webhooks/stripe/route.ts"
      ],
      "tags": [
        "webhook",
        "error-handling",
        "edge-case",
        "data-integrity"
      ],
      "notes": "Lines 19-21 in webhooks.ts throw error if userId missing. This prevents orphaned subscriptions."
    },
    {
      "id": "TC-BILLING-014",
      "name": "Billing Page - Error Handling on Profile Fetch Failure",
      "module": "billing",
      "user_journey": null,
      "category": "frontend",
      "type": "error_path",
      "priority": "medium",
      "description": "Verify billing page handles profile fetch failures gracefully",
      "business_context": "If profile API fails, billing page should still render with fallback state rather than showing blank page or crash. Provides better UX during outages.",
      "preconditions": [
        "User is authenticated",
        "/api/profile endpoint returns error (500, 503, or network timeout)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to /en/settings/billing while profile API is down",
          "expected": "Page attempts to load profile, fetch fails"
        },
        {
          "step": 2,
          "action": "Error caught in loadCurrentPlan catch block (line 77-78)",
          "expected": "Error logged to console, loading state set to false"
        },
        {
          "step": 3,
          "action": "Page renders with currentTier defaulting to FREE",
          "expected": "Page displays but shows FREE plan (safest fallback)"
        },
        {
          "step": 4,
          "action": "Upgrade buttons remain functional",
          "expected": "User can still attempt checkout (will fail if truly unauthenticated)"
        }
      ],
      "acceptance_criteria": [
        "Page does not crash or show error boundary",
        "Loading state transitions to false after error",
        "Defaults to FREE tier as safest fallback",
        "Error logged to console for debugging",
        "User sees some UI rather than blank page",
        "No infinite loading spinner"
      ],
      "related_files": [
        "apps/nextjs/src/app/[lang]/(dashboard)/settings/billing/page.tsx"
      ],
      "tags": [
        "error-handling",
        "resilience",
        "ux",
        "fallback"
      ],
      "notes": "Lines 77-79 handle fetch errors but don't show user-facing error message. Could be improved with error banner."
    },
    {
      "id": "TC-FEATGATE-001",
      "name": "Free Tier - Carousel Limit Enforcement",
      "module": "feature_gating",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "critical",
      "description": "Verify that FREE tier users are limited to 3 carousels and see upgrade prompt when limit reached",
      "business_context": "FREE tier carousel limit is core monetization strategy. Users must be clearly informed when limit is reached and guided to upgrade.",
      "preconditions": [
        "User is authenticated",
        "User has FREE subscription tier",
        "User has created 3 carousels (at limit)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to /en/create page",
          "expected": "Create page loads, useSubscription hook fetches profile and sets tier to FREE"
        },
        {
          "step": 2,
          "action": "Page fetches project count via GET /api/projects",
          "expected": "projectCount = 3 (at limit)"
        },
        {
          "step": 3,
          "action": "hasReachedCarouselLimit computed: carouselLimit (3) !== -1 && projectCount (3) >= carouselLimit (3)",
          "expected": "hasReachedCarouselLimit = true"
        },
        {
          "step": 4,
          "action": "User enters topic and clicks Generate",
          "expected": "handleGenerate checks limit, sets error: 'You've reached your limit of 3 carousels. Upgrade to create more.'"
        },
        {
          "step": 5,
          "action": "Error banner appears with upgrade message",
          "expected": "Red error banner shows limit message, no API calls made"
        },
        {
          "step": 6,
          "action": "Yellow warning banner with upgrade CTA visible",
          "expected": "Banner shows carousel usage (3/3) with link to /settings/billing"
        }
      ],
      "acceptance_criteria": [
        "FREE tier limit is exactly 3 carousels",
        "Limit check happens before generation API call",
        "Error message clearly states the limit number",
        "Error message includes 'Upgrade' keyword",
        "Warning banner appears before hitting limit (2/3, 3/3)",
        "Generate button does NOT create project when at limit",
        "User can click upgrade link to billing page",
        "No API calls made when limit reached"
      ],
      "related_files": [
        "apps/nextjs/src/hooks/use-subscription.ts",
        "apps/nextjs/src/app/[lang]/(dashboard)/create/page.tsx"
      ],
      "tags": [
        "feature-gating",
        "monetization",
        "free-tier",
        "carousel-limit",
        "critical-path"
      ],
      "notes": "Lines 77-78 in create/page.tsx check carousel limit. TIER_LIMITS.FREE.carousels = 3 (line 36 in use-subscription.ts). Backend doesn't enforce this limit - frontend only."
    },
    {
      "id": "TC-FEATGATE-002",
      "name": "Creator Tier - Carousel Limit Enforcement",
      "module": "feature_gating",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "high",
      "description": "Verify that CREATOR tier users can create up to 30 carousels and see limit warning as they approach",
      "business_context": "CREATOR tier provides 10x capacity vs FREE. Must enforce 30 carousel limit to encourage Pro upgrade for power users.",
      "preconditions": [
        "User is authenticated",
        "User has CREATOR subscription tier",
        "User has created 29 carousels (near limit)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to /en/create page",
          "expected": "useSubscription hook sets tier to CREATOR, carouselLimit = 30"
        },
        {
          "step": 2,
          "action": "projectCount fetched = 29",
          "expected": "hasReachedCarouselLimit = false (29 < 30)"
        },
        {
          "step": 3,
          "action": "User generates a carousel successfully",
          "expected": "Carousel created, projectCount now 30, user at limit"
        },
        {
          "step": 4,
          "action": "User refreshes /create page, projectCount = 30",
          "expected": "hasReachedCarouselLimit = true (30 >= 30)"
        },
        {
          "step": 5,
          "action": "User attempts to generate another carousel",
          "expected": "Error: 'You've reached your limit of 30 carousels. Upgrade to create more.'"
        },
        {
          "step": 6,
          "action": "Upgrade banner shows Pro tier benefits",
          "expected": "Banner highlights unlimited carousels in Pro tier"
        }
      ],
      "acceptance_criteria": [
        "CREATOR tier limit is exactly 30 carousels",
        "Limit enforced after 30th carousel created",
        "Warning banner appears at 28/30, 29/30 usage",
        "Error message suggests upgrading to Pro for unlimited",
        "User can still edit existing carousels when at limit",
        "Dashboard still shows all 30 carousels",
        "Limit check uses fresh project count from API"
      ],
      "related_files": [
        "apps/nextjs/src/hooks/use-subscription.ts",
        "apps/nextjs/src/app/[lang]/(dashboard)/create/page.tsx"
      ],
      "tags": [
        "feature-gating",
        "creator-tier",
        "carousel-limit",
        "upgrade-prompt"
      ],
      "notes": "TIER_LIMITS.CREATOR.carousels = 30 (line 45). This is 10x free tier but still enforces scarcity to drive Pro upgrades."
    },
    {
      "id": "TC-FEATGATE-003",
      "name": "Pro Tier - Unlimited Carousels",
      "module": "feature_gating",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "high",
      "description": "Verify that PRO tier users can create unlimited carousels with no limit warnings or errors",
      "business_context": "PRO tier's key selling point is unlimited carousels. Must work flawlessly for paying customers.",
      "preconditions": [
        "User is authenticated",
        "User has PRO subscription tier",
        "User has created 50+ carousels (exceeds all other tier limits)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to /en/create page",
          "expected": "useSubscription hook sets tier to PRO, carouselLimit = -1"
        },
        {
          "step": 2,
          "action": "projectCount fetched = 50 (exceeds Creator limit)",
          "expected": "hasReachedCarouselLimit = false (carouselLimit === -1 means unlimited)"
        },
        {
          "step": 3,
          "action": "User generates a new carousel",
          "expected": "Carousel created successfully, no limit warnings shown"
        },
        {
          "step": 4,
          "action": "Create page shows no carousel count or warning banners",
          "expected": "Clean UI with no scarcity messaging"
        },
        {
          "step": 5,
          "action": "User can create carousel #51, #52, #100, etc.",
          "expected": "All carousel creations succeed, no backend errors"
        }
      ],
      "acceptance_criteria": [
        "PRO tier carouselLimit = -1 (unlimited sentinel value)",
        "hasReachedCarouselLimit always false for Pro tier",
        "No carousel count warnings shown in UI",
        "No error messages about carousel limits",
        "User can create 100+ carousels without issues",
        "Dashboard still loads quickly with many projects",
        "No upgrade prompts or banners for carousel capacity"
      ],
      "related_files": [
        "apps/nextjs/src/hooks/use-subscription.ts",
        "apps/nextjs/src/app/[lang]/(dashboard)/create/page.tsx"
      ],
      "tags": [
        "feature-gating",
        "pro-tier",
        "unlimited",
        "premium-feature"
      ],
      "notes": "TIER_LIMITS.PRO.carousels = -1 (line 54). Line 118 checks if limit === -1 for unlimited. This is the premium experience - no friction."
    },
    {
      "id": "TC-FEATGATE-004",
      "name": "Free Tier - Slide Count Limit (8 slides)",
      "module": "feature_gating",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "critical",
      "description": "Verify that FREE tier users are limited to 8 slides per carousel and cannot select more",
      "business_context": "Slide count limits are critical differentiation between tiers. FREE tier gets minimal viable product, paid tiers get more flexibility.",
      "preconditions": [
        "User is authenticated",
        "User has FREE subscription tier",
        "User is on /en/create page"
      ],
      "steps": [
        {
          "step": 1,
          "action": "useSubscription.getLimit('slides') is called",
          "expected": "Returns 8 (TIER_LIMITS.FREE.slides)"
        },
        {
          "step": 2,
          "action": "Slide count dropdown renders options 8-20",
          "expected": "Only option 8 is enabled for FREE tier, 9-20 are disabled or not shown"
        },
        {
          "step": 3,
          "action": "User selects slideCount = 8 and generates carousel",
          "expected": "maxSlides check passes (8 <= 8), generation proceeds"
        },
        {
          "step": 4,
          "action": "User tries to manipulate slideCount state to 10 via browser console",
          "expected": "handleGenerate checks slideCount > maxSlides (10 > 8), shows error"
        },
        {
          "step": 5,
          "action": "Error message: 'Your plan allows up to 8 slides. Upgrade for more.'",
          "expected": "Error banner appears, no API call made"
        },
        {
          "step": 6,
          "action": "Upgrade banner shows Creator/Pro tier slide limits",
          "expected": "Banner highlights 15 slides (Creator) or 20 slides (Pro)"
        }
      ],
      "acceptance_criteria": [
        "FREE tier maxSlides is exactly 8",
        "Slide count dropdown doesn't show 9-20 options for FREE tier",
        "Validation happens before API call",
        "Error message states exact limit (8)",
        "Error suggests upgrading for more slides",
        "Backend should also validate slide count (currently doesn't)",
        "Generated carousel has exactly 8 slides (or user's choice up to 8)",
        "Editor loads carousel with all 8 slides intact"
      ],
      "related_files": [
        "apps/nextjs/src/hooks/use-subscription.ts",
        "apps/nextjs/src/app/[lang]/(dashboard)/create/page.tsx"
      ],
      "tags": [
        "feature-gating",
        "free-tier",
        "slide-limit",
        "critical-path"
      ],
      "notes": "Lines 90-91, 106-110 in create/page.tsx enforce slide limit. TIER_LIMITS.FREE.slides = 8 (line 37). Backend doesn't validate - frontend only."
    },
    {
      "id": "TC-FEATGATE-005",
      "name": "Style Kit Access - Premium Kits Gated",
      "module": "feature_gating",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Verify that FREE tier users cannot select premium style kits and see upgrade prompts",
      "business_context": "Premium style kits (corporate_pro, gradient_modern, dark_mode_punch, soft_pastel) are monetization features. Must be visually restricted for free users.",
      "preconditions": [
        "User is authenticated",
        "User has FREE subscription tier",
        "User is on /en/create page",
        "8 style kits exist in database (4 free, 4 premium)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Page fetches style kits from GET /api/style-kits",
          "expected": "Returns all 8 kits with isPremium flags"
        },
        {
          "step": 2,
          "action": "availableStyleKits filtered: styleKits.filter(kit => !kit.isPremium || tier !== 'FREE')",
          "expected": "Only 4 free kits in availableStyleKits array"
        },
        {
          "step": 3,
          "action": "Style kit selector UI renders",
          "expected": "Only shows 4 free kits: minimal_clean, high_contrast_punch, marker_highlight, sticky_note"
        },
        {
          "step": 4,
          "action": "Premium kits either hidden or shown with lock icon and disabled state",
          "expected": "User cannot select premium kits"
        },
        {
          "step": 5,
          "action": "User hovers over premium kit (if visible)",
          "expected": "Tooltip: 'Requires Creator or Pro subscription'"
        },
        {
          "step": 6,
          "action": "User manually sets selectedStyleKit state to premium kit ID via console",
          "expected": "canAccessStyleKit = false, handleGenerate shows error: 'This style kit requires a Creator or Pro subscription.'"
        }
      ],
      "acceptance_criteria": [
        "FREE tier users see exactly 3 style kits (per TIER_LIMITS.FREE.style_kits = 3 in hook, but seed has 4 free kits - discrepancy!)",
        "Premium kits are visually differentiated (locked, dimmed, or hidden)",
        "Attempting to use premium kit shows clear error message",
        "Error mentions 'Creator or Pro' as required tiers",
        "Backend API returns all kits (doesn't filter by tier)",
        "Frontend filtering is consistent across create page and editor",
        "Upgrade CTA links to /settings/billing"
      ],
      "related_files": [
        "apps/nextjs/src/hooks/use-subscription.ts",
        "apps/nextjs/src/app/[lang]/(dashboard)/create/page.tsx",
        "packages/db/prisma/seed.ts"
      ],
      "tags": [
        "feature-gating",
        "style-kits",
        "premium-content",
        "monetization"
      ],
      "notes": "Lines 80-88 in create/page.tsx filter style kits. TIER_LIMITS shows FREE: 3 style_kits but seed has 4 free kits (discrepancy). Backend doesn't enforce - frontend only."
    },
    {
      "id": "TC-FEATGATE-006",
      "name": "Brand Kit Access - Free Tier Blocked",
      "module": "feature_gating",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "high",
      "description": "Verify that FREE tier users cannot create or use brand kits (0 limit) and see upgrade prompts",
      "business_context": "Brand kits are premium feature exclusively for paying customers. FREE tier must have 0 access with clear upgrade path.",
      "preconditions": [
        "User is authenticated",
        "User has FREE subscription tier"
      ],
      "steps": [
        {
          "step": 1,
          "action": "User navigates to /en/settings/brand-kit",
          "expected": "Page loads, useSubscription.canUse('brand_kits') returns false"
        },
        {
          "step": 2,
          "action": "useSubscription.getLimit('brand_kits') is called",
          "expected": "Returns 0 (TIER_LIMITS.FREE.brand_kits)"
        },
        {
          "step": 3,
          "action": "Brand kit settings page shows upgrade wall",
          "expected": "Banner: 'Brand kits require Creator or Pro subscription. Upgrade to unlock.'"
        },
        {
          "step": 4,
          "action": "Create New Brand Kit button is disabled or hidden",
          "expected": "Button either not visible or grayed out with lock icon"
        },
        {
          "step": 5,
          "action": "On /create page, 'Apply Brand Kit' toggle is disabled",
          "expected": "Toggle grayed out, tooltip: 'Requires Creator or Pro'"
        },
        {
          "step": 6,
          "action": "User attempts to POST /api/brand-kits (via API manipulation)",
          "expected": "Backend should reject (but currently doesn't validate tier - bug)"
        }
      ],
      "acceptance_criteria": [
        "FREE tier brand_kits limit is exactly 0",
        "canUse('brand_kits') returns false for FREE tier",
        "Settings page shows upgrade CTA instead of brand kit form",
        "Apply Brand Kit toggle disabled on create page",
        "No brand kit data appears in generated carousels",
        "Clear messaging: 'Requires Creator or Pro'",
        "Upgrade CTA links to /settings/billing",
        "Backend should validate tier (currently missing - security issue)"
      ],
      "related_files": [
        "apps/nextjs/src/hooks/use-subscription.ts",
        "apps/nextjs/src/app/[lang]/(dashboard)/settings/brand-kit/page.tsx",
        "apps/nextjs/src/app/[lang]/(dashboard)/create/page.tsx"
      ],
      "tags": [
        "feature-gating",
        "brand-kits",
        "free-tier",
        "zero-access",
        "critical-path"
      ],
      "notes": "TIER_LIMITS.FREE.brand_kits = 0 (line 40). This is a hard block - no brand kit access at all. Backend APIs don't enforce this (high priority security issue)."
    },
    {
      "id": "TC-FEATGATE-007",
      "name": "Watermark Display - Free Tier Enforcement",
      "module": "feature_gating",
      "user_journey": null,
      "category": "integration",
      "type": "happy_path",
      "priority": "critical",
      "description": "Verify that FREE tier exports include 'QuickCarousals.com' watermark while paid tiers do not",
      "business_context": "Watermark is key FREE tier limitation. Drives conversions by making free exports less professional. Must be consistently enforced.",
      "preconditions": [
        "User is authenticated",
        "User has completed carousel ready to export"
      ],
      "steps": [
        {
          "step": 1,
          "action": "FREE tier user opens editor for their project",
          "expected": "useSubscription.canUse('watermark') returns true (watermark is shown)"
        },
        {
          "step": 2,
          "action": "EditorCanvas component checks showWatermark from subscription hook",
          "expected": "showWatermark = true for FREE tier"
        },
        {
          "step": 3,
          "action": "Canvas preview renders with watermark at (540, 1320)",
          "expected": "Text 'QuickCarousals.com' visible in semi-transparent gray"
        },
        {
          "step": 4,
          "action": "User clicks Export, worker processes export job",
          "expected": "Worker fetches user's subscriptionTier from Profile table"
        },
        {
          "step": 5,
          "action": "Worker checks tier: subscriptionTier === 'FREE'",
          "expected": "showWatermark = true in render-slide.ts"
        },
        {
          "step": 6,
          "action": "Watermark text rendered on all exported slides (PDF + PNG)",
          "expected": "All exported files include 'QuickCarousals.com' watermark"
        },
        {
          "step": 7,
          "action": "CREATOR or PRO tier user exports same project",
          "expected": "canUse('watermark') returns false, no watermark in exports"
        }
      ],
      "acceptance_criteria": [
        "FREE tier always has watermark in editor preview",
        "FREE tier always has watermark in all exports (PDF, PNG, thumbnail)",
        "Watermark text is 'QuickCarousals.com' at exact position (540, 1320)",
        "Watermark uses rgba(0,0,0,0.4) semi-transparent gray",
        "CREATOR and PRO tiers have NO watermark",
        "Watermark enforced server-side in export worker (not bypassable)",
        "Watermark check uses subscriptionTier from database (source of truth)",
        "All slides in multi-slide exports have watermark"
      ],
      "related_files": [
        "apps/nextjs/src/hooks/use-subscription.ts",
        "apps/nextjs/src/app/[lang]/(dashboard)/editor/[id]/page.tsx",
        "apps/nextjs/src/lib/queues/render-worker.ts",
        "apps/nextjs/src/lib/render-slide.ts"
      ],
      "tags": [
        "feature-gating",
        "watermark",
        "free-tier",
        "monetization",
        "critical-path",
        "server-side-enforcement"
      ],
      "notes": "TIER_LIMITS.FREE.watermark = true (line 38). Line 24 in editor/[id]/page.tsx gets showWatermark. Worker enforces server-side (correct security pattern)."
    },
    {
      "id": "TC-FEATGATE-008",
      "name": "Upgrade Prompt Display - Feature Requirements",
      "module": "feature_gating",
      "user_journey": null,
      "category": "frontend",
      "type": "happy_path",
      "priority": "high",
      "description": "Verify that requiresUpgrade() method correctly identifies when features need subscription upgrade",
      "business_context": "Clear upgrade prompts at point of need drive conversions. Users must know exactly what they're missing and how to unlock it.",
      "preconditions": [
        "User is authenticated",
        "User has FREE subscription tier"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Call subscription.requiresUpgrade('carousels') with 3/3 usage",
          "expected": "Returns true (at limit)"
        },
        {
          "step": 2,
          "action": "Call subscription.requiresUpgrade('brand_kits')",
          "expected": "Returns true (FREE has 0 limit, always requires upgrade)"
        },
        {
          "step": 3,
          "action": "Call subscription.requiresUpgrade('custom_fonts')",
          "expected": "Returns true (boolean feature, FREE = false)"
        },
        {
          "step": 4,
          "action": "Call subscription.requiresUpgrade('priority_exports')",
          "expected": "Returns true (PRO-only feature)"
        },
        {
          "step": 5,
          "action": "Upgrade banner appears in UI with specific feature call-out",
          "expected": "Banner states: 'Unlock [feature name] with Creator/Pro'"
        },
        {
          "step": 6,
          "action": "Banner includes CTA button with data-testid='upgrade_cta'",
          "expected": "Button links to /settings/billing with tier preselected"
        },
        {
          "step": 7,
          "action": "CREATOR tier user checks requiresUpgrade('brand_kits')",
          "expected": "Returns false (CREATOR has 1 brand kit limit)"
        }
      ],
      "acceptance_criteria": [
        "requiresUpgrade() returns true when canUse() returns false",
        "requiresUpgrade() is consistent with tier limits",
        "Upgrade prompts appear at point of feature usage attempt",
        "Prompts clearly state which tier unlocks the feature",
        "Prompts link directly to billing page",
        "Different features show different tier requirements (Creator vs Pro)",
        "Prompts are non-intrusive (banners, not blocking modals)",
        "Prompts disappear immediately after upgrade (subscription state refreshed)"
      ],
      "related_files": [
        "apps/nextjs/src/hooks/use-subscription.ts",
        "apps/nextjs/src/app/[lang]/(dashboard)/create/page.tsx"
      ],
      "tags": [
        "feature-gating",
        "upgrade-prompts",
        "conversion",
        "ux"
      ],
      "notes": "Lines 139-141 in use-subscription.ts define requiresUpgrade as !canUse(). This is the basis for all upgrade prompts across the app."
    },
    {
      "id": "TC-FEATGATE-009",
      "name": "Tier Limit Consistency - Hook vs Display",
      "module": "feature_gating",
      "user_journey": null,
      "category": "integration",
      "type": "edge_case",
      "priority": "high",
      "description": "Verify that TIER_LIMITS in hook match displayed limits in billing page and upgrade prompts",
      "business_context": "Inconsistent limit messaging confuses users and damages trust. Hook limits must match marketing copy exactly.",
      "preconditions": [
        "Access to codebase",
        "Access to billing page UI"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Read TIER_LIMITS constant in use-subscription.ts (lines 34-62)",
          "expected": "FREE: 3 carousels, 8 slides, 3 style kits, 0 brand kits"
        },
        {
          "step": 2,
          "action": "Read TIER_LIMITS constant in use-subscription.ts for CREATOR",
          "expected": "CREATOR: 30 carousels, 15 slides, 8 style kits, 1 brand kit"
        },
        {
          "step": 3,
          "action": "Read TIER_LIMITS constant in use-subscription.ts for PRO",
          "expected": "PRO: unlimited carousels (-1), 20 slides, 8 style kits, 5 brand kits"
        },
        {
          "step": 4,
          "action": "Navigate to /en/settings/billing, check PRICING_TIERS display",
          "expected": "All displayed limits match TIER_LIMITS exactly"
        },
        {
          "step": 5,
          "action": "Check upgrade prompts on /create page for FREE user",
          "expected": "Prompts show correct limits (3 carousels, 8 slides, etc.)"
        },
        {
          "step": 6,
          "action": "Verify marketing pages (/pricing) match limits",
          "expected": "All public-facing limits consistent with TIER_LIMITS"
        }
      ],
      "acceptance_criteria": [
        "TIER_LIMITS is single source of truth for all limits",
        "Billing page PRICING_TIERS matches TIER_LIMITS 100%",
        "Upgrade prompts display correct numeric limits",
        "No hardcoded limits in UI components (all use hook)",
        "Marketing site pricing page matches TIER_LIMITS",
        "Style kit count discrepancy resolved (3 in hook, 4 free kits in seed)",
        "Documentation/README reflects current limits",
        "Test data uses realistic tier limits"
      ],
      "related_files": [
        "apps/nextjs/src/hooks/use-subscription.ts",
        "apps/nextjs/src/app/[lang]/(dashboard)/settings/billing/page.tsx",
        "apps/nextjs/src/app/[lang]/(marketing)/pricing/page.tsx"
      ],
      "tags": [
        "feature-gating",
        "data-consistency",
        "configuration",
        "business-logic"
      ],
      "notes": "Critical consistency check. Inconsistencies between hook limits and displayed limits cause user confusion and support tickets. Note: style_kits shows 3 in FREE tier but seed has 4 free kits."
    },
    {
      "id": "TC-FEATGATE-010",
      "name": "Feature Gating - Backend Bypass Vulnerability",
      "module": "feature_gating",
      "user_journey": null,
      "category": "security",
      "type": "error_path",
      "priority": "critical",
      "description": "Verify that backend APIs enforce tier limits (currently they don't - critical security issue)",
      "business_context": "Frontend-only feature gating is easily bypassed. Must have backend validation to prevent abuse and protect revenue.",
      "preconditions": [
        "User is authenticated",
        "User has FREE subscription tier",
        "User knows how to use browser dev tools or Postman"
      ],
      "steps": [
        {
          "step": 1,
          "action": "FREE user at 3 carousel limit bypasses frontend by POSTing directly to /api/generate/topic",
          "expected": "CURRENT: API accepts request, creates 4th carousel (bug). SHOULD: API returns 403 with error 'Carousel limit reached for FREE tier'"
        },
        {
          "step": 2,
          "action": "FREE user manipulates slideCount to 15 in API request",
          "expected": "CURRENT: API accepts, generates 15 slides (bug). SHOULD: API validates slideCount <= tier limit, returns 400 error"
        },
        {
          "step": 3,
          "action": "FREE user POSTs to /api/brand-kits to create brand kit",
          "expected": "CURRENT: API accepts, creates brand kit (bug). SHOULD: API checks tier, returns 403 'Brand kits require Creator or Pro'"
        },
        {
          "step": 4,
          "action": "FREE user sends styleKitId of premium kit in generation request",
          "expected": "CURRENT: API accepts, uses premium kit (bug). SHOULD: API validates styleKit is accessible for user's tier"
        },
        {
          "step": 5,
          "action": "Implement backend tier checks in withAuthAndErrors middleware",
          "expected": "All API routes automatically enforce tier limits"
        }
      ],
      "acceptance_criteria": [
        "ALL APIs must validate user's subscriptionTier before processing",
        "Carousel count checked before creation (compare to tier limit)",
        "Slide count validated against tier limit in generation endpoints",
        "Style kit isPremium checked against tier before use",
        "Brand kit creation blocked for FREE tier",
        "Export endpoints enforce watermark server-side (already correct)",
        "403 Forbidden returned with clear error message",
        "Error message includes upgrade CTA",
        "Backend checks use fresh subscriptionTier from database",
        "No reliance on client-provided tier information"
      ],
      "related_files": [
        "apps/nextjs/src/hooks/use-subscription.ts",
        "apps/nextjs/src/lib/with-auth.ts",
        "apps/nextjs/src/app/api/generate/topic/route.ts",
        "apps/nextjs/src/app/api/generate/text/route.ts",
        "apps/nextjs/src/app/api/brand-kits/route.ts",
        "apps/nextjs/src/app/api/projects/route.ts"
      ],
      "tags": [
        "security",
        "feature-gating",
        "backend-validation",
        "critical-path",
        "vulnerability",
        "bypass-prevention"
      ],
      "notes": "CRITICAL SECURITY ISSUE. Current implementation has frontend-only validation. Lines 94-110 in create/page.tsx check limits but backend doesn't. Savvy users can bypass via API manipulation."
    },
    {
      "id": "TC-REWRITE-001",
      "name": "Rewrite Text - Shorter Action (Happy Path)",
      "module": "rewrite",
      "user_journey": "topic_to_export",
      "category": "api",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that 'shorter' action successfully reduces text length while preserving meaning",
      "business_context": "Users need to condense overflowing text to fit within slide constraints. Shorter action is the most frequently used rewrite action, critical for fixing text overflow.",
      "preconditions": [
        "User is authenticated (valid Clerk session)",
        "OpenAI API key is configured in environment",
        "Text to rewrite is 1-5000 characters"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Send POST request to /api/rewrite with { text: '150 character text', action: 'shorter', maxWords: 12 }",
          "expected": "Request passes authentication (withAuthAndErrors - line 123)"
        },
        {
          "step": 2,
          "action": "Body validation with rewriteRequestSchema (line 124)",
          "expected": "Zod validates text (1-5000 chars), action enum, maxWords (1-100), passes validation"
        },
        {
          "step": 3,
          "action": "ACTION_PROMPTS.shorter generates system + user prompts (lines 48-58)",
          "expected": "System prompt includes 'concise editor' instructions, user prompt includes text and maxWords constraint"
        },
        {
          "step": 4,
          "action": "generateStructuredOutput calls OpenAI API (lines 138-143)",
          "expected": "OpenAI processes request with temperature 0.7, returns structured JSON matching rewriteResponseSchema"
        },
        {
          "step": 5,
          "action": "API responds with rewritten_text",
          "expected": "Response includes: { rewritten_text: 'shortened version', original_text, action: 'shorter' } (lines 145-149)"
        }
      ],
      "acceptance_criteria": [
        "Response status is 200",
        "rewritten_text field present and non-empty",
        "Rewritten text is shorter than original (at least 20% reduction)",
        "If maxWords specified, output is <= maxWords",
        "Core meaning preserved (key terms present)",
        "Tone and voice maintained (no style change)",
        "original_text echoed in response",
        "action field matches 'shorter'",
        "Response time < 10 seconds (typical OpenAI latency)"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/rewrite/route.ts",
        "apps/nextjs/src/lib/openai.ts"
      ],
      "tags": [
        "rewrite",
        "ai",
        "text-editing",
        "overflow-fix",
        "core-feature"
      ],
      "notes": "Shorter action uses maxWords parameter (optional). Without maxWords, aims for 30% reduction. System prompt: lines 49-56. Used in EditorCanvas 'Fix with AI' button for overflow (maxWords=12)."
    },
    {
      "id": "TC-REWRITE-002",
      "name": "Rewrite Text - Punchier Action",
      "module": "rewrite",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that 'punchier' action makes text more impactful using strong verbs and power words",
      "business_context": "LinkedIn carousel headlines must grab attention. Punchier action transforms bland text into engaging, scroll-stopping content.",
      "preconditions": [
        "User is authenticated",
        "Text is suitable for rewriting (not already highly punchy)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "POST /api/rewrite with { text: 'You might want to consider trying these tips.', action: 'punchier' }",
          "expected": "Request accepted and validated"
        },
        {
          "step": 2,
          "action": "ACTION_PROMPTS.punchier applies (lines 60-70)",
          "expected": "System prompt instructs: use strong active verbs, remove qualifiers, add power words, keep concise"
        },
        {
          "step": 3,
          "action": "OpenAI generates punchier version",
          "expected": "Output uses active voice, removes 'might', 'want to', 'consider', adds strong verbs (e.g., 'Implement', 'Master')"
        },
        {
          "step": 4,
          "action": "Verify response quality",
          "expected": "Rewritten text is more direct, energetic, and compelling. Length similar to original (conciseness maintained)"
        }
      ],
      "acceptance_criteria": [
        "Response status 200",
        "Weak qualifiers removed ('maybe', 'might', 'could', 'probably')",
        "Active verbs replace passive constructions",
        "Power words added (e.g., 'transform', 'accelerate', 'dominate')",
        "Maintains original meaning",
        "Text is more engaging and direct",
        "Temperature 0.7 used (line 142 - default for punchier)"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/rewrite/route.ts"
      ],
      "tags": [
        "rewrite",
        "copywriting",
        "engagement",
        "tone-adjustment"
      ],
      "notes": "Punchier uses default temperature (0.7). System prompt: lines 61-68. Commonly used for headlines and hook slides."
    },
    {
      "id": "TC-REWRITE-003",
      "name": "Rewrite Text - Add Examples Action",
      "module": "rewrite",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that 'examples' action adds 1-2 concrete, relevant examples to abstract concepts",
      "business_context": "Abstract concepts are hard to grasp. Examples make content tangible and relatable, improving comprehension and engagement.",
      "preconditions": [
        "User is authenticated",
        "Text contains abstract concept suitable for examples"
      ],
      "steps": [
        {
          "step": 1,
          "action": "POST /api/rewrite with { text: 'Good content builds trust.', action: 'examples' }",
          "expected": "Request validated"
        },
        {
          "step": 2,
          "action": "ACTION_PROMPTS.examples applies (lines 72-81)",
          "expected": "System prompt: add 1-2 specific relevant examples, keep brief, don't change core message, realistic and relatable"
        },
        {
          "step": 3,
          "action": "OpenAI generates version with examples",
          "expected": "Output includes concrete example (e.g., 'Like how [brand] shares behind-the-scenes content weekly.')"
        },
        {
          "step": 4,
          "action": "Verify examples are appropriate",
          "expected": "Examples are realistic, relatable, illustrative, and don't overshadow main message"
        }
      ],
      "acceptance_criteria": [
        "Response status 200",
        "1-2 concrete examples added",
        "Examples are specific (not vague)",
        "Examples are relevant to context",
        "Core message unchanged",
        "Text length increased moderately (not doubled)",
        "Examples feel natural (not forced)",
        "Professional tone maintained"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/rewrite/route.ts"
      ],
      "tags": [
        "rewrite",
        "content-enrichment",
        "examples",
        "clarity"
      ],
      "notes": "Examples action best for value slides. System prompt: lines 73-79. Examples should be brief (1 sentence each)."
    },
    {
      "id": "TC-REWRITE-004",
      "name": "Rewrite Text - Reduce Jargon Action",
      "module": "rewrite",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that 'reduce_jargon' action simplifies technical terms into everyday language",
      "business_context": "Jargon alienates general audiences. Simplification makes content accessible without losing professionalism.",
      "preconditions": [
        "User is authenticated",
        "Text contains technical jargon or industry-specific terms"
      ],
      "steps": [
        {
          "step": 1,
          "action": "POST /api/rewrite with { text: 'Leverage synergies to optimize KPIs.', action: 'reduce_jargon' }",
          "expected": "Request validated"
        },
        {
          "step": 2,
          "action": "ACTION_PROMPTS.reduce_jargon applies (lines 83-93)",
          "expected": "System prompt: replace jargon with everyday language, explain simply, keep meaning, maintain professional tone, accessible to general audience"
        },
        {
          "step": 3,
          "action": "OpenAI simplifies jargon",
          "expected": "Output replaces 'leverage synergies' \u2192 'work together', 'optimize KPIs' \u2192 'improve key results'"
        },
        {
          "step": 4,
          "action": "Verify simplification quality",
          "expected": "Jargon removed, concepts explained clearly, professional tone maintained"
        }
      ],
      "acceptance_criteria": [
        "Response status 200",
        "Technical terms replaced with plain language",
        "Concepts explained clearly",
        "Meaning preserved",
        "Professional tone maintained (not dumbed down)",
        "Accessible to general audience (8th grade reading level)",
        "No buzzwords or corporate speak",
        "Clarity increased without losing sophistication"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/rewrite/route.ts"
      ],
      "tags": [
        "rewrite",
        "simplification",
        "accessibility",
        "plain-language"
      ],
      "notes": "Jargon reduction maintains professional tone while improving accessibility. System prompt: lines 84-91. Useful for B2C content."
    },
    {
      "id": "TC-REWRITE-005",
      "name": "Rewrite Text - More Specific Action",
      "module": "rewrite",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that 'more_specific' action replaces vague statements with concrete details and metrics",
      "business_context": "Vague claims lack credibility. Specific details and metrics make content trustworthy and actionable.",
      "preconditions": [
        "User is authenticated",
        "Text contains vague or generic statements"
      ],
      "steps": [
        {
          "step": 1,
          "action": "POST /api/rewrite with { text: 'Many people saw great results quickly.', action: 'more_specific' }",
          "expected": "Request validated"
        },
        {
          "step": 2,
          "action": "ACTION_PROMPTS.more_specific applies (lines 95-104)",
          "expected": "System prompt: replace vague terms with specific ones, add quantifiable metrics, keep same length, maintain credibility"
        },
        {
          "step": 3,
          "action": "OpenAI adds specificity",
          "expected": "Output: '127 users achieved 40% improvement in 3 weeks.' (specific numbers, timeframe)"
        },
        {
          "step": 4,
          "action": "Verify specificity is realistic",
          "expected": "Numbers are credible (not over-the-top), metrics are relevant, length similar to original"
        }
      ],
      "acceptance_criteria": [
        "Response status 200",
        "Vague terms replaced ('many' \u2192 '127', 'quickly' \u2192 'in 3 weeks')",
        "Quantifiable metrics added where appropriate",
        "Length remains similar (not significantly longer)",
        "Numbers are realistic and credible",
        "Specificity adds value (not just noise)",
        "Core message unchanged",
        "Professional tone maintained"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/rewrite/route.ts"
      ],
      "tags": [
        "rewrite",
        "specificity",
        "credibility",
        "metrics"
      ],
      "notes": "More_specific focuses on replacing vague language with concrete details. System prompt: lines 96-102. Credibility is key - don't make up unrealistic claims."
    },
    {
      "id": "TC-REWRITE-006",
      "name": "Rewrite Text - Contrarian Hook Action",
      "module": "rewrite",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "high",
      "description": "Validates that 'contrarian_hook' action transforms text into attention-grabbing, controversy-creating hooks",
      "business_context": "Hook slides must stop scrollers. Contrarian hooks challenge conventional wisdom, creating curiosity and engagement.",
      "preconditions": [
        "User is authenticated",
        "Text contains a concept that can be challenged or reframed"
      ],
      "steps": [
        {
          "step": 1,
          "action": "POST /api/rewrite with { text: 'Networking is important for career growth.', action: 'contrarian_hook' }",
          "expected": "Request validated"
        },
        {
          "step": 2,
          "action": "ACTION_PROMPTS.contrarian_hook applies (lines 106-116)",
          "expected": "System prompt: challenge conventional wisdom, create curiosity/controversy, max 2 sentences, make people want more, not clickbait"
        },
        {
          "step": 3,
          "action": "OpenAI generates contrarian hook",
          "expected": "Output: 'Traditional networking is killing your career. Here's why going silent worked better.' (challenges norm, creates intrigue)"
        },
        {
          "step": 4,
          "action": "Verify hook quality",
          "expected": "Temperature 0.8 used (line 142 - higher for creativity), hook is short (max 2 sentences), creates curiosity, delivers on promise"
        }
      ],
      "acceptance_criteria": [
        "Response status 200",
        "Hook challenges conventional wisdom",
        "Creates curiosity and controversy",
        "Max 2 sentences (short and punchy)",
        "Not clickbait (delivers on promise)",
        "Makes people want to read more",
        "Temperature 0.8 used (more creative - line 142)",
        "Hook is attention-grabbing",
        "Maintains some relation to original concept"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/rewrite/route.ts"
      ],
      "tags": [
        "rewrite",
        "hooks",
        "engagement",
        "contrarian",
        "creativity"
      ],
      "notes": "Contrarian hook uses higher temperature (0.8) for creativity. System prompt: lines 107-114. Action is 6th option (contrarian_hook). Most creative rewrite action."
    },
    {
      "id": "TC-REWRITE-007",
      "name": "Rewrite Text - Input Validation (Text Too Long)",
      "module": "rewrite",
      "user_journey": null,
      "category": "api",
      "type": "error_path",
      "priority": "high",
      "description": "Validates that API rejects text exceeding 5000 character limit with clear error message",
      "business_context": "Long text takes longer to process and costs more. Limit prevents abuse and ensures reasonable processing times.",
      "preconditions": [
        "User is authenticated"
      ],
      "steps": [
        {
          "step": 1,
          "action": "POST /api/rewrite with { text: '5001 character string...', action: 'shorter' }",
          "expected": "validateBody rejects (line 124)"
        },
        {
          "step": 2,
          "action": "Zod validation fails on text.max(5000) constraint (line 24)",
          "expected": "Returns 400 Bad Request"
        },
        {
          "step": 3,
          "action": "Check error response format",
          "expected": "ApiErrors.validation format: { error: { code: 'VALIDATION_ERROR', message: 'text must be at most 5000 characters' } }"
        }
      ],
      "acceptance_criteria": [
        "Response status 400",
        "Error code is 'VALIDATION_ERROR'",
        "Error message clearly states character limit",
        "No OpenAI API call made (fails before AI processing)",
        "Request rejected immediately (< 100ms)",
        "Error response follows ApiError format"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/rewrite/route.ts",
        "apps/nextjs/src/lib/validations/api.ts"
      ],
      "tags": [
        "rewrite",
        "validation",
        "error-handling",
        "limits"
      ],
      "notes": "Text max is 5000 chars (line 24). Min is 1 char (empty text not allowed). Validation happens before OpenAI call to save costs."
    },
    {
      "id": "TC-REWRITE-008",
      "name": "Rewrite Text - Invalid Action Type",
      "module": "rewrite",
      "user_journey": null,
      "category": "api",
      "type": "error_path",
      "priority": "medium",
      "description": "Validates that API rejects invalid action types not in enum",
      "business_context": "Action enum ensures only supported rewrite types are processed. Invalid actions would fail at OpenAI prompt generation.",
      "preconditions": [
        "User is authenticated"
      ],
      "steps": [
        {
          "step": 1,
          "action": "POST /api/rewrite with { text: 'test', action: 'invalid_action' }",
          "expected": "Zod enum validation fails (line 25)"
        },
        {
          "step": 2,
          "action": "validateBody rejects request",
          "expected": "Returns 400 with validation error"
        },
        {
          "step": 3,
          "action": "Check error message",
          "expected": "Error includes list of valid actions: ['shorter', 'punchier', 'examples', 'reduce_jargon', 'more_specific', 'contrarian_hook']"
        }
      ],
      "acceptance_criteria": [
        "Response status 400",
        "Error code 'VALIDATION_ERROR'",
        "Error message lists valid action types",
        "No OpenAI API call made",
        "6 valid actions supported (line 25-26)",
        "Request rejected immediately"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/rewrite/route.ts"
      ],
      "tags": [
        "rewrite",
        "validation",
        "enum",
        "error-handling"
      ],
      "notes": "Action enum: shorter, punchier, examples, reduce_jargon, more_specific, contrarian_hook (lines 25-26). Validation uses Zod enum."
    },
    {
      "id": "TC-REWRITE-009",
      "name": "Rewrite Text - Unauthenticated Request",
      "module": "rewrite",
      "user_journey": null,
      "category": "api",
      "type": "error_path",
      "priority": "critical",
      "description": "Validates that unauthenticated requests are rejected with 401 error",
      "business_context": "Rewrite endpoint uses expensive OpenAI API calls. Must be protected to prevent abuse and ensure proper billing.",
      "preconditions": [
        "User is not authenticated (no valid Clerk session)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "POST /api/rewrite without Authorization header",
          "expected": "withAuthAndErrors middleware intercepts (line 123)"
        },
        {
          "step": 2,
          "action": "Clerk auth check fails",
          "expected": "Middleware returns 401 Unauthorized"
        },
        {
          "step": 3,
          "action": "Verify no OpenAI call made",
          "expected": "Request rejected before reaching route handler logic, no AI processing"
        }
      ],
      "acceptance_criteria": [
        "Response status 401",
        "Error message: 'Unauthorized' or 'Authentication required'",
        "No OpenAI API call made",
        "No text processing occurs",
        "Response time < 100ms (auth check only)",
        "Error follows ApiError format"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/rewrite/route.ts",
        "apps/nextjs/src/lib/with-auth.ts"
      ],
      "tags": [
        "rewrite",
        "authentication",
        "security",
        "access-control"
      ],
      "notes": "withAuthAndErrors protects endpoint (line 123). All rewrite requests require valid Clerk session. Auth is checked before validation or AI processing."
    },
    {
      "id": "TC-REWRITE-010",
      "name": "Rewrite Text - OpenAI Timeout Handling",
      "module": "rewrite",
      "user_journey": null,
      "category": "api",
      "type": "error_path",
      "priority": "high",
      "description": "Validates that timeouts from OpenAI API are handled gracefully with retry instructions",
      "business_context": "OpenAI API can be slow during peak times. Timeout handling ensures users get actionable error messages.",
      "preconditions": [
        "User is authenticated",
        "OpenAI API is experiencing delays (simulate with long-running request)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "POST /api/rewrite with valid data",
          "expected": "Request passes validation, calls OpenAI"
        },
        {
          "step": 2,
          "action": "OpenAI request exceeds 30-second timeout (default)",
          "expected": "generateStructuredOutput throws timeout error"
        },
        {
          "step": 3,
          "action": "Error handler catches timeout (lines 151-161)",
          "expected": "Detects error.message includes 'timeout' (line 155)"
        },
        {
          "step": 4,
          "action": "API throws ApiErrors.internal with user-friendly message",
          "expected": "Returns 500 with message 'AI service timeout. Please try again.' (line 156)"
        }
      ],
      "acceptance_criteria": [
        "Response status 500 (internal error)",
        "Error message: 'AI service timeout. Please try again.'",
        "Error code: 'INTERNAL_ERROR'",
        "Message is user-friendly (no technical jargon)",
        "Timeout detection via error.message includes 'timeout' (line 155)",
        "Timeout default is 30 seconds (from openai.ts config)",
        "User is prompted to retry"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/rewrite/route.ts",
        "apps/nextjs/src/lib/openai.ts"
      ],
      "tags": [
        "rewrite",
        "error-handling",
        "timeout",
        "openai",
        "resilience"
      ],
      "notes": "Timeout detection: error.message.includes('timeout') (line 155). Default timeout is 30s (openai.ts). OpenAI retries built into generateStructuredOutput."
    },
    {
      "id": "TC-REWRITE-011",
      "name": "Rewrite Text - OpenAI Rate Limit Handling",
      "module": "rewrite",
      "user_journey": null,
      "category": "api",
      "type": "error_path",
      "priority": "high",
      "description": "Validates that OpenAI rate limit errors return 429 with retryAfter header",
      "business_context": "OpenAI enforces rate limits. Proper 429 responses allow clients to implement backoff and retry logic.",
      "preconditions": [
        "User is authenticated",
        "OpenAI API key has reached rate limit"
      ],
      "steps": [
        {
          "step": 1,
          "action": "POST /api/rewrite when OpenAI rate limit exceeded",
          "expected": "OpenAI returns 429 rate limit error"
        },
        {
          "step": 2,
          "action": "Error handler detects rate limit (lines 151-161)",
          "expected": "error.message.toLowerCase().includes('rate limit') is true (line 158)"
        },
        {
          "step": 3,
          "action": "API throws ApiErrors.rateLimited(60)",
          "expected": "Returns 429 with retryAfter: 60 seconds (line 159)"
        },
        {
          "step": 4,
          "action": "Verify response headers",
          "expected": "Retry-After header present with value 60"
        }
      ],
      "acceptance_criteria": [
        "Response status 429 (Too Many Requests)",
        "Error code: 'RATE_LIMITED'",
        "retryAfter field present with seconds value (60)",
        "Retry-After header included",
        "Error message clear about rate limiting",
        "Detection via error.message includes 'rate limit' (case-insensitive - line 158)",
        "No retry attempts made (fails fast on rate limit)"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/rewrite/route.ts",
        "apps/nextjs/src/lib/api-error.ts"
      ],
      "tags": [
        "rewrite",
        "rate-limiting",
        "error-handling",
        "openai",
        "429"
      ],
      "notes": "Rate limit detection: error.message.toLowerCase().includes('rate limit') (line 158). ApiErrors.rateLimited(60) returns 429 with retryAfter. OpenAI lib doesn't auto-retry on 429."
    },
    {
      "id": "TC-REWRITE-012",
      "name": "Rewrite Text - Context Parameter Usage",
      "module": "rewrite",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "medium",
      "description": "Validates that optional context parameter provides additional guidance to AI for more accurate rewrites",
      "business_context": "Context helps AI understand domain-specific terminology and target audience, improving rewrite quality.",
      "preconditions": [
        "User is authenticated",
        "Text requires domain-specific understanding"
      ],
      "steps": [
        {
          "step": 1,
          "action": "POST /api/rewrite with { text: 'Implement solution', action: 'more_specific', context: 'Software development for startups' }",
          "expected": "Request validated, context field accepted (optional - line 28)"
        },
        {
          "step": 2,
          "action": "Context appended to user message (lines 132-134)",
          "expected": "userMessage becomes: 'Make this text more specific...\\n\\nContext: Software development for startups'"
        },
        {
          "step": 3,
          "action": "OpenAI uses context in generation",
          "expected": "Output reflects startup context: 'Deploy MVP using Next.js and Vercel for rapid iteration' (tech-specific, startup-relevant)"
        },
        {
          "step": 4,
          "action": "Verify context improved quality",
          "expected": "Rewrite is more domain-appropriate than without context"
        }
      ],
      "acceptance_criteria": [
        "Response status 200",
        "Context max length 500 chars (line 28)",
        "Context is optional (works without it)",
        "Context appended to user message with 'Context:' prefix (line 133)",
        "AI output reflects context (domain-specific terms)",
        "Quality improved vs no-context baseline",
        "Context validation allows empty string"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/rewrite/route.ts"
      ],
      "tags": [
        "rewrite",
        "context",
        "ai-guidance",
        "quality"
      ],
      "notes": "Context is optional parameter (max 500 chars - line 28). Appended to prompt: lines 132-134. Useful for domain-specific content (B2B, technical, industry-specific)."
    },
    {
      "id": "TC-REWRITE-013",
      "name": "Rewrite Text - Edge Runtime Compatibility",
      "module": "rewrite",
      "user_journey": null,
      "category": "api",
      "type": "happy_path",
      "priority": "medium",
      "description": "Validates that rewrite endpoint runs correctly on Edge runtime for low latency",
      "business_context": "Edge runtime reduces latency for global users. Rewrite must work on Edge for fast text editing experience.",
      "preconditions": [
        "Endpoint deployed to Edge runtime (export const runtime = 'edge' - line 173)"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Deploy rewrite endpoint to Edge",
          "expected": "runtime = 'edge' export detected (line 173)"
        },
        {
          "step": 2,
          "action": "Send POST /api/rewrite from various global locations",
          "expected": "Requests route to nearest Edge location"
        },
        {
          "step": 3,
          "action": "Verify OpenAI client works on Edge",
          "expected": "OpenAI library compatible with Edge runtime (no Node.js-specific APIs)"
        },
        {
          "step": 4,
          "action": "Measure response time",
          "expected": "Latency reduced vs Node.js runtime (faster cold starts)"
        }
      ],
      "acceptance_criteria": [
        "Endpoint deploys successfully with runtime='edge'",
        "All dependencies Edge-compatible (OpenAI, Zod, etc.)",
        "withAuthAndErrors works on Edge",
        "No Node.js-specific API usage (fs, path, etc.)",
        "Cold start time < 100ms",
        "Response time improved vs Node.js",
        "Clerk auth works on Edge",
        "No runtime errors on Edge"
      ],
      "related_files": [
        "apps/nextjs/src/app/api/rewrite/route.ts"
      ],
      "tags": [
        "rewrite",
        "edge-runtime",
        "performance",
        "deployment"
      ],
      "notes": "Edge runtime export: line 173. All dependencies must be Edge-compatible. OpenAI lib works on Edge. Faster cold starts and lower latency globally."
    }
  ],
  "known_issues": [
    {
      "module": "export_system",
      "severity": "medium",
      "issue": "No Retry Strategy for Signed URL Generation Failures",
      "description": "exports/[id]/route.ts lines 99-102 catch signed URL generation errors but don't fail the request - just omit the URL and set errorMessage. Client should retry but no automatic retry mechanism exists."
    },
    {
      "module": "export_system",
      "severity": "low",
      "issue": "No Progress Percentage in Export Status",
      "description": "Export status only has PENDING/PROCESSING/COMPLETED states. No progress percentage or current slide count, making it hard to estimate completion time for large carousels."
    },
    {
      "module": "export_system",
      "severity": "medium",
      "issue": "Font Loading Happens on Every Render",
      "description": "render-slide.ts loadDefaultFonts() is called before every slide render, but fonts are cached in a Set (line 21). However, the cache doesn't persist across worker restarts, causing repeated font loading."
    },
    {
      "module": "export_system",
      "severity": "low",
      "issue": "No Export Cancellation",
      "description": "Once export job is queued, user cannot cancel it. Modal has no cancel button during PROCESSING state. Job will complete even if user closes modal."
    },
    {
      "module": "export_system",
      "severity": "medium",
      "issue": "ExportModal Test Mode Simulation Incomplete",
      "description": "ExportModal.tsx lines 52-68 simulate test exports for exportIds starting with 'test-export-', but simulation doesn't include PNG array URLs or failure scenarios. Only simulates basic PDF flow."
    },
    {
      "module": "export_system",
      "severity": "low",
      "issue": "No Batch Export for Multiple Projects",
      "description": "Users must export projects one at a time. No API or UI for batch exporting multiple carousels simultaneously."
    },
    {
      "module": "export_system",
      "severity": "medium",
      "issue": "Worker Concurrency Fixed at 2",
      "description": "render-worker.ts line 350 hardcodes concurrency: 2. Cannot be configured via env var. May be too low for high-traffic scenarios or too high for low-resource environments."
    },
    {
      "module": "creation_flow",
      "severity": "medium",
      "issue": "No Project Ownership Verification",
      "description": "Slides API verifies project ownership, but create page doesn't check if user actually owns the project before creating slides - potential race condition if project creation succeeds but returns someone else's project ID"
    },
    {
      "module": "creation_flow",
      "severity": "high",
      "issue": "Parallel Slide Creation Race Condition",
      "description": "Promise.all at line 176 creates all slides in parallel - if one fails, others may succeed, leaving partial carousel (no rollback/transaction)"
    },
    {
      "module": "creation_flow",
      "severity": "medium",
      "issue": "No Duplicate Generation Prevention",
      "description": "User can click generate multiple times before first generation completes if they manipulate the disabled state or have slow network"
    },
    {
      "module": "creation_flow",
      "severity": "low",
      "issue": "Style Kit Not Found",
      "description": "If selectedStyleKit ID doesn't exist in database, generation succeeds but project references invalid styleKitId - no validation before API calls"
    },
    {
      "module": "creation_flow",
      "severity": "medium",
      "issue": "Carousel Limit Check Race Condition",
      "description": "projectCount is fetched on mount but not refreshed. If user has page open in multiple tabs and creates carousel in one tab, other tab still shows old count - could bypass limit check"
    },
    {
      "module": "creation_flow",
      "severity": "high",
      "issue": "No Tier Verification on Backend",
      "description": "Frontend enforces carousel limits, slide limits, style kit access - but backend APIs don't verify. Savvy user could bypass by manipulating requests"
    },
    {
      "module": "creation_flow",
      "severity": "low",
      "issue": "Error State Not Cleared on Mode Switch",
      "description": "If user gets error in Topic mode then switches to Text mode, error banner persists until next generation attempt"
    },
    {
      "module": "editor_page",
      "severity": "low",
      "issue": "No Keyboard Shortcuts Implemented",
      "description": "Test page shows keyboard shortcuts (Cmd+E, Cmd+S, Cmd+D, Delete, Cmd+0, Cmd++, Cmd+-) but no keyboard event handlers exist in editor page component"
    },
    {
      "module": "editor_page",
      "severity": "medium",
      "issue": "Layout Change Missing layersBlueprint Update",
      "description": "handleLayoutChange (line 193) only updates layoutId, doesn't update layersBlueprint property - EditorCanvas must re-fetch or derive it"
    },
    {
      "module": "editor_page",
      "severity": "medium",
      "issue": "No Confirmation on Navigation",
      "description": "Back button (line 264) navigates without checking if auto-save is in-progress - could lose data if save is still running"
    },
    {
      "module": "editor_page",
      "severity": "high",
      "issue": "Race Condition on Fast Navigation",
      "description": "If user navigates away before auto-save completes (500ms debounce + network time), changes may be lost"
    },
    {
      "module": "editor_page",
      "severity": "high",
      "issue": "Content Parsing Error Swallowed",
      "description": "Line 103 JSON.parse(slide.content) could fail for corrupted data, would crash page instead of showing error state with try-catch"
    },
    {
      "module": "editor_page",
      "severity": "low",
      "issue": "No Loading State for Save",
      "description": "Header shows save status but no visual feedback DURING the PUT request (only after response) - user doesn't see when request starts"
    },
    {
      "module": "editor_page",
      "severity": "low",
      "issue": "StyleKit Fetch Failure Message",
      "description": "If GET /api/style-kits/:id fails (line 87-90), error shows generic 'Failed to load style kit' instead of more specific 'Failed to load project data'"
    },
    {
      "module": "editor_page",
      "severity": "medium",
      "issue": "Empty Content Defaults",
      "description": "Slide transformation (lines 112-115) uses empty strings/arrays as defaults, could cause issues if layers expect specific content structure"
    },
    {
      "module": "editor_page",
      "severity": "low",
      "issue": "No Optimistic Updates",
      "description": "All operations wait for state update \u2192 auto-save \u2192 backend response, no optimistic UI updates during save (feels slower)"
    },
    {
      "module": "editor_page",
      "severity": "low",
      "issue": "Test Page API Calls",
      "description": "Test page mock save logs to console (line 230), but components might still make real API calls (styleKits, layouts) unless mocked"
    },
    {
      "module": "dashboard",
      "severity": "medium",
      "issue": "No User-Facing Error Message for API Failure",
      "description": "If GET /api/projects fails, error is logged to console but no error banner/toast shown to user. Empty state appears which might confuse users who had projects."
    },
    {
      "module": "dashboard",
      "severity": "low",
      "issue": "No Retry Mechanism for Failed Project Load",
      "description": "If API call fails on mount, user must refresh entire page to retry. No 'Retry' button or automatic retry logic."
    },
    {
      "module": "dashboard",
      "severity": "low",
      "issue": "Loading State Not Preserved on Navigation",
      "description": "If user clicks back button during loading, loading state isn't cancelled. Fetch continues in background even after unmount (no AbortController)."
    },
    {
      "module": "dashboard",
      "severity": "low",
      "issue": "Date Formatting Hardcoded to en-US",
      "description": "formatDate function always uses 'en-US' locale (line 46) instead of using dynamic lang param from route. Should respect user's locale preference."
    },
    {
      "module": "dashboard",
      "severity": "medium",
      "issue": "No Project Sorting UI",
      "description": "Projects are displayed in order returned by API (updatedAt desc), but no UI to change sort order (by title, created date, status, etc.)."
    },
    {
      "module": "style_kits",
      "severity": "high",
      "issue": "No Backend Tier Enforcement for Premium Style Kits",
      "description": "Frontend filters premium style kits by isPremium flag, but backend GET /api/style-kits doesn't verify user's subscription tier. Savvy users could bypass frontend filtering and use premium kits by manipulating API requests."
    },
    {
      "module": "style_kits",
      "severity": "low",
      "issue": "No Validation for Style Kit References",
      "description": "Projects can reference styleKitId but no validation ensures the ID exists. If a style kit is deleted from database (manually), existing projects would reference invalid IDs causing rendering errors."
    },
    {
      "module": "style_kits",
      "severity": "medium",
      "issue": "Gradient Background Rendering May Fail in Canvas",
      "description": "Premium kit 'gradient_modern' uses CSS linear-gradient format for background. EditorCanvas (Konva.js) and render-slide.ts (@napi-rs/canvas) may not support CSS gradient strings - need special parsing/rendering logic."
    }
  ]
}